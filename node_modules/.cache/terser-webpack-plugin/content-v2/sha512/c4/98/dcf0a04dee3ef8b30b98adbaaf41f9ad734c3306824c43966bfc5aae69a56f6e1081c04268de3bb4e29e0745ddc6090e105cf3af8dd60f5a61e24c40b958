{"code":"(function(){(this||window).webpackJsonp.registerAbsMids({\"esri/layers/graphics/data/StreamFeatureManager\":\"./node_modules/arcgis-js-api/layers/graphics/data/StreamFeatureManager.js\",\"esri/layers/graphics/sources/connections/GeoEventConnection\":\"./node_modules/arcgis-js-api/layers/graphics/sources/connections/GeoEventConnection.js\",\"esri/layers/graphics/sources/connections/StreamConnection\":\"./node_modules/arcgis-js-api/layers/graphics/sources/connections/StreamConnection.js\",\"esri/views/2d/layers/features/controllers/StreamController\":\"./node_modules/arcgis-js-api/views/2d/layers/features/controllers/StreamController.js\",\"esri/views/2d/layers/features/controllers/support/DispatchQueue\":\"./node_modules/arcgis-js-api/views/2d/layers/features/controllers/support/DispatchQueue.js\"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{\"./node_modules/arcgis-js-api/layers/graphics/data/StreamFeatureManager.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports,__webpack_require__(/*! ../../../core/CircularArray */ \"./node_modules/arcgis-js-api/core/CircularArray.js\"),__webpack_require__(/*! ../../../core/mathUtils */ \"./node_modules/arcgis-js-api/core/mathUtils.js\"),__webpack_require__(/*! ../../../core/maybe */ \"./node_modules/arcgis-js-api/core/maybe.js\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(t,e,i,s,r){Object.defineProperty(e,\"__esModule\",{value:!0}),e.DEFAULT_STREAM_ID_FIELD=\"__esri_stream_id__\";var o=function(){function t(t,i,s,r,o){void 0===o&&(o=128),this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=Date.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=s,this._purgeOptions=r,this.store=t,this.objectIdField=i,this.purgeInterval=o,this._useGeneratedIds=this.objectIdField===e.DEFAULT_STREAM_ID_FIELD}return t.prototype.add=function(t){if(this._useGeneratedIds&&(t.attributes[this.objectIdField]=this._nextId()),t.objectId=t.attributes[this.objectIdField],this.store.add(t),this._addOrUpdated.set(t.objectId,t),this._maxAge=Math.max(this._maxAge,t.attributes[this._timeInfo.startTimeField]),this._timeInfo.trackIdField){var e=t.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(e)){var o=r.isSome(this._purgeOptions)&&null!=this._purgeOptions.maxObservations?this._purgeOptions.maxObservations:1e3,a=s.clamp(o,0,1e3);this._trackIdToObservations.set(e,new i.default(a))}var d=this._trackIdToObservations.get(e),n=t.attributes[this.objectIdField],h=d.enqueue(n);if(r.isSome(h)){var u=this.store.removeById(h);r.isSome(u)&&(this._addOrUpdated.has(h)?this._addOrUpdated.delete(h):this._removed.push(u))}}},t.prototype.checkForUpdates=function(){var t=this._getToAdd(),e=this._getToRemove(),i=Date.now();i-this._lastPurge>=this.purgeInterval&&(this._purge(),this._lastPurge=i),(t||e)&&this.store.update(t,e)},t.prototype._getToAdd=function(){if(!this._addOrUpdated.size)return null;var t=new Array(this._addOrUpdated.size),e=0;return this._addOrUpdated.forEach((function(i){return t[e++]=i})),this._addOrUpdated.clear(),t},t.prototype._getToRemove=function(){var t=this._removed;return this._removed.length?(this._removed=[],t):null},t.prototype._nextId=function(){var t=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,t},t.prototype._purge=function(){var t=this._purgeOptions;r.isSome(t)&&(this._purgeSomeByDisplayCount(t),this._purgeByAge(t),this._purgeTracks())},t.prototype._purgeSomeByDisplayCount=function(t){var e=this;if(t.displayCount){var i=this.store.size;i>t.displayCount&&this._trackIdToObservations.forEach((function(s){if(i>t.displayCount&&s.size){var o=e.store.removeById(r.unwrap(s.dequeue()));r.isSome(o)&&e._removed.push(o),i--}}))}},t.prototype._purgeByAge=function(t){var e=this;if(t.age){var i=60*t.age*1e3,s=this._maxAge-i,r=this._timeInfo.startTimeField;this.store.forEach((function(t){t.attributes[r]<s&&(e.store.removeById(t.objectId),e._removed.push(t))}))}},t.prototype._purgeTracks=function(){var t=this;this._trackIdToObservations.forEach((function(e,i){0===e.size&&t._trackIdToObservations.delete(i)}))},t}();e.default=o}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/layers/graphics/data/StreamFeatureManager.js?')},\"./node_modules/arcgis-js-api/layers/graphics/sources/connections/GeoEventConnection.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports,__webpack_require__(/*! tslib */ \"./node_modules/tslib/tslib.js\"),__webpack_require__(/*! ../../../../geometry */ \"./node_modules/arcgis-js-api/geometry.js\"),__webpack_require__(/*! ../../../../request */ \"./node_modules/arcgis-js-api/request.js\"),__webpack_require__(/*! ../../../../core/Error */ \"./node_modules/arcgis-js-api/core/Error.js\"),__webpack_require__(/*! ../../../../core/Logger */ \"./node_modules/arcgis-js-api/core/Logger.js\"),__webpack_require__(/*! ../../../../core/maybe */ \"./node_modules/arcgis-js-api/core/maybe.js\"),__webpack_require__(/*! ../../../../core/promiseUtils */ \"./node_modules/arcgis-js-api/core/promiseUtils.js\"),__webpack_require__(/*! ../../../../core/accessorSupport/decorators */ \"./node_modules/arcgis-js-api/core/accessorSupport/decorators.js\"),__webpack_require__(/*! ../../../FeatureLayer */ \"./node_modules/arcgis-js-api/layers/FeatureLayer.js\"),__webpack_require__(/*! ./StreamConnection */ \"./node_modules/arcgis-js-api/layers/graphics/sources/connections/StreamConnection.js\"),__webpack_require__(/*! ../../../../tasks/operations/query */ \"./node_modules/arcgis-js-api/tasks/operations/query.js\"),__webpack_require__(/*! ../../../../tasks/operations/zscale */ \"./node_modules/arcgis-js-api/tasks/operations/zscale.js\"),__webpack_require__(/*! ../../../../tasks/support/Query */ \"./node_modules/arcgis-js-api/tasks/support/Query.js\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(e,t,r,n,o,i,s,c,a,u,d,_,h,f,l){Object.defineProperty(t,\"__esModule\",{value:!0});var y,p=s.getLogger(\"esri.layers.graphics.sources.connections.GeoEventConnection\");!function(e){e[e.CONNECTING=0]=\"CONNECTING\",e[e.OPEN=1]=\"OPEN\",e[e.CLOSING=2]=\"CLOSING\",e[e.CLOSED=3]=\"CLOSED\"}(y=t.ReadyState||(t.ReadyState={}));var v=function(e){function t(t,r,n,o,i,s,c,a){void 0===s&&(s=5),void 0===c&&(c=3);var u=e.call(this)||this;return u._destroyed=!1,u.errorString=null,u._source=t,u._sourceSpatialReference=r,u._spatialReference=n,u._filter=i,u._outFields=a,u._maxQueryDepth=s,u._maxRecordCountFactor=c,u._featureZScaler=f.getGeometryZScaler(o,r,n),u._open(),u}return r.__extends(t,e),t.prototype._open=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._fetchServiceDefinition(this._source)];case 1:return(e=r.sent()).timeInfo.trackIdField||p.warn(\"GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.\"),[4,this._fetchWebSocketUrl(e.streamUrls,this._spatialReference)];case 2:return t=r.sent(),this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),[4,this._buddyServicesQuery];case 3:return r.sent(),[4,this._tryCreateWebSocket(t)];case 4:return r.sent(),n=this._filter,o=this._outFields,this._destroyed||this._setFilter(n,o),[2]}}))}))},t.prototype.destroy=function(){this._destroyed=!0,c.isSome(this._websocket)&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close()),this._websocket=null},Object.defineProperty(t.prototype,\"connectionStatus\",{get:function(){if(c.isNone(this._websocket))return\"disconnected\";switch(this._websocket.readyState){case y.CONNECTING:case y.OPEN:return\"connected\";case y.CLOSING:case y.CLOSED:return\"disconnected\"}},enumerable:!0,configurable:!0}),t.prototype._tryCreateWebSocket=function(e,t){return void 0===t&&(t=1e3),r.__awaiter(this,void 0,void 0,(function(){var n,o,s;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,4]),this._destroyed?[2]:(n=this,[4,this._createWebSocket(e)]);case 1:return n._websocket=r.sent(),this.notifyChange(\"connectionStatus\"),[3,4];case 2:return o=r.sent(),s=t/1e3,p.error(new i(\"geoevent-connection\",\"Failed to connect. Attempting to reconnect in \"+s+\"s\",o)),[4,a.after(t)];case 3:return r.sent(),[2,this._tryCreateWebSocket(e,1.5*t)];case 4:return[2]}}))}))},t.prototype._createWebSocket=function(e){var t=this,r=new WebSocket(e),n=a.create((function(e,t){r.onopen=function(){return e(r)},r.onclose=function(e){return t(e)}}));return n.then((function(){if(t._destroyed)return r.onclose=function(){},void r.close();r.onclose=function(e){return t._onClose(e)},r.onerror=function(e){return t._onError(e)},r.onmessage=function(e){return t._onMessage(e)}})),n},t.prototype._onMessage=function(e){var t;try{t=this._enrich(JSON.parse(e.data)),this._featureZScaler&&this._featureZScaler(t.geometry)}catch(e){return void p.error(new i(\"geoevent-connection\",\"Failed to parse message\",e))}this.onFeature(t)},t.prototype._onError=function(e){var t=\"Encountered an error over WebSocket connection\";this._set(\"errorString\",t),p.error(\"geoevent-connection\",t)},t.prototype._onClose=function(e){this._websocket=null,this.notifyChange(\"connectionStatus\"),1e3!==e.code&&p.error(\"geoevent-connection\",\"WebSocket closed unexpectedly with error code \"+e.code),this._destroyed||this._open()},t.prototype._fetchServiceDefinition=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,o(e,{query:{f:\"json\"},responseType:\"json\"})];case 1:return t=r.sent(),n=t.data,this._serviceDefinition=n,[2,n]}}))}))},t.prototype._fetchWebSocketUrl=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,o,i;return r.__generator(this,(function(r){return n=e[0],o=n.urls,i=n.token,[2,this._inferWebSocketBaseUrl(o)+\"/subscribe?outSR=\"+t.wkid+(i?\"&token=\"+i:\"\")]}))}))},t.prototype._inferWebSocketBaseUrl=function(e){if(1===e.length)return e[0];for(var t=0,r=e;t<r.length;t++){var n=r[t];if(-1!==n.indexOf(\"wss\"))return n}return p.error(new i(\"geoevent-connection\",\"Unable to infer WebSocket url\",e)),null},t.prototype._setFilter=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,o,s,u,d,_,h=this;return r.__generator(this,(function(r){return n=this._websocket,this._filter=e,this._outFields=t,c.isNone(n)||c.isNone(e)&&c.isNone(t)?[2]:(o=JSON.stringify({filter:this._serializeFilter(e,t)}),s=!1,u=a.createResolver(),d=function(){s||(h._destroyed||h._websocket!==n||p.error(new i(\"geoevent-connection\",\"Server timed out when setting filter\")),u.reject())},_=function(e){var t=JSON.parse(e.data);t.filter&&(t.error&&(p.error(new i(\"geoevent-connection\",\"Failed to set service filter\",t.error)),h._set(\"errorString\",\"Could not set service filter - \"+t.error),u.reject(t.error)),n.onmessage=h._onMessage.bind(h),s=!0,u.resolve())},n.onmessage=_,n.send(o),setTimeout(d,1e4),[2,u.promise])}))}))},t.prototype._serializeFilter=function(e,t){var r={};if(c.isNone(e)&&c.isNone(t))return r;if(c.isSome(e)&&e.geometry)try{var o=n.fromJSON(e.geometry);if(\"extent\"!==o.type)throw new i(\"Expected extent but found type \"+o.type);r.geometry=JSON.stringify(o.shiftCentralMeridian())}catch(e){p.error(new i(\"geoevent-connection\",\"Encountered an error when setting connection geometryDefinition\",e))}return c.isSome(e)&&e.where&&\"1 = 1\"!==e.where&&(r.where=e.where),c.isSome(t)&&(r.outFields=t.join(\",\")),r},t.prototype._enrich=function(e){if(!this._relatedFeatures)return e;var t=this._serviceDefinition.relatedFeatures.joinField,r=e.attributes[t];if(!this._relatedFeatures.has(r))return p.warn(\"geoevent-connection\",\"Feature join failed. Is the join field configured correctly?\",e),e;var n=this._relatedFeatures.get(r),o=n.attributes,s=n.geometry;for(var c in o)e.attributes[c]=o[c];return s&&(e.geometry=s),e.geometry||e.centroid||p.error(new i(\"geoevent-connection\",\"Found malformed feature - no geometry found\",e)),e},t.prototype._queryBuddyServices=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,s,c,a,u,d,_;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),e=this._serviceDefinition,t=e.relatedFeatures,n=e.keepLatestArchive,o=this._queryRelatedFeatures(t),s=this._queryArchive(n),[4,o];case 1:return r.sent(),[4,s];case 2:if(!(c=r.sent()))return[2];for(a=0,u=c.features;a<u.length;a++)d=u[a],this.onFeature(this._enrich(d));return[3,4];case 3:return _=r.sent(),p.error(new i(\"geoevent-connection\",\"Encountered an error when querying buddy services\",{error:_})),[3,4];case 4:return[2]}}))}))},t.prototype._queryRelatedFeatures=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(r){switch(r.label){case 0:return e?[4,this._queryBuddy(e.featuresUrl)]:[2];case 1:return t=r.sent(),this._addRelatedFeatures(t),[2]}}))}))},t.prototype._queryArchive=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return e?[2,this._queryBuddy(e.featuresUrl)]:[2,void 0]}))}))},t.prototype._queryBuddy=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,s,a,u,_,f,y;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,(t=new d({url:e})).load()];case 1:return n=r.sent().capabilities,o=n.query.supportsMaxRecordCountFactor,i=n.query.supportsPagination,s=n.query.supportsCentroid,a=this._maxRecordCountFactor,u=t.capabilities.query.maxRecordCount,_=o?u*a:u,(f=new l).outFields=c.unwrapOr(this._outFields,[\"*\"]),f.where=c.unwrapOr(c.get(this._filter,\"where\"),\"1=1\"),f.returnGeometry=!0,f.returnExceededLimitFeatures=!0,f.outSpatialReference=this._spatialReference,s&&(f.returnCentroid=!0),o&&(f.maxRecordCountFactor=a),i?(f.num=_,t.destroy(),[2,this._queryPages(e,f)]):[4,h.executeQuery(e,f,this._sourceSpatialReference)];case 2:return y=r.sent(),t.destroy(),[2,y.data]}}))}))},t.prototype._queryPages=function(e,t,n,o){return void 0===n&&(n=[]),void 0===o&&(o=0),r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return t.start=o*t.num,[4,h.executeQuery(e,t,this._sourceSpatialReference)];case 1:return(i=r.sent().data).exceededTransferLimit&&o<this._maxQueryDepth?(i.features.forEach((function(e){return n.push(e)})),[2,this._queryPages(e,t,n,o+1)]):(n.forEach((function(e){return i.features.push(e)})),[2,i])}}))}))},t.prototype._addRelatedFeatures=function(e){for(var t=new Map,r=e.features,n=this._serviceDefinition.relatedFeatures.joinField,o=0,i=r;o<i.length;o++){var s=i[o],c=s.attributes[n];t.set(c,s)}this._relatedFeatures=t},r.__decorate([u.property()],t.prototype,\"connectionStatus\",null),r.__decorate([u.property()],t.prototype,\"errorString\",void 0),t=r.__decorate([u.subclass(\"esri.layers.graphics.sources.connections.GeoEventConnection\")],t)}(_.default);t.default=v}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/layers/graphics/sources/connections/GeoEventConnection.js?')},\"./node_modules/arcgis-js-api/layers/graphics/sources/connections/StreamConnection.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports,__webpack_require__(/*! tslib */ \"./node_modules/tslib/tslib.js\"),__webpack_require__(/*! ../../../../core/Evented */ \"./node_modules/arcgis-js-api/core/Evented.js\"),__webpack_require__(/*! ../../../../core/HandleOwner */ \"./node_modules/arcgis-js-api/core/HandleOwner.js\"),__webpack_require__(/*! ../../../../core/accessorSupport/decorators */ \"./node_modules/arcgis-js-api/core/accessorSupport/decorators.js\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(e,n,r,t,o,s){Object.defineProperty(n,\"__esModule\",{value:!0});var c=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(n,e),n.prototype.onFeature=function(e){this.emit(\"feature\",e)},n=r.__decorate([s.subclass(\"esri.layers.graphics.sources.connections.StreamConnection\")],n)}(t.EventedMixin(o.HandleOwner));n.default=c}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/layers/graphics/sources/connections/StreamConnection.js?')},\"./node_modules/arcgis-js-api/views/2d/layers/features/controllers/StreamController.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports,__webpack_require__(/*! tslib */ \"./node_modules/tslib/tslib.js\"),__webpack_require__(/*! ../../../../../core/Error */ \"./node_modules/arcgis-js-api/core/Error.js\"),__webpack_require__(/*! ../../../../../core/has */ \"./node_modules/arcgis-js-api/core/has.js\"),__webpack_require__(/*! ../../../../../core/MapUtils */ \"./node_modules/arcgis-js-api/core/MapUtils.js\"),__webpack_require__(/*! ../../../../../core/maybe */ \"./node_modules/arcgis-js-api/core/maybe.js\"),__webpack_require__(/*! ../../../../../core/promiseUtils */ \"./node_modules/arcgis-js-api/core/promiseUtils.js\"),__webpack_require__(/*! ../../../../../core/accessorSupport/decorators */ \"./node_modules/arcgis-js-api/core/accessorSupport/decorators.js\"),__webpack_require__(/*! ../../../../../layers/graphics/featureConversionUtils */ \"./node_modules/arcgis-js-api/layers/graphics/featureConversionUtils.js\"),__webpack_require__(/*! ../../../../../layers/graphics/data/executeTileQuery */ \"./node_modules/arcgis-js-api/layers/graphics/data/executeTileQuery.js\"),__webpack_require__(/*! ../../../../../layers/graphics/data/FeatureStore */ \"./node_modules/arcgis-js-api/layers/graphics/data/FeatureStore.js\"),__webpack_require__(/*! ../../../../../layers/graphics/data/StreamFeatureManager */ \"./node_modules/arcgis-js-api/layers/graphics/data/StreamFeatureManager.js\"),__webpack_require__(/*! ../../../../../layers/graphics/sources/connections/GeoEventConnection */ \"./node_modules/arcgis-js-api/layers/graphics/sources/connections/GeoEventConnection.js\"),__webpack_require__(/*! ./BaseController */ \"./node_modules/arcgis-js-api/views/2d/layers/features/controllers/BaseController.js\"),__webpack_require__(/*! ./support/DispatchQueue */ \"./node_modules/arcgis-js-api/views/2d/layers/features/controllers/support/DispatchQueue.js\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(e,t,r,i,n,o,a,s,u,c,p,h,d,l,f,y){Object.defineProperty(t,\"__esModule\",{value:!0});var v=function(){function e(e,t){this.store=e,this.onUpdate=t}return e.prototype.add=function(e){this.store.add(e)},e.prototype.forEach=function(e){this.store.forEach(e)},e.prototype.removeById=function(e){return this.store.removeById(e)},e.prototype.update=function(e,t){this.onUpdate(e,t)},Object.defineProperty(e.prototype,\"size\",{get:function(){return this.store.numFeatures},enumerable:!0,configurable:!0}),e}(),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=\"stream\",t._tileDispatchMap=new Map,t._updateIntervalId=0,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this,t=this.service,r=t.source,i=t.objectIdField,n=t.timeInfo,o=t.purgeOptions,a=t.serviceFilter,s=t.geometryType,u=t.spatialReference;this.connection=new l.default(r,u,this.spatialReference,s,a),this._set(\"store\",new h.default(this.geometryInfo)),this._set(\"streamFeatureManager\",new d.default(new v(this.store,(function(t,r){return e._onUpdate(t,r)})),i,n,o)),this.connection.on(\"feature\",(function(t){return e._onFeature(t)})),[\"connectionStatus\",\"errorString\"].forEach((function(t){e.watch(\"connection.\"+t,(function(r){return e.remoteClient.invoke(\"setProperty\",{propertyName:t,value:r})}))})),this._updateIntervalId=setInterval((function(){return e.streamFeatureManager.checkForUpdates()}),64),this._shouldPushDataReceived=this.service.enableDataReceived},t.prototype.destroy=function(){clearInterval(this._updateIntervalId),this.connection.destroy(),this.queryEngine.destroy(),this._tileDispatchMap.forEach((function(e){return e.destroy()}))},Object.defineProperty(t.prototype,\"queryEngine\",{get:function(){return this._createQueryEngine(this.store)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"updating\",{get:function(){return this._tempQueryEngine&&!!this._tempQueryEngine.featureStore.numFeatures||this._anyUpdatesQueued()},enumerable:!0,configurable:!0}),t.prototype.update=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,n,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:return this.validateConfig(e),t=JSON.stringify(this.service.serviceFilter),i=this.renderer.getAttributeHash(),this._set(\"config\",e),[4,this.updatePixelBuffer()];case 1:return r.sent(),t!==JSON.stringify(this.service.serviceFilter),\"heatmap\"===this.renderer.type?[2]:i===this.renderer.getAttributeHash()?[3,3]:(n=this.queryEngine.featureStore,[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)]);case 2:r.sent(),n.forEach((function(e){return o.attributeStore.setAttributeData(e.localId,e,o.geometryInfo,o.viewParams)})),r.label=3;case 3:return[4,this.attributeStore.updateFilters(this)];case 4:return r.sent(),[4,this.attributeStore.sendUpdates()];case 5:return r.sent(),[2]}}))}))},t.prototype.invalidate=function(){this._repushActiveTiles()},t.prototype.onEdits=function(){},t.prototype.queryFeatures=function(e){return this.queryEngine.executeQuery(e)},t.prototype.queryFeatureCount=function(e){return this.queryEngine.executeQueryForCount(e)},t.prototype.queryObjectIds=function(e){return this.queryEngine.executeQueryForIds(e)},t.prototype.queryExtent=function(e){return this.queryEngine.executeQueryForExtent(e)},t.prototype.queryLatestObservations=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){if(!this.service.timeInfo.trackIdField)throw new i(\"mapview-no-trackIdField\",\"queryLatestObservation can only be used with services that define a TrackIdField\");return[2,this.queryEngine.executeQueryForLatestObservations(e)]}))}))},t.prototype.queryStatistics=function(){throw new i(\"Method not implemented.\")},t.prototype.refresh=function(){},t.prototype.setViewState=function(t){var r=this,i=this.viewState&&this.viewState.scale;e.prototype.setViewState.call(this,t),i!==this.viewState.scale&&this.attributeStore.hasScaleExpr&&(this.queryEngine.featureStore.forEach((function(e){return r.attributeStore.setAttributeData(e.localId,e,r.geometryInfo,r.viewParams)})),this.attributeStore.sendUpdates())},t.prototype.onTileUpdate=function(e){var t=this,r=e.added;e.removed.forEach((function(e){return t._handleTileRemove(e)})),r.forEach((function(e){return t._handleTileAdd(e)}))},t.prototype.enableEvent=function(e){\"data-received\"===e.name&&(this._shouldPushDataReceived=e.value)},t.prototype._onFeature=function(e){this._shouldPushDataReceived&&this.remoteClient.invoke(\"emitEvent\",{name:\"data-received\",event:{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry}});try{var t=this.geometryInfo,r=t.geometryType,i=t.hasM,o=t.hasZ,a=c.convertFromFeature(e,r,o,i,this.service.objectIdField);this.streamFeatureManager.add(a)}catch(e){n(\"esri-2d-debug\")&&console.debug(e)}},t.prototype._createStoreWithFeatures=function(e){if(a.isNone(e))return null;var t=this._createFeatureStore();return t.addMany(e),t},t.prototype._onUpdate=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:return a.isSome(e)&&e.forEach((function(e){return o.onFeatureAdd(e)})),i=this._createStoreWithFeatures(e),n=this._createStoreWithFeatures(t),this.attributeStore.sendUpdates(),this.processor.supportsTileUpdates?[4,this._updateActiveTiles(i,n)]:[3,2];case 1:return r.sent(),[3,3];case 2:this._repushActiveTiles(),r.label=3;case 3:return a.isSome(t)&&t.forEach((function(e){return o.onFeatureRemove(e)})),[2]}}))}))},t.prototype._handleTileAdd=function(e){if(this._tileDispatchMap.has(e.id)){(t=this._tileDispatchMap.get(e.id)).up()}else{var t=new y.default;this._tileDispatchMap.set(e.id,t)}this._queryTileFeatures(e,!0,this.queryEngine)},t.prototype._handleTileRemove=function(e){var t=this._tileDispatchMap.get(e.id);t&&(t.destroy(),this._tileDispatchMap.delete(e.id))},t.prototype._anyUpdatesQueued=function(){return o.valuesOfMap(this._tileDispatchMap).some((function(e){return e.hasAction()}))},t.prototype._updateActiveTiles=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:return i=a.applySome(e,(function(e){return o._createQueryEngine(e)})),n=a.applySome(t,(function(e){return o._createQueryEngine(e)})),[4,s.all(this.tileStore.tiles.map((function(e){return o._queryTileFeatures(e,!1,i,n)})))];case 1:return r.sent(),[2]}}))}))},t.prototype._repushActiveTiles=function(){for(var e=0,t=this.tileStore.tiles;e<t.length;e++){var r=t[e];this._queryTileFeatures(r,!0,this.queryEngine)}},t.prototype._queryTileFeatures=function(e,t,i,n){return r.__awaiter(this,void 0,void 0,(function(){var o,u,c,h,d,l,f,y,v,_,g,m,b=this;return r.__generator(this,(function(F){switch(F.label){case 0:return o={hasZ:!1,hasM:!1,transform:{originPosition:\"upperLeft\",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]}},u=this.queryInfo,c=u.returnCentroid,h=u.returnGeometry,d=this._pixelBuffer,l={returnCentroid:c,returnGeometry:h,pixelBuffer:d,returnOutline:this.returnOutline},this._tileDispatchMap.has(e.id)?(f=this._tileDispatchMap.get(e.id),[4,a.applySome(i,(function(t){return t.featureStore.executeTileQuery(e,b.spatialReference,l)}))]):[2];case 1:return y=F.sent(),v=a.mapOr(y,[],(function(e){return e.features})),_=a.mapOr(n,[],(function(t){return p.executeTileQueryForIds(t,e,l)})).map((function(e){return b.attributeStore.getLocalId(e)})),g=s.createResolver(),m=function(i){return r.__awaiter(b,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.processor.onTileData(e,{addOrUpdate:v,remove:_,clear:t,transformParams:o},{signal:i})];case 1:return r.sent(),[3,3];case 2:return n=r.sent(),s.throwIfNotAbortError(n),[3,3];case 3:return g.resolve(),[2]}}))}))},f.enqueue(m),[2,g.promise]}}))}))},r.__decorate([u.property()],t.prototype,\"connection\",void 0),r.__decorate([u.property()],t.prototype,\"service\",void 0),r.__decorate([u.property({readOnly:!0})],t.prototype,\"store\",void 0),r.__decorate([u.property({readOnly:!0})],t.prototype,\"streamFeatureManager\",void 0),r.__decorate([u.property({readOnly:!0,dependsOn:[\"store\",\"service\",\"config\"]})],t.prototype,\"queryEngine\",null),r.__decorate([u.property()],t.prototype,\"updating\",null),t=r.__decorate([u.subclass(\"esri.views.2d.layers.features.controllers.StreamController\")],t)}(f.default);t.default=_}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/views/2d/layers/features/controllers/StreamController.js?')},\"./node_modules/arcgis-js-api/views/2d/layers/features/controllers/support/DispatchQueue.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports,__webpack_require__(/*! tslib */ \"./node_modules/tslib/tslib.js\"),__webpack_require__(/*! ../../../../../../core/promiseUtils */ \"./node_modules/arcgis-js-api/core/promiseUtils.js\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(t,o,e,r){Object.defineProperty(o,\"__esModule\",{value:!0});var n=function(){function t(){this._action=null,this._queue=[],this._abortController=r.createAbortController(),this._refs=1}return t.prototype.up=function(){this._refs++},t.prototype.down=function(){return this._refs--,0===this._refs},t.prototype.clear=function(){this._abortController.abort(),this._abortController=r.createAbortController()},t.prototype.destroy=function(){this._queue.length=0,this._action&&(this._action=null)},t.prototype.enqueue=function(t){this._action?this._queue.push(t):this._setAction(t)},t.prototype.flush=function(){return e.__awaiter(this,void 0,void 0,(function(){var t,o,n;return e.__generator(this,(function(e){return(t=this._action)?(o=this._abortController.signal,n=this._queue.reduce((function(t,e){return t.then((function(){return e(o)}))}),t).catch(r.throwIfNotAbortError),this._action=n.then(this._handleNext.bind(this)).catch(r.throwIfNotAbortError),this._queue.length=0,[2,n]):[2]}))}))},t.prototype.hasAction=function(){return!!this._action},t.prototype._setAction=function(t){var o=this._abortController.signal;this._action=t(o).then(this._handleNext.bind(this)).catch(r.throwIfNotAbortError)},t.prototype._handleNext=function(){this._queue.length?this._setAction(this._queue.shift()):this._action=null},t}();o.default=n}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/views/2d/layers/features/controllers/support/DispatchQueue.js?')}}]);","extractedComments":[]}