{"code":"(function(){(this||window).webpackJsonp.registerAbsMids({\"esri/core/SetPool\":\"./node_modules/arcgis-js-api/core/SetPool.js\",\"esri/layers/graphics/sources/geojson/geojson\":\"./node_modules/arcgis-js-api/layers/graphics/sources/geojson/geojson.js\",\"esri/layers/graphics/sources/support/clientSideDefaults\":\"./node_modules/arcgis-js-api/layers/graphics/sources/support/clientSideDefaults.js\",\"esri/layers/ogc/ogcFeatureUtils\":\"./node_modules/arcgis-js-api/layers/ogc/ogcFeatureUtils.js\",\"esri/views/2d/layers/features/controllers/EditsQueue\":\"./node_modules/arcgis-js-api/views/2d/layers/features/controllers/EditsQueue.js\",\"esri/views/2d/layers/features/controllers/OnDemandController\":\"./node_modules/arcgis-js-api/views/2d/layers/features/controllers/OnDemandController.js\",\"esri/views/2d/layers/features/support/DataTile\":\"./node_modules/arcgis-js-api/views/2d/layers/features/support/DataTile.js\",\"esri/views/2d/layers/features/support/DataTileFeaturesIndex\":\"./node_modules/arcgis-js-api/views/2d/layers/features/support/DataTileFeaturesIndex.js\",\"esri/views/2d/layers/features/support/TileUpdateQueue\":\"./node_modules/arcgis-js-api/views/2d/layers/features/support/TileUpdateQueue.js\"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{\"./node_modules/arcgis-js-api/core/SetPool.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports], __WEBPACK_AMD_DEFINE_RESULT__ = (function(e,t){Object.defineProperty(t,\"__esModule\",{value:!0});var r=function(){function e(){this._pool=[],this._set=new Set}return e.prototype.acquire=function(){if(0===this._pool.length)return new Set;var e=this._pool.pop();return this._set.delete(e),e},e.prototype.release=function(e){e&&!this._set.has(e)&&(e.clear(),this._pool.length<5e4&&(this._pool.push(e),this._set.add(e)))},e.acquire=function(){return n.acquire()},e.release=function(e){return n.release(e)},e}();t.default=r;var n=new r}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/core/SetPool.js?')},\"./node_modules/arcgis-js-api/layers/graphics/sources/geojson/geojson.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports,__webpack_require__(/*! tslib */ \"./node_modules/tslib/tslib.js\"),__webpack_require__(/*! ../../../../core/Error */ \"./node_modules/arcgis-js-api/core/Error.js\"),__webpack_require__(/*! ../../OptimizedFeature */ \"./node_modules/arcgis-js-api/layers/graphics/OptimizedFeature.js\"),__webpack_require__(/*! ../../OptimizedGeometry */ \"./node_modules/arcgis-js-api/layers/graphics/OptimizedGeometry.js\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(e,r,t,n,o,a){Object.defineProperty(r,\"__esModule\",{value:!0});var u={LineString:\"esriGeometryPolyline\",MultiLineString:\"esriGeometryPolyline\",MultiPoint:\"esriGeometryMultipoint\",Point:\"esriGeometryPoint\",Polygon:\"esriGeometryPolygon\",MultiPolygon:\"esriGeometryPolygon\"};function i(e){var r,n,o;return t.__generator(this,(function(t){switch(t.label){case 0:switch(e.type){case\"Feature\":return[3,1];case\"FeatureCollection\":return[3,3]}return[3,7];case 1:return[4,e];case 2:return t.sent(),[3,7];case 3:r=0,n=e.features,t.label=4;case 4:return r<n.length?(o=n[r])?[4,o]:[3,6]:[3,7];case 5:t.sent(),t.label=6;case 6:return r++,[3,4];case 7:return[2]}}))}function s(e,r){var n,i,s,l,c,g,v,h;return void 0===r&&(r={}),t.__generator(this,(function(t){switch(t.label){case 0:n=r.geometryType,i=r.objectIdFieldName,t.label=1;case 1:return s=e.next(),l=s.value,s.done?[2]:(c=l.geometry,g=l.properties,v=l.id,c&&u[c.type]!==n?[3,1]:(h=g||{},i&&null!=v&&!h[i]&&(h[i]=v),[4,new o.default(c?function(e,r,t){switch(r.type){case\"LineString\":return function(e,r,t){return p(e,r.coordinates,t),e}(e,r,t);case\"MultiLineString\":return function(e,r,t){for(var n=0,o=r.coordinates;n<o.length;n++){var a=o[n];p(e,a,t)}return e}(e,r,t);case\"MultiPoint\":return function(e,r,t){return p(e,r.coordinates,t),e}(e,r,t);case\"MultiPolygon\":return function(e,r,t){for(var n=0,o=r.coordinates;n<o.length;n++){var a=o[n];f(e,a[0],t);for(var u=1;u<a.length;u++)d(e,a[u],t)}return e}(e,r,t);case\"Point\":return function(e,r,t){return y(e,r.coordinates,t),e}(e,r,t);case\"Polygon\":return function(e,r,t){var n=r.coordinates;f(e,n[0],t);for(var o=1;o<n.length;o++)d(e,n[o],t);return e}(e,r,t)}}(new a.default,c,r):null,h)]));case 2:return t.sent(),[3,1];case 3:return[2]}}))}function l(e){for(var r=0,t=0;t<e.length;t++){var n=e[t],o=e[(t+1)%e.length];r+=n[0]*o[1]-o[0]*n[1]}return r<=0}function c(e){var r=e[0],t=e[e.length-1];return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]||e.push(r),e}function f(e,r,t){var n=c(r);l(n)?p(e,n,t):g(e,n,t)}function d(e,r,t){var n=c(r);l(n)?g(e,n,t):p(e,n,t)}function p(e,r,t){for(var n=0,o=r;n<o.length;n++){y(e,o[n],t)}e.lengths.push(r.length)}function g(e,r,t){for(var n=r.length-1;n>=0;n--)y(e,r[n],t);e.lengths.push(r.length)}function y(e,r,t){var n=r[0],o=r[1],a=r[2];e.coords.push(n,o),t.hasZ&&e.coords.push(a||0)}function v(e){switch(typeof e){case\"string\":return\"esriFieldTypeString\";case\"number\":return\"esriFieldTypeDouble\";default:return\"unknown\"}}r.validateGeoJSON=function(e){if(!e)throw new n(\"geojson-layer:empty\",\"GeoJSON data is empty\");if(\"Feature\"!==e.type&&\"FeatureCollection\"!==e.type)throw new n(\"geojson-layer:unsupported-geojson-object\",\"missing or not supported GeoJSON object type\",{data:e});var r=e.crs;if(r){var t=\"string\"==typeof r?r:\"name\"===r.type?r.properties.name:null,o=new RegExp(\".*(CRS84H?|4326)$\",\"i\");if(!t||!o.test(t))throw new n(\"geojson-layer:unsupported-crs\",\"unsupported GeoJSON \\'crs\\' member\",{crs:r})}},r.inferLayerProperties=function(e,r){void 0===r&&(r={});for(var n=i(e),o=[],a=new Set,s=new Set,l=!1,c=Number.NEGATIVE_INFINITY,f=null,d=!1,p=void 0,g=r.geometryType,y=void 0===g?null:g,h=!1,m=function(){var e,r,i=n.next(),g=i.value;if(i.done){var m=f&&1===f.length&&f[0]||null;if(m)for(var b=0,w=o;b<w.length;b++){var P=w[b];P.name===m&&(P.type=\"esriFieldTypeOID\")}return{value:{fields:o,geometryType:y,hasZ:l,maxObjectId:Math.max(0,c),objectIdFieldName:m,objectIdFieldType:p,unknownFields:(e=s,r=[],e.forEach((function(e){return r.push(e)})),r)}}}var _=g.geometry,F=g.properties,S=g.id;if(_&&(y||(y=u[_.type]),u[_.type]!==y))return\"continue\";if(!l){var j=function(e){var r,n,o,a,u,i,s,l,c;return t.__generator(this,(function(f){switch(f.label){case 0:if(!e)return[2,null];switch(e.type){case\"Point\":return[3,1];case\"LineString\":case\"MultiPoint\":return[3,3];case\"MultiLineString\":case\"Polygon\":return[3,5];case\"MultiPolygon\":return[3,10]}return[3,17];case 1:return[4,e.coordinates];case 2:return f.sent(),[3,17];case 3:return[5,t.__values(e.coordinates)];case 4:return f.sent(),[3,17];case 5:r=0,n=e.coordinates,f.label=6;case 6:return r<n.length?(o=n[r],[5,t.__values(o)]):[3,9];case 7:f.sent(),f.label=8;case 8:return r++,[3,6];case 9:return[3,17];case 10:a=0,u=e.coordinates,f.label=11;case 11:if(!(a<u.length))return[3,16];i=u[a],s=0,l=i,f.label=12;case 12:return s<l.length?(c=l[s],[5,t.__values(c)]):[3,15];case 13:f.sent(),f.label=14;case 14:return s++,[3,12];case 15:return a++,[3,11];case 16:return[3,17];case 17:return[2]}}))}(_);l=function(e){for(;;){var r=e.next(),t=r.value;if(r.done)return!1;if(t.length>2)return!0}}(j)}if(d||(d=null!=S)&&\"number\"===(p=typeof S)&&(f=Object.keys(F).filter((function(e){return F[e]===S}))),d&&\"number\"===p&&null!=S&&(c=Math.max(c,S),f.length>1?f=f.filter((function(e){return F[e]===S})):1===f.length&&(f=F[f[0]]===S?f:[])),!h&&F){var M=!0;for(var G in F)if(!a.has(G)){var O=F[G];if(null!=O){var N=v(O);\"unknown\"!==N?(s.delete(G),a.add(G),o.push({name:G,alias:G,type:N})):s.add(G)}else M=!1,s.add(G)}h=M}};;){var b=m();if(\"object\"==typeof b)return b.value}},r.createOptimizedFeatures=function(e,r){return function(e){for(var r=[];;){var t=e.next(),n=t.value;if(t.done)return r;r.push(n)}}(s(i(e),r))}}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/layers/graphics/sources/geojson/geojson.js?')},\"./node_modules/arcgis-js-api/layers/graphics/sources/support/clientSideDefaults.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports,__webpack_require__(/*! tslib */ \"./node_modules/tslib/tslib.js\"),__webpack_require__(/*! ../../../../core/has */ \"./node_modules/arcgis-js-api/core/has.js\"),__webpack_require__(/*! ../../../../core/lang */ \"./node_modules/arcgis-js-api/core/lang.js\"),__webpack_require__(/*! ../../../../symbols/support/defaultsJSON */ \"./node_modules/arcgis-js-api/symbols/support/defaultsJSON.js\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(e,t,r,n,i,o){Object.defineProperty(t,\"__esModule\",{value:!0}),t.createDrawingInfo=function(e){return{renderer:{type:\"simple\",symbol:\"esriGeometryPoint\"===e||\"esriGeometryMultipoint\"===e?o.defaultPointSymbolJSON:\"esriGeometryPolyline\"===e?o.defaultPolylineSymbolJSON:o.defaultPolygonSymbolJSON}}},t.createDefaultAttributesFunction=function(e,t){if(n(\"csp-restrictions\"))return function(){var n;return r.__assign(((n={})[t]=null,n),e)};try{var i=\"this.\"+t+\" = null;\";for(var o in e)i+=\"this.\"+o+\" = \"+JSON.stringify(e[o])+\";\";var u=new Function(i);return function(){return new u}}catch(n){return function(){var n;return r.__assign(((n={})[t]=null,n),e)}}},t.createDefaultTemplate=function(e){return void 0===e&&(e={}),[{name:\"New Feature\",description:\"\",prototype:{attributes:i.clone(e)}}]}}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/layers/graphics/sources/support/clientSideDefaults.js?')},\"./node_modules/arcgis-js-api/layers/ogc/ogcFeatureUtils.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports,__webpack_require__(/*! tslib */ \"./node_modules/tslib/tslib.js\"),__webpack_require__(/*! ../../request */ \"./node_modules/arcgis-js-api/request.js\"),__webpack_require__(/*! ../../core/arrayUtils */ \"./node_modules/arcgis-js-api/core/arrayUtils.js\"),__webpack_require__(/*! ../../core/Error */ \"./node_modules/arcgis-js-api/core/Error.js\"),__webpack_require__(/*! ../../core/Logger */ \"./node_modules/arcgis-js-api/core/Logger.js\"),__webpack_require__(/*! ../../geometry/support/spatialReferenceUtils */ \"./node_modules/arcgis-js-api/geometry/support/spatialReferenceUtils.js\"),__webpack_require__(/*! ../graphics/featureConversionUtils */ \"./node_modules/arcgis-js-api/layers/graphics/featureConversionUtils.js\"),__webpack_require__(/*! ../graphics/OptimizedFeatureSet */ \"./node_modules/arcgis-js-api/layers/graphics/OptimizedFeatureSet.js\"),__webpack_require__(/*! ../graphics/data/projectionSupport */ \"./node_modules/arcgis-js-api/layers/graphics/data/projectionSupport.js\"),__webpack_require__(/*! ../graphics/data/projectionSupport */ \"./node_modules/arcgis-js-api/layers/graphics/data/projectionSupport.js\"),__webpack_require__(/*! ../graphics/sources/geojson/geojson */ \"./node_modules/arcgis-js-api/layers/graphics/sources/geojson/geojson.js\"),__webpack_require__(/*! ../graphics/sources/support/clientSideDefaults */ \"./node_modules/arcgis-js-api/layers/graphics/sources/support/clientSideDefaults.js\"),__webpack_require__(/*! ../support/FieldsIndex */ \"./node_modules/arcgis-js-api/layers/support/FieldsIndex.js\"),__webpack_require__(/*! ../support/fieldType */ \"./node_modules/arcgis-js-api/layers/support/fieldType.js\"),__webpack_require__(/*! ../../tasks/support/FeatureSet */ \"./node_modules/arcgis-js-api/tasks/support/FeatureSet.js\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(e,t,r,i,n,a,o,l,s,u,d,c,f,m,g,p,y){Object.defineProperty(t,\"__esModule\",{value:!0});var h=o.getLogger(\"esri.layers.graphics.sources.ogcfeature\");function F(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,v(e,t,i)];case 1:return n=r.sent(),[2,s.convertToFeatureSet(n)]}}))}))}function v(e,t,n){var a;return r.__awaiter(this,void 0,void 0,(function(){var o,m,g,p,y,h,F,v,b,w,_,I,T,S,j,q,k,O,x,D,G,N,C,Z,L,P,R,W,J,z,E,M,U;return r.__generator(this,(function(B){switch(B.label){case 0:return o=e.capabilities.query.maxRecordCount,m=e.collectionId,g=e.layerDefinition,p=e.url,y=p+\"/collections/\"+m+\"/items\",h=t.geometry,F=t.num,v=t.outSpatialReference,b=t.start,w=t.timeExtent,_=t.where,I=c.project(h,l.WGS84),T=function(e){if(!e)return null;var t=e.xmin,r=e.ymin,i=e.xmax,n=e.ymax;return t+\",\"+r+\",\"+i+\",\"+n}(I),S=function(e){if(!e)return null;var t=e.start,r=e.end;return(t?t.toISOString():\"..\")+\"/\"+(r?r.toISOString():\"..\")}(w),j=function(e){if(!e||\"1=1\"===e)return null;return e}(_),q=null!=b?b:0,k=null!=F?F:null!=b&&void 0!==b?10:o,[4,i(y,r.__assign(r.__assign({},n),{query:{bbox:T,datetime:S,query:j,limit:k,startindex:q,f:\"application/geo+json\"}}))];case 1:if(O=B.sent().data,x=null===(a=O.links)||void 0===a?void 0:a.filter((function(e){return\"next\"===e.rel})),D=0!==(null==x?void 0:x.length),G=g.fields,N=g.globalIdField,C=g.hasM,Z=g.hasZ,L=g.objectIdField,P=g.geometryType,R=f.createOptimizedFeatures(O,{geometryType:P,hasZ:Z,objectIdFieldName:L}),!l.equals(v,l.WGS84))for(W=0,J=R;W<J.length;W++)(M=J[W]).geometry&&(M.geometry=s.convertFromGeometry(d.project(s.convertToGeometry(M.geometry,P,Z,!1),l.WGS84,v)));for(z=0,E=R;z<E.length;z++)(M=E[z]).objectId=M.attributes[L];return(U=new u.default).exceededTransferLimit=D,U.features=R,U.fields=G,U.geometryType=P,U.globalIdFieldName=N,U.hasM=C,U.hasZ=Z,U.objectIdFieldName=L,U.spatialReference=v||l.WGS84,[2,U]}}))}))}t.getCollectionDefinition=function(e,t,o,s,u){return void 0===u&&(u=5),r.__awaiter(this,void 0,void 0,(function(){var c,y,F,v,b,w,_,I,T,S,j,q,k,O,x;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,d.checkProjectionSupport(l.WGS84,o.spatialReference)];case 1:return r.sent(),[3,3];case 2:throw r.sent(),new a(\"ogc-feature-layer:projection-not-supported\",\"Projection not supported\");case 3:return[4,i(e+\"/collections/\"+t+\"/items\",{signal:s,query:{limit:u,f:\"application/geo+json\"}})];case 4:return c=r.sent().data,[4,f.validateGeoJSON(c)];case 5:if(r.sent(),y=f.inferLayerProperties(c,{geometryType:o.geometryType}),F=o.fields||y.fields||[],v=null!=o.hasZ?o.hasZ:y.hasZ,b=y.geometryType,w=o.objectIdField||y.objectIdFieldName||\"OBJECTID\",_=o.timeInfo,I=n.find(F,(function(e){return e.name===w})),!I){if(!y.objectIdFieldType)throw new a(\"ogc-feature-layer:missing-feature-id\",\"Collection geojson require a feature id as a unique identifier\");F.unshift({name:w,alias:w,type:\"esriFieldTypeOID\",editable:!1,nullable:!1})}else I.type=\"esriFieldTypeOID\",I.editable=!1,I.nullable=!1;if(w!==y.objectIdFieldName&&(j=n.find(F,(function(e){return e.name===y.objectIdFieldName})))&&(j.type=\"esriFieldTypeInteger\"),!b)throw new a(\"ogc-feature-layer:missing-property\",\"geometryType not set and couldn\\'t be inferred from the provided features\");for(F===y.fields&&y.unknownFields.length>0&&h.warn({name:\"ogc-feature-layer:unknown-field-types\",message:\"Some fields types couldn\\'t be inferred from the features and were dropped\",details:{unknownFields:y.unknownFields}}),T=0,S=F;T<S.length;T++){if(null==(j=S[T]).name&&(j.name=j.alias),null==j.alias&&(j.alias=j.name),\"esriFieldTypeOID\"!==j.type&&\"esriFieldTypeGlobalID\"!==j.type&&(j.editable=null==j.editable||!!j.editable,j.nullable=null==j.nullable||!!j.nullable),!j.name)throw new a(\"ogc-feature-layer:invalid-field-name\",\"field name is missing\",{field:j});if(-1===p.kebabDict.jsonValues.indexOf(j.type))throw new a(\"ogc-feature-layer:invalid-field-type\",\\'invalid type for field \"\\'+j.name+\\'\"\\',{field:j})}return _&&(q=new g(F),_.startTimeField&&((k=q.get(_.startTimeField))?(_.startTimeField=k.name,k.type=\"esriFieldTypeDate\"):_.startTimeField=null),_.endTimeField&&((O=q.get(_.endTimeField))?(_.endTimeField=O.name,O.type=\"esriFieldTypeDate\"):_.endTimeField=null),_.trackIdField&&((x=q.get(_.trackIdField))?_.trackIdField=x.name:(_.trackIdField=null,h.warn({name:\"ogc-feature-layer:invalid-timeInfo-trackIdField\",message:\"trackIdField is missing\",details:{timeInfo:_}}))),_.startTimeField||_.endTimeField||(h.warn({name:\"ogc-feature-layer:invalid-timeInfo\",message:\"startTimeField and endTimeField are missing\",details:{timeInfo:_}}),_=null)),[2,{drawingInfo:m.createDrawingInfo(b),geometryType:b,fields:F,hasZ:!!v,objectIdField:w,timeInfo:_}]}}))}))},t.getServerCollection=function(e,t,n,a){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i(e+\"/collections/\"+t,{signal:a,query:{f:n}})];case 1:return[2,r.sent().data]}}))}))},t.getServerCollections=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i(e+\"/collections\",{signal:n,query:{f:t}})];case 1:return[2,r.sent().data]}}))}))},t.getServerConformance=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i(e+\"/conformance\",{signal:n,query:{f:t}})];case 1:return[2,r.sent().data]}}))}))},t.getServerLandingPage=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i(e,{signal:n,query:{f:t}})];case 1:return[2,r.sent().data]}}))}))},t.queryFeatureSet=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,F(e,t,i)];case 1:return n=r.sent(),[2,y.fromJSON(n)]}}))}))},t.queryFeatureSetJSON=F,t.queryOptimizedFeatureSet=v}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/layers/ogc/ogcFeatureUtils.js?')},\"./node_modules/arcgis-js-api/views/2d/layers/features/controllers/EditsQueue.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports,__webpack_require__(/*! tslib */ \"./node_modules/tslib/tslib.js\"),__webpack_require__(/*! ../../../../../core/Accessor */ \"./node_modules/arcgis-js-api/core/Accessor.js\"),__webpack_require__(/*! ../../../../../core/promiseUtils */ \"./node_modules/arcgis-js-api/core/promiseUtils.js\"),__webpack_require__(/*! ../../../../../core/accessorSupport/decorators */ \"./node_modules/arcgis-js-api/core/accessorSupport/decorators.js\"),__webpack_require__(/*! @dojo/framework/shim/Promise */ \"./node_modules/@dojo/framework/shim/Promise.js\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(e,t,r,o,n,s){Object.defineProperty(t,\"__esModule\",{value:!0});var i=function(e){function t(t){var r=e.call(this,t)||this;return r._queue=[],r._onGoingRequest=null,r._abortController=n.createAbortController(),r}return r.__extends(t,e),t.prototype.destroy=function(){this.clear()},Object.defineProperty(t.prototype,\"updating\",{get:function(){return!this.destroyed&&(this._queue.length>0||null!=this._onGoingRequest)},enumerable:!0,configurable:!0}),t.prototype.clear=function(){if(this.destroyed)throw new Error(\"instance is already destroyed\");for(var e=this._queue.pop();e;)e.resolver.reject(n.createAbortError()),e=this._queue.pop();this._queue.length=0,this._abortController.abort(),this._abortController=n.createAbortController()},t.prototype.push=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,o=this;return r.__generator(this,(function(r){if(this.destroyed)throw new Error(\"instance is already destroyed\");return t=n.createResolver(),this._queue.push({event:e,resolver:t}),this.notifyChange(\"updating\"),Promise.resolve().then((function(){o._processNext()})),[2,t.promise]}))}))},t.prototype._processNext=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,o,n,s,i,u,a,c,d,h,l,p,f,_,g,y,v,b,q,w,E,C=this;return r.__generator(this,(function(r){switch(r.label){case 0:if(this._onGoingRequest)return[2];for(e=[],t=new Set,o=new Set,n=new Set,s=this._queue.shift();s;){for(i=s.event,u=i.addedFeatures,a=i.deletedFeatures,c=i.updatedFeatures,d=s.resolver,e.push(d),h=0,l=u;h<l.length;h++)p=l[h],q=p.objectId,p.error||(t.add(q),o.add(q),n.delete(q));for(f=0,_=c;f<_.length;f++)g=_[f],q=g.objectId,g.error||(o.add(q),n.delete(q));for(y=0,v=a;y<v.length;y++)b=v[y],q=b.objectId,b.error||(t.has(q)?t.delete(q):n.add(q),o.delete(q));s=this._queue.shift()}return o.size||n.size?(w=[],E=[],o.size&&o.forEach((function(e){w.push(e)})),n.size&&n.forEach((function(e){E.push(e)})),this._onGoingRequest=Promise.resolve().then((function(){return C.processEdits(w,E,{signal:C._abortController.signal})})).catch((function(){})),this.notifyChange(\"updating\"),[4,this._onGoingRequest]):(this.notifyChange(\"updating\"),e.forEach((function(e){return e()})),[2]);case 1:return r.sent(),this._onGoingRequest=null,this.notifyChange(\"updating\"),e.forEach((function(e){return e()})),this._queue.length>0&&this._processNext(),[2]}}))}))},r.__decorate([s.property({constructOnly:!0})],t.prototype,\"processEdits\",void 0),r.__decorate([s.property({readOnly:!0})],t.prototype,\"updating\",null),t=r.__decorate([s.subclass(\"esri.views.2d.layers.features.controllers.EditsQueue\")],t)}(o);t.EditsQueue=i}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/views/2d/layers/features/controllers/EditsQueue.js?')},\"./node_modules/arcgis-js-api/views/2d/layers/features/controllers/OnDemandController.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports,__webpack_require__(/*! tslib */ \"./node_modules/tslib/tslib.js\"),__webpack_require__(/*! ../../../../../core/ArrayPool */ \"./node_modules/arcgis-js-api/core/ArrayPool.js\"),__webpack_require__(/*! ../../../../../core/Error */ \"./node_modules/arcgis-js-api/core/Error.js\"),__webpack_require__(/*! ../../../../../core/has */ \"./node_modules/arcgis-js-api/core/has.js\"),__webpack_require__(/*! ../../../../../core/Logger */ \"./node_modules/arcgis-js-api/core/Logger.js\"),__webpack_require__(/*! ../../../../../core/promiseUtils */ \"./node_modules/arcgis-js-api/core/promiseUtils.js\"),__webpack_require__(/*! ../../../../../core/watchUtils */ \"./node_modules/arcgis-js-api/core/watchUtils.js\"),__webpack_require__(/*! ../../../../../core/workers */ \"./node_modules/arcgis-js-api/core/workers.js\"),__webpack_require__(/*! ../../../../../core/accessorSupport/decorators */ \"./node_modules/arcgis-js-api/core/accessorSupport/decorators.js\"),__webpack_require__(/*! ../../../../../geometry/Extent */ \"./node_modules/arcgis-js-api/geometry/Extent.js\"),__webpack_require__(/*! ../../../../../geometry/support/jsonUtils */ \"./node_modules/arcgis-js-api/geometry/support/jsonUtils.js\"),__webpack_require__(/*! ../../../../../layers/graphics/featureConversionUtils */ \"./node_modules/arcgis-js-api/layers/graphics/featureConversionUtils.js\"),__webpack_require__(/*! ../../../../../layers/ogc/ogcFeatureUtils */ \"./node_modules/arcgis-js-api/layers/ogc/ogcFeatureUtils.js\"),__webpack_require__(/*! ../../../../../tasks/operations/query */ \"./node_modules/arcgis-js-api/tasks/operations/query.js\"),__webpack_require__(/*! ../../../../../tasks/support/QuantizationParameters */ \"./node_modules/arcgis-js-api/tasks/support/QuantizationParameters.js\"),__webpack_require__(/*! ../../../engine */ \"./node_modules/arcgis-js-api/views/2d/engine.js\"),__webpack_require__(/*! ./BaseController */ \"./node_modules/arcgis-js-api/views/2d/layers/features/controllers/BaseController.js\"),__webpack_require__(/*! ./EditsQueue */ \"./node_modules/arcgis-js-api/views/2d/layers/features/controllers/EditsQueue.js\"),__webpack_require__(/*! ../support/DataTile */ \"./node_modules/arcgis-js-api/views/2d/layers/features/support/DataTile.js\"),__webpack_require__(/*! ../support/DataTileFeaturesIndex */ \"./node_modules/arcgis-js-api/views/2d/layers/features/support/DataTileFeaturesIndex.js\"),__webpack_require__(/*! ../support/Tile */ \"./node_modules/arcgis-js-api/views/2d/layers/features/support/Tile.js\"),__webpack_require__(/*! ../support/TileUpdateQueue */ \"./node_modules/arcgis-js-api/views/2d/layers/features/support/TileUpdateQueue.js\"),__webpack_require__(/*! ../../../tiling/TileQueue */ \"./node_modules/arcgis-js-api/views/2d/tiling/TileQueue.js\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(e,t,r,i,n,s,a,o,u,c,l,d,h,f,p,_,y,g,v,b,m,S,I,T,w){Object.defineProperty(t,\"__esModule\",{value:!0});var x=a.getLogger(\"esri.views.2d.layers.features.controllers.OnDemandController\"),Q=s(\"esri-featurelayer-webgl\"),F=s(\"esri-mobile\"),E={maxDrillLevel:Q&&\"object\"==typeof Q&&null!=Q.maxDrillLevel?Q.maxDrillLevel:F?1:4,maxRecordCountFactor:Q&&\"object\"==typeof Q&&null!=Q.maxRecordCountFactor?Q.maxRecordCountFactor:F?1:3,enablePBFQuery:!Q||\"object\"!=typeof Q||null==Q.enablePBFQuery||Q.enablePBFQuery},C=new Set,O=[],q=function(){function e(e,t){var r=this;this.objectIdField=t,c.openWithPorts(e).then((function(e){return r.client=e}))}return e.prototype.destroy=function(){this.client.close(),this.client=null},e.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.client.invoke(\"queryFeatures\",e.toJSON(),t)];case 1:return i=r.sent(),[2,f.convertFromFeatureSet(i,this.objectIdField)]}}))}))},e}(),j=function(){function e(e,t){this.source=e,this.sourceSpatialReference=t}return e.prototype.destroy=function(){},e.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,_.executeQueryPBF(this.source,e,{type:\"optimized\",sourceSpatialReference:this.sourceSpatialReference},t)];case 1:return[2,r.sent().data]}}))}))},e}(),P=function(){function e(e,t,r){this.source=e,this.objectIdField=t,this.sourceSpatialReference=r}return e.prototype.destroy=function(){},e.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,_.executeQuery(this.source,e,this.sourceSpatialReference,t)];case 1:return i=r.sent().data,[2,f.convertFromFeatureSet(i,this.objectIdField)]}}))}))},e}(),A=function(){function e(e,t){this.source=e,this.objectIdField=t}return e.prototype.destroy=function(){},e.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,p.queryOptimizedFeatureSet(this.source,e,t)]}))}))},e}(),D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=\"on-demand\",t._queryInfoHash=null,t._dataTileIndex=new S.default,t._editsQueue=new b.EditsQueue({processEdits:t._processEdits.bind(t)}),t._featuresInFlight=new Map,t.service=null,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this,t=this._createFeatureStore();t.onFeatureAdd=this.onFeatureAdd.bind(this),t.onFeatureRemove=this.onFeatureRemove.bind(this),this._set(\"featureStore\",t),this._dataTileIndex.featureStore=this.featureStore,this._dataTileIndex.forEach((function(e){return e.done=!1})),this._fetchQueue=new w({concurrency:10,strategy:\"center-first\",tileInfoView:this.tileStore.tileScheme,process:function(t,i){return r.__awaiter(e,void 0,void 0,(function(){var e;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._fetchTile(t,this.queryInfo,i)];case 1:return e=r.sent(),[2,{dataTile:t,featureSet:e}]}}))}))}}),this._patchQueue=new w({concurrency:10,strategy:\"center-first\",tileInfoView:this.tileStore.tileScheme,process:function(t,r){return e._fetchTile(t.dataTile,t.queryInfo,r)}}),this._updateQueue=new T.default({tileInfoView:this.tileStore.tileScheme,process:function(t,r,i){return e._updateTile(t,r,i)}});var i,n=this.service,s=n.capabilities,a=n.source,o=n.objectIdField,u=n.spatialReference;(i=a)&&i.capabilities&&i.collectionId&&i.layerDefinition&&i.url?this.sourceAdapter=new A(a,o):Array.isArray(a)?this.sourceAdapter=new q(a,o):E.enablePBFQuery&&s.query.supportsFormatPBF?this.sourceAdapter=new j(a,u):this.sourceAdapter=new P(a,o,u),this.handles.add([this.watch(\"updating\",(function(t){return!t&&e.onIdle()}))]),this.featureStore.events.on(\"valueRangesChanged\",(function(t){e.remoteClient.invoke(\"emitEvent\",{name:\"valueRangesChanged\",event:{valueRanges:t.valueRanges}})}))},t.prototype.destroy=function(){this._fetchQueue.clear(),this._patchQueue.clear(),this._updateQueue.clear(),this._editsQueue.destroy(),this.queryEngine.destroy(),this.sourceAdapter.destroy()},Object.defineProperty(t.prototype,\"queryEngine\",{get:function(){return this._createQueryEngine(this.featureStore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"updating\",{get:function(){return!this.viewState||this._fetchQueue.updating||this._patchQueue.updating||this._updateQueue.updating||this._editsQueue.updating},enumerable:!0,configurable:!0}),t.prototype.update=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s,a,o,u,c=this;return r.__generator(this,(function(r){switch(r.label){case 0:return this.validateConfig(e),i=JSON.stringify(this.config.filters),n=this.renderer.getAttributeHash(),s=e.availableFields.filter((function(e){return-1===c.availableFields.indexOf(e)})),a=this.config.definitionExpression,this._set(\"config\",e),a!==this.config.definitionExpression&&this._set(\"queryEngine\",this._createQueryEngine(this.featureStore)),[4,this.updatePixelBuffer()];case 1:return r.sent(),o=i!==JSON.stringify(e.filters),u=n!==this.renderer.getAttributeHash(),t?u?[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)]:[3,3]:[3,6];case 2:r.sent(),r.label=3;case 3:return[4,this.attributeStore.updateFilters(this)];case 4:return r.sent(),[4,this.featureStore.update(o,e,this.service.fields)];case 5:return r.sent(),this.refresh(),[2];case 6:return s.length?[4,this._handleAttributeChange(s)]:[3,8];case 7:r.sent(),r.label=8;case 8:return\"heatmap\"===this.renderer.type?[2]:u?[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)]:[3,10];case 9:r.sent(),this.featureStore.forEach((function(e){return c.attributeStore.setAttributeData(e.localId,e,c.geometryInfo,c.viewParams)})),r.label=10;case 10:return[4,this.attributeStore.updateFilters(this)];case 11:return r.sent(),[4,this.featureStore.update(o,e,this.service.fields)];case 12:return r.sent(),[4,this.attributeStore.sendUpdates()];case 13:return r.sent(),[2]}}))}))},t.prototype.invalidate=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i;return r.__generator(this,(function(r){for(e=0,t=this.tileStore.tiles;e<t.length;e++)i=t[e],this._updateQueue.push(i.id,Date.now());return[2]}))}))},t.prototype.onIdle=function(){this.featureStore.sweepClusters()},t.prototype.onEdits=function(e){var t=this;return this._fetchQueue.pause(),this._fetchQueue.reset(),this._editsQueue.push(e).then((function(){t._editsQueue.updating||t._fetchQueue.resume()}))},t.prototype.queryFeatures=function(e){return this.queryEngine.executeQuery(e)},t.prototype.queryFeatureCount=function(e){return this.queryEngine.executeQueryForCount(e)},t.prototype.queryObjectIds=function(e){return this.queryEngine.executeQueryForIds(e)},t.prototype.queryExtent=function(e){return this.queryEngine.executeQueryForExtent(e)},t.prototype.queryStatistics=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n=this;return r.__generator(this,(function(s){switch(s.label){case 0:return e=0,t=0,i=0,[4,o.all(this.tileStore.tiles.map((function(s){return r.__awaiter(n,void 0,void 0,(function(){var n,a,o,u,c,l,d,f,p,_,y;return r.__generator(this,(function(r){switch(r.label){case 0:return n=this.queryInfo,a=n.returnCentroid,o=n.returnGeometry,u=this._pixelBuffer,c={pixelBuffer:u,returnGeometry:o,returnCentroid:a,returnOutline:this.returnOutline},l=performance.now(),[4,this.featureStore.executeTileQuery(s,this.spatialReference,c)];case 1:for(d=r.sent().features,f=performance.now(),i+=f-l,e+=d.length,p=0,_=d;p<_.length;p++)(y=_[p]).geometry&&(h.isPolygon(y.geometry)?t+=y.geometry.rings.reduce((function(e,t){return e+t.length}),0):h.isPolyline(y.geometry)&&(t+=y.geometry.paths.reduce((function(e,t){return e+t.length}),0)));return[2]}}))}))})))];case 1:return s.sent(),[2,r.__assign(r.__assign({},this.featureStore.storeStatistics),{displayedFeatureCount:e,displayedVertexCount:t,displayPreProcessTime:i})]}}))}))},t.prototype.refresh=function(){return r.__awaiter(this,void 0,void 0,(function(){var e=this;return r.__generator(this,(function(t){switch(t.label){case 0:return this._queryInfoHash=Math.random().toString(),this._dataTileIndex.clear(),this._fetchQueue.pause(),this._updateQueue.pause(),this._editsQueue.clear(),this._fetchQueue.clear(),[4,u.whenFalseOnce(this._fetchQueue,\"updating\")];case 1:return t.sent(),this._updateQueue.clear(),[4,u.whenFalseOnce(this._updateQueue,\"updating\")];case 2:return t.sent(),this.featureStore.startMarkingUsedFeatures(),this._manageTiles(this.tileStore.tiles),this._fetchQueue.resume(),[4,u.whenFalseOnce(this._fetchQueue,\"updating\")];case 3:return t.sent(),this.featureStore.sweep(),this.featureStore.forEach((function(t){return e.attributeStore.setAttributeData(t.localId,t,e.geometryInfo,e.viewParams)})),this.attributeStore.sendUpdates(),this._updateQueue.resume(),[2]}}))}))},t.prototype.setViewState=function(t){var r=this,i=this.viewState&&this.viewState.scale;e.prototype.setViewState.call(this,t),this._fetchQueue.state=t,this._updateQueue.state=t,i!==this.viewState.scale&&this.attributeStore.hasScaleExpr&&(this.featureStore.forEach((function(e){return r.attributeStore.setAttributeData(e.localId,e,r.geometryInfo,r.viewParams)})),this.attributeStore.sendUpdates()),this.featureStore.setScale(this.viewState.scale)},t.prototype.getAggregate=function(e){return this.featureStore.getAggregate(e)},t.prototype.getAggregateValueRanges=function(){return this.featureStore.getAggregateValueRanges()},t.prototype.onTileUpdate=function(e){this._manageTiles(e.added,e.removed),this.featureStore.onTileUpdate(e)},t.prototype.onFeatureAdd=function(e){if(this._featuresInFlight.has(e.objectId)){var t=this._featuresInFlight.get(e.objectId).attributes;e.attributes=r.__assign(r.__assign({},t),e.attributes),this._featuresInFlight.delete(e.objectId)}e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},t.prototype._handleAttributeChange=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this._fetchChangedFields(e)];case 1:return t.sent(),[2]}}))}))},t.prototype._fetchChangedTileFields=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){return(i=this._dataTileIndex.get(e.id))?(!1,[2,this._fetchChangedTileFieldsDrill(i,t)]):[2]}))}))},t.prototype._fetchChangedTileFieldsDrill=function(e,t,i){return void 0===i&&(i=0),r.__awaiter(this,void 0,void 0,(function(){var n,s,a,u,c,l,d,h,f,p,_=this;return r.__generator(this,(function(y){switch(y.label){case 0:return n=r.__assign(r.__assign({},this.queryInfo),{returnGeometry:!1,returnCentroid:!1,outFields:t.concat([this.service.objectIdField])}),e.returnExceeded=e.returnExceeded||i>=E.maxDrillLevel,s=e.key,a={key:s,dataTile:e,queryInfo:n},[4,this._patchQueue.push(a)];case 1:return(u=y.sent()).exceededTransferLimit&&i<E.maxDrillLevel?(c=e.tile.createChildTiles(),l=c.map((function(t){var r=new m.default;return r.tile=t,r.displayTile=e.displayTile,r})),[4,o.all(l.map((function(e){return _._fetchChangedTileFieldsDrill(e,t,i+1)})))]):[3,3];case 2:return y.sent(),[2];case 3:for(d=0,h=u.features;d<h.length;d++)f=h[d],this.featureStore.has(f.objectId)?(p=this.featureStore.getFeature(f.objectId)).attributes=r.__assign(r.__assign({},p.attributes),f.attributes):this._featuresInFlight.set(f.objectId,f);return[2]}}))}))},t.prototype._fetchChangedTileFieldsPaged=function(e,t,i){return void 0===i&&(i=0),r.__awaiter(this,void 0,void 0,(function(){var n,s,a,o,u,c,l,d,h,f,p;return r.__generator(this,(function(_){switch(_.label){case 0:return n=this.service.capabilities.query.supportsMaxRecordCountFactor,s=this.service.tileMaxRecordCount,a=s*(n?1:E.maxRecordCountFactor),o=r.__assign(r.__assign({},this.queryInfo),{returnGeometry:!1,returnCentroid:!1,outFields:t.concat([this.service.objectIdField]),resultOffset:i*a,num:a}),e.returnExceeded=!0,u=e.key,c={key:u,dataTile:e,queryInfo:o},[4,this._patchQueue.push(c)];case 1:for(l=_.sent(),d=0,h=l.features;d<h.length;d++)f=h[d],this.featureStore.has(f.objectId)?(p=this.featureStore.getFeature(f.objectId)).attributes=r.__assign(r.__assign({},p.attributes),f.attributes):this._featuresInFlight.set(f.objectId,f);return l.exceededTransferLimit?[2,this._fetchChangedTileFieldsPaged(e,t,i+1)]:[2]}}))}))},t.prototype._fetchChangedFields=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,n=this;return r.__generator(this,(function(r){switch(r.label){case 0:return t=this.tileStore.tiles,i=t.map((function(t){return n._fetchChangedTileFields(t,e)})),[4,o.all(i)];case 1:return r.sent(),[2]}}))}))},t.prototype._manageTiles=function(e,t){void 0===t&&(t=null);for(var r=this._dataTileIndex,i=this._fetchQueue,n=this._updateQueue,s=\"esriGeometryPoint\"===this.service.geometryType,a=function(e){var t=r.get(e.id);t?(t.displayTile=e,s?r.forEach((function(r){I.isChildOf(r,t)&&(r.displayTile=e)})):t.done=!1):((t=new m.default).tile=e.clone(),t.displayTile=e,r.add(t)),o._processDataTile(t)},o=this,u=0,c=e;u<c.length;u++){a(h=c[u])}if(t)for(var l=0,d=t;l<d.length;l++){var h=d[l];C.add(h),n.abort(h.id)}r.forEach((function(e){C.has(e.displayTile)&&O.push(e)}));for(var f=0,p=O;f<p.length;f++){var _=p[f];i.abort(_.id),r.delete(_)}O.length=0,C.clear()},t.prototype._processDataTile=function(e){var t=this,r=e.displayTile,i=e.key,s=this._dataTileIndex,a=this._fetchQueue,u=i.id,c=this._queryInfoHash,l=i.level-r.key.level>=E.maxDrillLevel;if(s.add(e),e.done||a.has(u)){if(e.queryInfoHash!==c||e.returnExceeded!==l)if(e.done)e.done=!1;else{if(!a.isOngoing(u))return e.queryInfoHash=c,void(e.returnExceeded=l);a.abort(u)}}else e.queryInfoHash=c,e.returnExceeded=l;e.done?this._invalidateTile(e.displayTile):a.has(u)||a.push(e).then((function(e){return t._handleResponse(e.dataTile,e.featureSet)})).catch((function(r){o.isAbortError(r)||(x.error(new n(\"featurelayer-controller:tile-error\",\"Encountered an error when handling tile response\",r)),e.done=!0,t._invalidateTile(e.displayTile))}))},t.prototype._handleResponse=function(e,t){if(e.done=!0,f.hydrateOptimizedFeatureSet(t),t.exceededTransferLimit)if(e.returnExceeded)this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);else{for(var r=e.tile.createChildTiles(),n=0,s=r;n<s.length;n++){var a=s[n],o=new m.default;o.tile=a,o.displayTile=e.displayTile,this._processDataTile(o)}i.release(r)}else this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);this._invalidateTile(e.tile)},t.prototype._deleteChildrenDataTiles=function(e){this._dataTileIndex.forEach((function(t){I.isChildOf(t,e)&&O.push(t)}));for(var t=0,r=O;t<r.length;t++){var i=r[t];this._fetchQueue.abort(i.id),this._dataTileIndex.delete(i)}O.length=0},t.prototype._createQuery=function(e,t,r,i,n,s){var a=this.service.geometryType,o=this._createDefaultQuery(i);return o.maxRecordCountFactor=n,o.returnExceededLimitFeatures=s,o.resultType=\"tile\",o.geometry=e,this.service.capabilities.query.supportsQuantization?(o.quantizationParameters=new y.default({mode:\"view\",originPosition:\"upper-left\",tolerance:r,extent:t}),\"esriGeometryPolyline\"===a&&(o.maxAllowableOffset=r)):\"esriGeometryPolyline\"!==a&&\"esriGeometryPolygon\"!==a||(o.maxAllowableOffset=r),o},t.prototype._fetchTile=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,s,a,o,u,c,l,h,p,_,y;return r.__generator(this,(function(r){switch(r.label){case 0:return n=new d({xmin:e.bounds[0],ymin:e.bounds[1],xmax:e.bounds[2],ymax:e.bounds[3],spatialReference:this.spatialReference}),s=this.service.geometryType,a=\"esriGeometryPoint\"===s?e.tile:e.displayTile,o=a.extent,u=a.resolution,c=e.returnExceeded,l=this._createQuery(n,o,u,t,E.maxRecordCountFactor,c),[4,this.sourceAdapter.executeQuery(l,i)];case 1:if((h=r.sent()).transform&&\"esriGeometryPolygon\"===s)for(p=0,_=h.features;p<_.length;p++)(y=_[p]).geometry=f.removeCollinearVectices(y.geometry,y.geometry,s,!1,!1);return[2,h]}}))}))},t.prototype._invalidateTile=function(e){for(var t=this._pixelBuffer,r=this._updateQueue,i=0,n=this.tileStore.intersections(e,t);i<n.length;i++){var s=n[i].tile;r.push(s.id,s.updateTimestamp)}},t.prototype._updateTile=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,s,a,u,c,l,d,h,f,p,_,y,v=this;return r.__generator(this,(function(r){switch(r.label){case 0:return n=this.tileStore.get(e),s=this.queryInfo,a=s.returnCentroid,u=s.returnGeometry,c=this._pixelBuffer,l={pixelBuffer:c,returnGeometry:u,returnCentroid:a,returnOutline:this.returnOutline},[4,this.featureStore.executeTileQuery(n,this.spatialReference,l)];case 1:return d=r.sent(),h=d.features,f=d.objectIds,[4,this.attributeStore.sendUpdates()];case 2:return r.sent(),p={geometryType:this.service.geometryType,features:h,fields:this.service.fields,objectIdFieldName:this.service.objectIdField,transform:n.transform},_=[],y=!0,this._dataTileIndex.forEach((function(e){n.id!==e.id&&I.isChildOf(e,n)&&y&&!e.done&&(y=!1)})),y&&n&&n.objectIds.forEach((function(e){if(!f.has(e)){var t=v.attributeStore.getLocalId(e);_.push(t)}})),f.forEach((function(e){n.objectIds.add(e)})),n.updateTimestamp=t,[2,this.processor.onTileData(n,{clear:!0,addOrUpdate:p.features,remove:_,transformParams:g.Utils.getTransformParams(p)},i).catch((function(e){o.isAbortError(e)||x.error(\"update-tile\",e)}))]}}))}))},t.prototype._processEdits=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,s,a,u,c,l=this;return r.__generator(this,(function(d){switch(d.label){case 0:return n=this._createTempQueryEngine(),s=this._createObjectIdsQuery(e),e.length?[4,this.sourceAdapter.executeQuery(s)]:[3,2];case 1:a=d.sent(),f.hydrateOptimizedFeatureSet(a),this._dataTileIndex.addOrUpdateFeatures(a.features),n.featureStore.addMany(a.features),d.label=2;case 2:return u=t.concat(e).map((function(e){return l.attributeStore.getLocalId(e)})),this._dataTileIndex.deleteFeaturesById(t),this.attributeStore.sendUpdates(),c=r.__assign(r.__assign({},this.queryInfo),{pixelBuffer:this._pixelBuffer,returnOutline:this.returnOutline}),this.tileStore.tiles.map((function(e){return r.__awaiter(l,void 0,void 0,(function(){var t,s;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,n.featureStore.executeTileQuery(e,this.spatialReference,c)];case 1:return t=r.sent().features,s={transform:e.transform,hasZ:!1,hasM:!1},[2,this.processor.onTileData(e,{addOrUpdate:t,remove:u,transformParams:s},i).catch((function(e){o.isAbortError(e)||x.error(\"update-tile\",e)}))]}}))}))})),n.destroy(),[2]}}))}))},t.prototype._createObjectIdsQuery=function(e){var t=this._createDefaultQuery(this.queryInfo);return t.objectIds=e,t},r.__decorate([l.property()],t.prototype,\"_fetchQueue\",void 0),r.__decorate([l.property()],t.prototype,\"_patchQueue\",void 0),r.__decorate([l.property()],t.prototype,\"_updateQueue\",void 0),r.__decorate([l.property()],t.prototype,\"_editsQueue\",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,\"featureStore\",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,\"service\",void 0),r.__decorate([l.property()],t.prototype,\"sourceAdapter\",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:[\"featureStore\",\"service\"]})],t.prototype,\"queryEngine\",null),r.__decorate([l.property({dependsOn:[\"viewState\",\"_fetchQueue.updating\",\"_updateQueue.updating\",\"_patchQueue.updating\",\"_editsQueue.updating\"]})],t.prototype,\"updating\",null),t=r.__decorate([l.subclass(\"esri.views.2d.layers.features.controllers.OnDemandController\")],t)}(v.default);t.default=D}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/views/2d/layers/features/controllers/OnDemandController.js?')},\"./node_modules/arcgis-js-api/views/2d/layers/features/support/DataTile.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports], __WEBPACK_AMD_DEFINE_RESULT__ = (function(e,t){Object.defineProperty(t,\"__esModule\",{value:!0});var n=function(){function e(){this.displayTile=null,this.tile=null,this.done=!1,this.queryInfoHash=null,this.returnExceeded=!1}return Object.defineProperty(e.prototype,\"key\",{get:function(){return this.tile.key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"id\",{get:function(){return this.tile.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"bounds\",{get:function(){return this.tile.bounds},enumerable:!0,configurable:!0}),e}();t.default=n}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/views/2d/layers/features/support/DataTile.js?')},\"./node_modules/arcgis-js-api/views/2d/layers/features/support/DataTileFeaturesIndex.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports,__webpack_require__(/*! ../../../../../core/SetPool */ \"./node_modules/arcgis-js-api/core/SetPool.js\"),__webpack_require__(/*! ../../../../../layers/graphics/data/FeatureStore */ \"./node_modules/arcgis-js-api/layers/graphics/data/FeatureStore.js\"),__webpack_require__(/*! ./Tile */ \"./node_modules/arcgis-js-api/views/2d/layers/features/support/Tile.js\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(e,t,r,i,a){Object.defineProperty(t,\"__esModule\",{value:!0});var s=[],o=new Set,n=function(){function e(){this._tileById=new Map,this._tilesToFeatures=new Map,this._featureToTiles=new Map}return e.prototype.destroy=function(){this.clear()},e.prototype.add=function(e){var t=this;if(!this.has(e.id)){var i=e;this._tileById.set(i.id,i),this._tilesToFeatures.set(i,r.default.acquire()),this._tilesToFeatures.forEach((function(e,r){i!==r&&(a.isParentOf(i,r)?e.forEach((function(e){t._link(i,e)})):a.isChildOf(i,r)&&t.featureStore.forEachInBounds(i.bounds,(function(r){e.has(r.objectId)&&t._link(i,r.objectId)})))}))}},e.prototype.clear=function(){this._tilesToFeatures.forEach((function(e){return r.default.release(e)})),this._tilesToFeatures.clear(),this._featureToTiles.forEach((function(e){return r.default.release(e)})),this._featureToTiles.clear(),this._tileById.clear()},e.prototype.delete=function(e){var t=this,r=this.get(e.id);s.length=0,this._tilesToFeatures.get(r).forEach((function(e){var i=t._featureToTiles.get(e);i.has(r)&&1===i.size?s.push(e):t._unlink(r,e)}));for(var i=0,a=s;i<a.length;i++){var o=a[i];this._unlink(r,o)}this.featureStore.removeManyById(s),this._tilesToFeatures.delete(r),this._tileById.delete(r.id),s.length=0},e.prototype.forEach=function(e,t){return this._tileById.forEach(e,t)},e.prototype.get=function(e){return this._tileById.get(e)},e.prototype.has=function(e){return this._tileById.has(e)},e.prototype.setTileFeatures=function(e,t){var i=this,a=this.get(e.id);this._tilesToFeatures.has(a)||(this._tileById.set(a.id,a),this._tilesToFeatures.set(a,r.default.acquire()));for(var n=0,u=t;n<u.length;n++){var h=u[n];o.add(h.objectId)}s.length=0,this._tilesToFeatures.get(a).forEach((function(e){if(!o.has(e)){var t=i._featureToTiles.get(e);t.has(a)&&1===t.size?s.push(e):i._unlink(a,e)}}));for(var l=0,f=s;l<f.length;l++){var d=f[l];this._unlink(a,d)}this.featureStore.removeManyById(s),this.featureStore.addMany(t),o.forEach((function(e){i._link(a,e)})),o.clear(),s.length=0},e.prototype.addOrUpdateFeatures=function(e){for(var t=this,r=new Set,a=new i.default({geometryType:this.featureStore.geometryType,hasM:this.featureStore.hasM,hasZ:this.featureStore.hasZ}),s=0,o=this.deleteFeaturesById(e.map((function(e){return e.objectId})));s<o.length;s++){var n=o[s];r.add(n)}a.addMany(e),this._tileById.forEach((function(e){a.forEachInBounds(e.bounds,(function(i){t._link(e,i.objectId),r.add(e)}))})),this.featureStore.addMany(e);var u=[];return r.forEach((function(e){return u.push(e)})),u},e.prototype.deleteFeaturesById=function(e){for(var t=this,i=new Set,a=function(e){var a=s._featureToTiles.get(e);a&&(a.forEach((function(r){i.add(r),t._tilesToFeatures.get(r).delete(e)})),r.default.release(a),s._featureToTiles.delete(e))},s=this,o=0,n=e;o<n.length;o++){a(n[o])}this.featureStore.removeManyById(e);var u=[];return i.forEach((function(e){return u.push(e)})),u},e.prototype._link=function(e,t){this._featureToTiles.get(t)||this._featureToTiles.set(t,r.default.acquire()),this._featureToTiles.get(t).add(e),this._tilesToFeatures.get(e).add(t)},e.prototype._unlink=function(e,t){this._featureToTiles.get(t).delete(e),this._tilesToFeatures.get(e).delete(t),0===this._featureToTiles.get(t).size&&(r.default.release(this._featureToTiles.get(t)),this._featureToTiles.delete(t))},e}();t.default=n}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/views/2d/layers/features/support/DataTileFeaturesIndex.js?')},\"./node_modules/arcgis-js-api/views/2d/layers/features/support/TileUpdateQueue.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports,__webpack_require__(/*! tslib */ \"./node_modules/tslib/tslib.js\"),__webpack_require__(/*! ../../../../../core/Accessor */ \"./node_modules/arcgis-js-api/core/Accessor.js\"),__webpack_require__(/*! ../../../../../core/promiseUtils */ \"./node_modules/arcgis-js-api/core/promiseUtils.js\"),__webpack_require__(/*! ../../../../../core/scheduling */ \"./node_modules/arcgis-js-api/core/scheduling.js\"),__webpack_require__(/*! ../../../../../core/accessorSupport/decorators */ \"./node_modules/arcgis-js-api/core/accessorSupport/decorators.js\"),__webpack_require__(/*! ../../../../../core/libs/gl-matrix-2/vec2 */ \"./node_modules/arcgis-js-api/core/libs/gl-matrix-2/vec2.js\"),__webpack_require__(/*! ../../../tiling */ \"./node_modules/arcgis-js-api/views/2d/tiling.js\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(e,t,i,n,o,s,r,l,u){Object.defineProperty(t,\"__esModule\",{value:!0});var a=[0,0],h=function(e){function t(t){var i=e.call(this,t)||this;return i._queue=new Map,i._isPaused=!1,i._scheduledNextHandle=null,i._timestamp=Date.now(),i.tileInfoView=null,i._next=i._next.bind(i),i._finalize=i._finalize.bind(i),i}return i.__extends(t,e),Object.defineProperty(t.prototype,\"length\",{get:function(){return this._queue.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"updating\",{get:function(){return this._queue.size>0||null!=this._onGoingTile},enumerable:!0,configurable:!0}),t.prototype.abort=function(e){this._onGoingTile&&this._onGoingTile.tileId===e&&(this._onGoingTile.abortController.abort(),this._onGoingTile=null),this._queue.delete(e),this._scheduleNext(),this.notifyChange(\"updating\")},t.prototype.clear=function(){this._queue.clear(),this._onGoingTile&&(this._onGoingTile.abortController.abort(),this._onGoingTile=null),this._cancelNext(),this.notifyChange(\"updating\")},t.prototype.has=function(e){return this._queue.has(e)},t.prototype.isOngoing=function(e){return this._onGoingTile&&this._onGoingTile.tileId===e},t.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())},t.prototype.push=function(e,t){if(!this._queue.has(e)){var i=o.createAbortController();this._queue.set(e,{tileId:e,key:u.TileKey.pool.acquire(e),timestamp:t||this._timestamp,abortController:i}),this._scheduleNext(),this.notifyChange(\"updating\")}},t.prototype.refresh=function(){this._timestamp=Date.now(),this.reset()},t.prototype.reset=function(){var e=this._onGoingTile;if(e){var t=e.tileId;this.push(t,this._timestamp)}this.notifyChange(\"updating\")},t.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext()),this.notifyChange(\"updating\")},t.prototype._finalize=function(){this._onGoingTile=null,this.notifyChange(\"updating\"),this._scheduleNext()},t.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)},t.prototype._scheduleNext=function(){this._isPaused||this._scheduledNextHandle||0===this._queue.size||null!=this._onGoingTile||(this._scheduledNextHandle=s.schedule(this._next))},t.prototype._next=function(){return i.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,s;return i.__generator(this,(function(i){switch(i.label){case 0:if(null==this._scheduledNextHandle||0===this._queue.size||this._onGoingTile)return this._scheduledNextHandle=null,[2];if(this._scheduledNextHandle=null,e=this._peek(),t=e.abortController.signal,n=e.tileId,o=e.key,u.TileKey.pool.release(o),this._queue.delete(n),this._onGoingTile=e,s=this.process(n,this._timestamp,{signal:t}),this.notifyChange(\"updating\"),!function(e){return e&&\"function\"==typeof e.then}(s))return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,s];case 2:return i.sent(),[3,4];case 3:return i.sent(),[3,4];case 4:return this._finalize(),[2]}}))}))},t.prototype._peek=function(){var e=this;if(!this.state)throw new Error(\"state not set\");var t=this.tileInfoView,i=this.state.center,n=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY,s=null;return this._queue.forEach((function(r){t.getTileCoords(a,r.key);var u=e._timestamp-r.timestamp;if(isNaN(u))(h=l.vec2.distance(a,i))<o&&(o=h,s=r);else if(u===n){var h;(h=l.vec2.distance(a,i))<o&&(o=h,s=r)}else u>n&&(n=u,o=Number.POSITIVE_INFINITY,s=r)})),s},i.__decorate([r.property({readOnly:!0})],t.prototype,\"length\",null),i.__decorate([r.property({constructOnly:!0})],t.prototype,\"process\",void 0),i.__decorate([r.property()],t.prototype,\"state\",void 0),i.__decorate([r.property({constructOnly:!0})],t.prototype,\"tileInfoView\",void 0),i.__decorate([r.property({readOnly:!0})],t.prototype,\"updating\",null),t=i.__decorate([r.subclass(\"esri.views.2d.layers.features.support.TileUpdateQueue\")],t)}(n);t.default=h}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/views/2d/layers/features/support/TileUpdateQueue.js?')}}]);","extractedComments":[]}