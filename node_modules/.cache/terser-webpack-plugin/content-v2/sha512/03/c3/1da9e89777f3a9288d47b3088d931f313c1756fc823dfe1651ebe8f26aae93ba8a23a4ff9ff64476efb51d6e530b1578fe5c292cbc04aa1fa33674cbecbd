{"code":"(function(){(this||window).webpackJsonp.registerAbsMids({\"esri/layers/support/kmlUtils\":\"./node_modules/arcgis-js-api/layers/support/kmlUtils.js\",\"esri/views/2d/layers/KMLLayerView2D\":\"./node_modules/arcgis-js-api/views/2d/layers/KMLLayerView2D.js\"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{\"./node_modules/arcgis-js-api/layers/support/kmlUtils.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports,__webpack_require__(/*! tslib */ \"./node_modules/tslib/tslib.js\"),__webpack_require__(/*! ../../config */ \"./node_modules/arcgis-js-api/config.js\"),__webpack_require__(/*! ../../PopupTemplate */ \"./node_modules/arcgis-js-api/PopupTemplate.js\"),__webpack_require__(/*! ../../request */ \"./node_modules/arcgis-js-api/request.js\"),__webpack_require__(/*! ../../core/lang */ \"./node_modules/arcgis-js-api/core/lang.js\"),__webpack_require__(/*! ../../geometry/SpatialReference */ \"./node_modules/arcgis-js-api/geometry/SpatialReference.js\"),__webpack_require__(/*! ../../geometry/support/aaBoundingBox */ \"./node_modules/arcgis-js-api/geometry/support/aaBoundingBox.js\"),__webpack_require__(/*! ../../geometry/support/boundsUtils */ \"./node_modules/arcgis-js-api/geometry/support/boundsUtils.js\"),__webpack_require__(/*! ../../renderers/support/jsonUtils */ \"./node_modules/arcgis-js-api/renderers/support/jsonUtils.js\"),__webpack_require__(/*! ../../tasks/support/FeatureSet */ \"./node_modules/arcgis-js-api/tasks/support/FeatureSet.js\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(e,r,t,n,o,a,s,i,u,l,f,p){Object.defineProperty(r,\"__esModule\",{value:!0});var y={esriGeometryPoint:\"points\",esriGeometryPolyline:\"polylines\",esriGeometryPolygon:\"polygons\"};function c(e,r,t){t.forEach((function(t){e.set(t.attributes[r],t)}))}function d(e){for(var r=u.create(),t=u.create(u.NEGATIVE_INFINITY),n=0,o=e;n<o.length;n++){var a=o[n];if(a.polygons&&a.polygons.featureSet&&a.polygons.featureSet.features)for(var s=0,f=a.polygons.featureSet.features;s<f.length;s++){var p=f[s];l.getBoundsXYZ(r,p.geometry),u.expand(t,r,t)}if(a.polylines&&a.polylines.featureSet&&a.polylines.featureSet.features)for(var y=0,c=a.polylines.featureSet.features;y<c.length;y++){p=c[y];l.getBoundsXYZ(r,p.geometry),u.expand(t,r,t)}if(a.points&&a.points.featureSet&&a.points.featureSet.features)for(var d=0,m=a.points.featureSet.features;d<m.length;d++){p=m[d];l.getBoundsXYZ(r,p.geometry),u.expand(t,r,t)}if(a.mapImages)for(var g=0,v=a.mapImages;g<v.length;g++){p=v[g];l.getBoundsXYZ(r,p.extent),u.expand(t,r,t)}}return u.equals(t,u.NEGATIVE_INFINITY)?null:{xmin:t[0],ymin:t[1],zmin:t[2],xmax:t[3],ymax:t[4],zmax:t[5],spatialReference:i.WGS84}}r.parseKML=function(e){var r=e.folders||[],t=r.slice(),n=new Map,o=new Map,a=new Map,i=new Map,u=new Map,l={esriGeometryPoint:o,esriGeometryPolyline:a,esriGeometryPolygon:i};(e.featureCollection&&e.featureCollection.layers||[]).forEach((function(e){var r=s.clone(e);r.featureSet.features=[];var t=e.featureSet.geometryType;n.set(t,r);var u=e.layerDefinition.objectIdField;\"esriGeometryPoint\"===t?c(o,u,e.featureSet.features):\"esriGeometryPolyline\"===t?c(a,u,e.featureSet.features):\"esriGeometryPolygon\"===t&&c(i,u,e.featureSet.features)})),e.groundOverlays&&e.groundOverlays.forEach((function(e){u.set(e.id,e)})),r.forEach((function(r){r.networkLinkIds.forEach((function(n){var o=function(e,r,t){var n=function(e,r){var t;return r.some((function(r){return r.id===e&&(t=r,!0)})),t}(e,t);n&&(n.parentFolderId=r,n.networkLink=n);return n}(n,r.id,e.networkLinks);o&&t.push(o)}))})),t.forEach((function(e){e.featureInfos&&(e.points=s.clone(n.get(\"esriGeometryPoint\")),e.polylines=s.clone(n.get(\"esriGeometryPolyline\")),e.polygons=s.clone(n.get(\"esriGeometryPolygon\")),e.mapImages=[],e.featureInfos.map((function(r){switch(r.type){case\"esriGeometryPoint\":case\"esriGeometryPolyline\":case\"esriGeometryPolygon\":var t=l[r.type].get(r.id);t&&e[y[r.type]].featureSet.features.push(t);break;case\"GroundOverlay\":var n=u.get(r.id);n&&e.mapImages.push(n)}})),e.fullExtent=d([e]))}));var f=d(t);return{folders:r,sublayers:t,extent:f}},r.fetchService=function(e,r,t,o){var s=n.kmlServiceUrl;return a(s,{query:{url:e,model:\"simple\",folders:\"\",refresh:0!==t||void 0,outSR:JSON.stringify(r)},responseType:\"json\",signal:o})},r.sublayersFromJSON=function(e,r,t,n){void 0===t&&(t=null),void 0===n&&(n=[]);var o=[],a={},s=r.sublayers,i=r.folders.map((function(e){return e.id}));return s.forEach((function(r){var s=new e;if(t?s.read(r,t):s.read(r),n.length&&i.indexOf(s.id)>-1&&(s.visible=-1!==n.indexOf(s.id)),a[r.id]=s,null!=r.parentFolderId&&-1!==r.parentFolderId){var u=a[r.parentFolderId];u.sublayers||(u.sublayers=[]),u.sublayers.unshift(s)}else o.unshift(s)})),o},r.getGraphics=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n,a,s,i,u,l,y,c,d;return t.__generator(this,(function(t){switch(t.label){case 0:r=p.fromJSON(e.featureSet),n=r.features,a=e.layerDefinition,s=f.fromJSON(a.drawingInfo.renderer),i=o.fromJSON(e.popupInfo),u=[],l=0,y=n,t.label=1;case 1:return l<y.length?(c=y[l],[4,s.getSymbolAsync(c)]):[3,4];case 2:d=t.sent(),c.symbol=d,c.popupTemplate=i,c.visible=!!c.attributes.visibility,u.push(c),t.label=3;case 3:return l++,[3,1];case 4:return[2,u]}}))}))},r.computeExtent=d}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/layers/support/kmlUtils.js?')},\"./node_modules/arcgis-js-api/views/2d/layers/KMLLayerView2D.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports,__webpack_require__(/*! tslib */ \"./node_modules/tslib/tslib.js\"),__webpack_require__(/*! ../../../request */ \"./node_modules/arcgis-js-api/request.js\"),__webpack_require__(/*! ../../../core/Collection */ \"./node_modules/arcgis-js-api/core/Collection.js\"),__webpack_require__(/*! ../../../core/Handles */ \"./node_modules/arcgis-js-api/core/Handles.js\"),__webpack_require__(/*! ../../../core/promiseUtils */ \"./node_modules/arcgis-js-api/core/promiseUtils.js\"),__webpack_require__(/*! ../../../core/scheduling */ \"./node_modules/arcgis-js-api/core/scheduling.js\"),__webpack_require__(/*! ../../../core/watchUtils */ \"./node_modules/arcgis-js-api/core/watchUtils.js\"),__webpack_require__(/*! ../../../core/accessorSupport/decorators */ \"./node_modules/arcgis-js-api/core/accessorSupport/decorators.js\"),__webpack_require__(/*! ../../../geometry/Extent */ \"./node_modules/arcgis-js-api/geometry/Extent.js\"),__webpack_require__(/*! ../../../geometry/support/webMercatorUtils */ \"./node_modules/arcgis-js-api/geometry/support/webMercatorUtils.js\"),__webpack_require__(/*! ../../../layers/support/kmlUtils */ \"./node_modules/arcgis-js-api/layers/support/kmlUtils.js\"),__webpack_require__(/*! ../../../support/GraphicsCollection */ \"./node_modules/arcgis-js-api/support/GraphicsCollection.js\"),__webpack_require__(/*! ../engine */ \"./node_modules/arcgis-js-api/views/2d/engine.js\"),__webpack_require__(/*! ./LayerView2D */ \"./node_modules/arcgis-js-api/views/2d/layers/LayerView2D.js\"),__webpack_require__(/*! ./graphics/GraphicsView2D */ \"./node_modules/arcgis-js-api/views/2d/layers/graphics/GraphicsView2D.js\"),__webpack_require__(/*! ../../layers/LayerView */ \"./node_modules/arcgis-js-api/views/layers/LayerView.js\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(e,t,i,n,s,o,r,a,l,p,h,c,u,d,y,_,f,g){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._handles=new o,t._bitmapIndex=new Map,t._mapImageContainer=new y.BitmapContainer,t._featuresMap=new Map,t.allVisiblePoints=new d.GraphicsCollection,t.allVisiblePolylines=new d.GraphicsCollection,t.allVisiblePolygons=new d.GraphicsCollection,t.allVisibleMapImages=new s,t}return i.__extends(t,e),t.prototype.hitTest=function(e,t){var i=this;if(this.suspended||!this._pointsView&&!this._polylinesView&&!this._polygonsView)return r.resolve(null);var n=[this._pointsView.hitTest(e,t),this._polylinesView.hitTest(e,t),this._polygonsView.hitTest(e,t)];return r.all(n).then((function(e){return e.filter((function(e){return e&&(e.layer=i.layer,e.sourceLayer=i.layer),!!e}))[0]||null}))},t.prototype.update=function(e){this._polygonsView&&this._polygonsView.processUpdate(e),this._polylinesView&&this._polylinesView.processUpdate(e),this._pointsView&&this._pointsView.processUpdate(e)},t.prototype.attach=function(){var e=this;this._handles.add([this.allVisibleMapImages.on(\"change\",(function(t){t.added.forEach((function(t){return e._addMapImage(t)})),t.removed.forEach((function(t){return e._removeMapImage(t)}))}))]),this.container.addChild(this._mapImageContainer),this._polygonsView=new f.default({view:this.view,graphics:this.allVisiblePolygons,requestUpdateCallback:function(){return e.requestUpdate()}}),this.container.addChild(this._polygonsView.container),this._polylinesView=new f.default({view:this.view,graphics:this.allVisiblePolylines,requestUpdateCallback:function(){return e.requestUpdate()}}),this.container.addChild(this._polylinesView.container),this._pointsView=new f.default({view:this.view,graphics:this.allVisiblePoints,requestUpdateCallback:function(){return e.requestUpdate()}}),this.container.addChild(this._pointsView.container),this.watch(\"layer.visibleSublayers\",(function(){return e._refreshCollections()})),this._fetchingPromise=this._fetchService().then((function(){e._fetchingPromise=null,e.notifyChange(\"updating\")}))},t.prototype.detach=function(){this._handles.removeAll(),this._mapImageContainer.removeAllChildren(),this.container.removeAllChildren(),this._bitmapIndex.clear(),this._polygonsView&&(this._polygonsView.destroy(),this._polygonsView=null),this._polylinesView&&(this._polylinesView.destroy(),this._polylinesView=null),this._pointsView&&(this._pointsView.destroy(),this._pointsView=null)},t.prototype.moveStart=function(){},t.prototype.viewChange=function(){this._polygonsView.viewChange(),this._polylinesView.viewChange(),this._pointsView.viewChange()},t.prototype.moveEnd=function(){},t.prototype.isUpdating=function(){return null!=this._fetchingPromise||this._pointsView.updating||this._polygonsView.updating||this._polylinesView.updating},t.prototype._addMapImage=function(e){var t=this;this.view.spatialReference.isWGS84&&n(e.href,{responseType:\"image\"}).then((function(i){var n=i.data,s=h.fromJSON(e.extent);c.canProject(s,t.view.spatialReference)&&(s=c.project(s,t.view.spatialReference));var o=new y.Bitmap(n);o.x=s.xmin,o.y=s.ymax,o.resolution=s.width/n.naturalWidth,o.rotation=e.rotation,t._mapImageContainer.addChild(o),t._bitmapIndex.set(e,o)}))},t.prototype._fetchService=function(){var e=this;return this._handles.remove(\"refresh-collections\"),this._getParsedKML().then((function(t){return e._fetchSublayerService(e.layer,t)}))},t.prototype._fetchSublayerService=function(e,t){var i=this,n=e.sublayers;if(!n||0===n.length)return r.resolve();var s=[];return n.forEach((function(e){var n=l.whenTrueOnce(e,\"visible\").then((function(){return e.load()})).then((function(){return i._getGraphicsForSublayer(e,t)})).then((function(t){return r.create((function(n){e.networkLink?n():(i._featuresMap.set(e,t),i._handles.add(a.schedule((function(){i._refreshCollections(),n()})),\"refresh-collections\"))}))})).then((function(){return i._fetchSublayerService(e,e.sourceJSON||t)}));e.visible&&s.push(n)})),r.all(s).then((function(){}))},t.prototype._getParsedKML=function(){return u.fetchService(this.layer.url,this.view.spatialReference,this.layer.refreshInterval).then((function(e){return u.parseKML(e.data)}))},t.prototype._getGraphicsForSublayer=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var n,s,o,r,a;return i.__generator(this,(function(i){switch(i.label){case 0:return n=null,t.sublayers.some((function(t){return n=t,t.id===e.id}))?(s={},(o=n.points)?[4,u.getGraphics(n.points)]:[3,2]):[2,null];case 1:o=i.sent(),i.label=2;case 2:return s.points=o,(r=n.polylines)?[4,u.getGraphics(n.polylines)]:[3,4];case 3:r=i.sent(),i.label=4;case 4:return s.polylines=r,(a=n.polygons)?[4,u.getGraphics(n.polygons)]:[3,6];case 5:a=i.sent(),i.label=6;case 6:return[2,(s.polygons=a,s.mapImages=n.mapImages,s)]}}))}))},t.prototype._refreshCollections=function(){var e=this,t=this.get(\"layer.visibleSublayers\");this.allVisiblePoints.removeAll(),this.allVisiblePolylines.removeAll(),this.allVisiblePolygons.removeAll(),this.allVisibleMapImages.removeAll(),t&&t.length&&t.forEach((function(t){var i=e._featuresMap.get(t);i&&(e.allVisiblePoints.addMany(i.points),e.allVisiblePolylines.addMany(i.polylines),e.allVisiblePolygons.addMany(i.polygons),e.allVisibleMapImages.addMany(i.mapImages))}))},t.prototype._removeMapImage=function(e){var t=this._bitmapIndex.get(e);t&&(this._mapImageContainer.removeChild(t),this._bitmapIndex.delete(e))},i.__decorate([p.property()],t.prototype,\"_pointsView\",void 0),i.__decorate([p.property()],t.prototype,\"_polylinesView\",void 0),i.__decorate([p.property()],t.prototype,\"_polygonsView\",void 0),i.__decorate([p.property()],t.prototype,\"_fetchingPromise\",void 0),i.__decorate([p.property({dependsOn:[\"_fetchingPromise\",\"_pointsView.updating\",\"_polygonsView.updating\",\"_polylinesView.updating\"]})],t.prototype,\"updating\",void 0),t=i.__decorate([p.subclass(\"esri.views.2d.layers.KMLLayerView2D\")],t)}(_.LayerView2DMixin(g))}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/views/2d/layers/KMLLayerView2D.js?')}}]);","extractedComments":[]}