{"code":"(function(){(this||window).webpackJsonp.registerAbsMids({\"esri/geohash/GeohashTree\":\"./node_modules/arcgis-js-api/geohash/GeohashTree.js\",\"esri/geohash/geohashUtils\":\"./node_modules/arcgis-js-api/geohash/geohashUtils.js\",\"esri/views/2d/layers/features/controllers/BaseController\":\"./node_modules/arcgis-js-api/views/2d/layers/features/controllers/BaseController.js\",\"esri/views/2d/layers/features/support/ClusterStore\":\"./node_modules/arcgis-js-api/views/2d/layers/features/support/ClusterStore.js\",\"esri/views/2d/layers/features/support/pixelBuffering\":\"./node_modules/arcgis-js-api/views/2d/layers/features/support/pixelBuffering.js\"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{\"./node_modules/arcgis-js-api/geohash/GeohashTree.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports,__webpack_require__(/*! ../core/CircularArray */ \"./node_modules/arcgis-js-api/core/CircularArray.js\"),__webpack_require__(/*! ../core/maybe */ \"./node_modules/arcgis-js-api/core/maybe.js\"),__webpack_require__(/*! ./geohashUtils */ \"./node_modules/arcgis-js-api/geohash/geohashUtils.js\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(t,e,i,a,o){Object.defineProperty(e,\"__esModule\",{value:!0});var s=function(){function t(t){this._pool=new i.default(8024),this._nodes=0,this._root=new n(0,0,0),this._fields=t}return t.prototype._acquire=function(t,e,i){var o=this._pool.dequeue();return this._nodes++,a.isSome(o)?o.realloc(t,e,i):new n(t,e,i)},t.prototype._release=function(t){this._nodes--,this._pool.enqueue(t)},Object.defineProperty(t.prototype,\"count\",{get:function(){return this._root.count},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"size\",{get:function(){return this._nodes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"poolSize\",{get:function(){return this._pool.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"depth\",{get:function(){var t=0;return this._forEachNode((function(e){return t=Math.max(t,e.depth)})),t},enumerable:!0,configurable:!0}),t.prototype.dropLevels=function(t){var e=this;this._forEachNode((function(i){if(i.depth>=t)for(var a=0;a<i.children.length;a++){var o=i.children[a];i.children[a]=null,o&&e._release(o)}}))},t.prototype.insert=function(t,e,i){void 0===i&&(i=0);for(var a=this._root,o=0,s=0,n=0;null!==a;){if(a.depth>=i&&(a.count+=1,a.xTotal+=t.geometry.coords[0],a.yTotal+=t.geometry.coords[1],a.xGeohashTotal+=t.geohashX,a.yGeohashTotal+=t.geohashY,this._updateStatistics(t,a,1)),o>=e)return;var r=Math.ceil((o+1)/2),h=Math.floor((o+1)/2),l=1-o%2,c=30-(3*r+2*h),u=30-(2*r+3*h),d=7*l+3*(1-l)<<c,f=3*l+7*(1-l)<<u,p=8*l+4*(1-l),v=(t.geohashX&d)>>c,y=(t.geohashY&f)>>u,g=v+y*p;s=s<<3*l+2*(1-l)|v,n=n<<2*l+3*(1-l)|y,null==a.children[g]&&(a.children[g]=this._acquire(s,n,o+1)),o+=1,a=a.children[g]}},t.prototype.remove=function(t,e){for(var i=this._root,a=0;null!==i;){if(i.count-=1,i.xTotal-=t.geometry.coords[0],i.yTotal-=t.geometry.coords[1],i.xGeohashTotal-=t.geohashX,i.yGeohashTotal-=t.geohashY,this._updateStatistics(t,i,-1),a>=e)return;var o=Math.ceil((a+1)/2),s=Math.floor((a+1)/2),n=1-a%2,r=30-(3*o+2*s),h=30-(2*o+3*s),l=7*n+3*(1-n)<<r,c=3*n+7*(1-n)<<h,u=8*n+4*(1-n),d=((t.geohashX&l)>>r)+((t.geohashY&c)>>h)*u,f=i.children[d];1===f.count&&(this._release(f),i.children[d]=null),a+=1,i=f}},t.prototype.find=function(t,e,i){return this._root.find(t,e,i,0,0,0)},t.prototype.findSingleOccupancyNode=function(t,e,i,a,o){for(var s=this._root;null!==s;){var n=s.depth,r=s.xNode,h=s.yNode,l=1-n%2,c=s.xGeohashTotal/s.count,u=s.yGeohashTotal/s.count;if(1===s.count&&t<c&&c<=i&&e<u&&u<=a)return s;if(n>=o)s=s.next;else{for(var d=Math.ceil((n+1)/2),f=Math.floor((n+1)/2),p=30-(3*d+2*f),v=30-(2*d+3*f),y=~((1<<p)-1),g=~((1<<v)-1),x=(t&y)>>p,_=(e&g)>>v,m=(i&y)>>p,b=(a&g)>>v,T=r<<3*l+2*(1-l),N=h<<2*l+3*(1-l),S=T+8*l+4*(1-l),M=N+4*l+8*(1-l),k=Math.max(T,x),G=Math.max(N,_),C=Math.min(S,m),z=Math.min(M,b),F=null,w=null,P=G;P<=z;P++)for(var O=k;O<=C;O++){var X=O-T+(P-N)*(8*l+4*(1-l)),Y=s.children[X];Y&&(F||((F=Y).next=s.next),w&&(w.next=Y),w=Y,Y.next=s.next)}s=F||s.next}}return null},t.prototype.getRegionStatistics=function(t,e,i,a,o){for(var s=this._root,n=0,r=0,h=0,l={};null!==s;){var c=s.depth,u=s.xNode,d=s.yNode;if(c>=o){var f=s.xGeohashTotal/s.count,p=s.yGeohashTotal/s.count;t<f&&f<=i&&e<p&&p<=a&&(n+=s.count,r+=s.xTotal,h+=s.yTotal,this._aggregateStatistics(l,s.statistics)),s=s.next}else{for(var v=Math.ceil((c+1)/2),y=Math.floor((c+1)/2),g=1-c%2,x=30-(3*v+2*y),_=30-(2*v+3*y),m=~((1<<x)-1),b=~((1<<_)-1),T=(t&m)>>x,N=(e&b)>>_,S=(i&m)>>x,M=(a&b)>>_,k=u<<3*g+2*(1-g),G=d<<2*g+3*(1-g),C=k+8*g+4*(1-g),z=G+4*g+8*(1-g),F=Math.max(k,T),w=Math.max(G,N),P=Math.min(C,S),O=Math.min(z,M),X=null,Y=null,j=w;j<=O;j++)for(var q=F;q<=P;q++){var E=q-k+(j-G)*(8*g+4*(1-g)),L=s.children[E];if(L){if(j!==w&&j!==O&&q!==F&&q!==P){f=L.xGeohashTotal/L.count,p=L.yGeohashTotal/L.count;t<f&&f<=i&&e<p&&p<=a&&(n+=L.count,r+=L.xTotal,h+=L.yTotal,this._aggregateStatistics(l,L.statistics));continue}X||((X=L).next=s.next),Y&&(Y.next=L),Y=L,L.next=s.next}}s=X||s.next}}return{count:n,attributes:this._normalizeStatistics(l,n),xTotal:r,yTotal:h}},t.prototype._forEachNode=function(t){for(var e=this._root;null!==e;){var i=this._linkChildren(e)||e.next;t(e),e=i}},t.prototype._linkChildren=function(t){for(var e=null,i=null,a=0;a<=t.children.length;a++){var o=t.children[a];o&&(e||((e=o).next=t.next),i&&(i.next=o),i=o,o.next=t.next)}return e},t.prototype._updateStatistics=function(t,e,i){for(var a=0,o=this._fields;a<o.length;a++){var s=o[a],n=s.name,r=s.outStatistic.onStatisticField,h=t.attributes[r];switch(s.outStatistic.statisticType){case\"norm\":e.statistics[n]||(e.statistics[n]={});var l=s.outStatistic.onStatisticNormalizationField,c=t.attributes[l],u=e.statistics[n].onStatisticField||0,d=e.statistics[n].onStatisticNormalizationField||0;null==h||isNaN(h)||null==c||0===c||isNaN(c)||(e.statistics[n].onStatisticField=u+i*h,e.statistics[n].onStatisticNormalizationField=d+i*c);break;case\"sum\":case\"avg\":e.statistics[n]||(e.statistics[n]={value:0,nanCount:0});var f=e.statistics[n].value,p=e.statistics[n].nanCount;null==h||isNaN(h)?e.statistics[n].nanCount=p+i:e.statistics[n].value=f+i*h;break;case\"avg_angle\":e.statistics[n]||(e.statistics[n]={x:0,y:0,nanCount:0});var v=e.statistics[n].x,y=e.statistics[n].y,g=(p=e.statistics[n].nanCount,Math.PI/180);null==h||isNaN(h)?e.statistics[n].nanCount=p+i:(e.statistics[n].x=v+i*Math.cos(h*g),e.statistics[n].y=y+i*Math.sin(h*g));break;case\"mode\":e.statistics[n]||(e.statistics[n]={});f=e.statistics[n][h]||0;e.statistics[n][h]=f+i}}},t.prototype._aggregateStatistics=function(t,e){for(var i=0,a=this._fields;i<a.length;i++){var o=a[i],s=o.name;switch(o.outStatistic.statisticType){case\"sum\":case\"avg\":case\"avg_angle\":case\"mode\":case\"norm\":for(var n in t[s]||(t[s]={}),e[s]){var r=t[s][n]||0;t[s][n]=r+e[s][n]}}}},t.prototype._normalizeStatistics=function(t,e){for(var i={},a=0,o=this._fields;a<o.length;a++){var s=o[a],n=s.name;switch(s.outStatistic.statisticType){case\"norm\":var r=t[n];if(e&&null==r.onStatisticNormalizationField)break;if(e&&r.onStatisticNormalizationField){i[n]=r.onStatisticField/r.onStatisticNormalizationField;break}i[n]=0;break;case\"sum\":if(!e)break;var h=t[n],l=h.value;if(!(e-(u=h.nanCount)))break;i[n]=l;break;case\"avg\":if(!e)break;var c=t[n];l=c.value;if(!(e-(u=c.nanCount)))break;i[n]=l/(e-u);break;case\"avg_angle\":if(!e)break;var u,d=t[n],f=d.x,p=d.y;if(!(e-(u=d.nanCount)))break;var v=f/(e-u),y=p/(e-u),g=180/Math.PI,x=Math.atan2(y,v)*g;i[n]=x;break;case\"mode\":var _=t[n],m=0,b=null;for(var T in _){var N=_[T];N>m&&(m=N,b=T)}i[n]=\"null\"===b?null:b}}return i},t}();e.GeohashTree=s;var n=function(){function t(t,e,i){this.count=0,this.xTotal=0,this.yTotal=0,this.statistics={},this.next=null,this.depth=0,this.xNode=0,this.yNode=0,this.xGeohashTotal=0,this.yGeohashTotal=0,this.children=new Array(32);for(var a=0;a<this.children.length;a++)this.children[a]=null;this.xNode=t,this.yNode=e,this.depth=i}return t.prototype.realloc=function(t,e,i){for(var a=0;a<this.children.length;a++)this.children[a]=null;return this.xNode=t,this.yNode=e,this.depth=i,this.next=null,this.xGeohashTotal=0,this.yGeohashTotal=0,this.xTotal=0,this.yTotal=0,this.count=0,this.statistics={},this},t.prototype.getLngLatBounds=function(){var t=this.depth,e=Math.ceil(t/2),i=Math.floor(t/2),a=30-(3*e+2*i),s=30-(2*e+3*i),n=this.xNode<<a,r=this.yNode<<s;return o.decodeGeohashXY({geohashX:n,geohashY:r},this.depth)},t.prototype.find=function(t,e,i,a,o,s){if(a>=i)return this;var n=1-a%2,r=3*n+2*(1-n),h=2*n+3*(1-n),l=30-o-r,c=30-s-h,u=((t&7*n+3*(1-n)<<l)>>l)+((e&3*n+7*(1-n)<<c)>>c)*(8*n+4*(1-n)),d=this.children[u];return null==d?null:d.find(t,e,i,a+1,o+r,s+h)},t}()}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/geohash/GeohashTree.js?')},\"./node_modules/arcgis-js-api/geohash/geohashUtils.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports], __WEBPACK_AMD_DEFINE_RESULT__ = (function(r,a){Object.defineProperty(a,\"__esModule\",{value:!0});var e=new Float64Array(2),t=new Float64Array(2);function n(r){return r<=57?r-48:r<=104?r-88:r<=107?r-89:r<=110?r-90:r-91}function o(r){return\"0123456789bcdefghjkmnpqrstuvwxyz\"[r]}function h(r){return(r[0]+r[1])/2}function u(r,a,e){return r[0]=a,r[1]=e,r}function c(r,a){var e=h(r),t=a,n=!a;r[0]=n*r[0]+t*e,r[1]=n*e+t*r[1]}function f(r,a){var e=a>h(r);return c(r,e),e}function i(r,a){for(var o=u(e,-90,90),f=u(t,-180,180),i=0;i<a.length;i++){var s=n(a.charCodeAt(i));i%2==0?(c(f,!!(16&s)),c(f,!!(4&s)),c(f,!!(1&s)),c(o,!!(8&s)),c(o,!!(2&s))):(c(o,!!(16&s)),c(o,!!(4&s)),c(o,!!(1&s)),c(f,!!(8&s)),c(f,!!(2&s)))}return r[0]=h(o),r[1]=h(f),r}function s(r,a,n){for(var h=\"\",c=u(e,-90,90),i=u(t,-180,180),s=0;s<n;s++){var v=0;!(s%2)?(v|=f(i,a)<<4,v|=f(c,r)<<3,v|=f(i,a)<<2,v|=f(c,r)<<1,v|=f(i,a)<<0):(v|=f(c,r)<<4,v|=f(i,a)<<3,v|=f(c,r)<<2,v|=f(i,a)<<1,v|=f(c,r)<<0),h+=o(v)}return h}function v(r){var a=Math.floor(5*r/2);return 180/Math.pow(2,a)}function l(r){var a=Math.ceil(5*r/2);return 360/Math.pow(2,a)}function M(r,a){return a?1&r|(4&r)>>1|(16&r)>>2:(2&r)>>1|(8&r)>>2}function g(r,a){return a?(2&r)>>1|(8&r)>>2:1&r|(4&r)>>1|(16&r)>>2}function d(r,a,e){var t=!((r.length-1)%2),h=r.substring(0,r.length-1),u=n(r.charCodeAt(r.length-1)),c=0,f=0,i=0,s=0;t?(c=8,f=4,i=1&u|(4&u)>>1|(16&u)>>2,s=(2&u)>>1|(8&u)>>2):(c=4,f=8,s=1&u|(4&u)>>1|(16&u)>>2,i=(2&u)>>1|(8&u)>>2);var v=i+a,l=s+e,M=Math.floor(v/c),g=Math.floor(l/f),G=o(function(r,a,e){return e?1&r|(1&a)<<1|(2&r)<<1|(2&a)<<2|(4&r)<<2:1&a|(1&r)<<1|(2&a)<<1|(2&r)<<2|(4&a)<<2}(v-M*c,l-g*f,t));return r.length>1&&(M||g)?d(h,M,g)+G:h+G}a.decodeBase32Char=n,a.encodeBase32Char=o,a.decodeGeohash=i,a.convertGeohash32ToXY=function(r,a){for(var e=0,t=0,o=30,h=30,u=0;u<a.length;u++){var c=n(a.charCodeAt(u)),f=u%2==0;e|=M(c,f)<<(o-=f?3:2),t|=g(c,f)<<(h-=f?2:3)}return{geohashX:e,geohashY:t}},a.decodeGeohashXY=function(r,a){for(var e=-90,t=90,n=-180,o=180,h=0;h<a;h++){for(var u=Math.ceil((h+1)/2),c=Math.floor((h+1)/2),f=1-h%2,i=30-(3*u+2*c),s=30-(2*u+3*c),v=3*f+2*(1-f),l=2*f+3*(1-f),M=3*f+7*(1-f)<<s,g=(7*f+3*(1-f)<<i&r.geohashX)>>i,d=(M&r.geohashY)>>s,G=v-1;G>=0;G--){var b=(n+o)/2,p=g&1<<G?1:0;n=(1-p)*n+p*b,o=(1-p)*b+p*o}for(G=l-1;G>=0;G--){var X=(e+t)/2,Y=d&1<<G?1:0;e=(1-Y)*e+Y*X,t=(1-Y)*X+Y*t}}return[n,e,o,t]},a.setGeohashXY=function(r,a,e,t){t%2&&(t+=1);for(var n=0,o=0,h=-90,u=90,c=-180,f=180,i=0;i<t/2;i++){for(var s=0;s<5;s++){var v=(c+f)/2,l=e>v?1:0;n|=l<<29-(s+5*i),c=(1-l)*c+l*v,f=(1-l)*v+l*f}for(s=0;s<5;s++){var M=(h+u)/2,g=a>M?1:0;o|=g<<29-(s+5*i),h=(1-g)*h+g*M,u=(1-g)*M+g*u}}r.geohashX=n,r.geohashY=o},a.encodeGeohash=s,a.latDistPerGeohash=v,a.lonDistPerGeohash=l,a.unpackXBits=M,a.unpackYBits=g,a.getRelativeGeohash=d,a.getIntersectingGeohashes=function(r,a,e,t,n){for(var o=Math.abs(e-r),h=Math.abs(t-a),u=v(n),c=l(n),f=Math.ceil(h/c),i=Math.ceil(o/u),M=s(r,a,n),g=new Array,G=0;G<f;G++)for(var b=0;b<i;b++)g.push(d(M,G,b));return g},a.forEachIntersectingGeohash=function(r,a,e,t,n,o){for(var h=Math.abs(e-r),u=Math.abs(t-a),c=v(n),f=l(n),M=Math.ceil(u/f),g=Math.ceil(h/c),G=s(r,a,n),b=0;b<M;b++)for(var p=0;p<g;p++){var X=d(G,b,p),Y=i([0,0],X),w=Y[0],A=Y[1],m=w-c/2,y=A-f/2,C=w+c/2,x=A+f/2,B=c*f,k=Math.max(r,m),P=Math.max(a,y),j=Math.min(e,C)-k,q=Math.min(t,x)-P;o(X,Math.abs(j*q)/B)}}}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/geohash/geohashUtils.js?')},\"./node_modules/arcgis-js-api/views/2d/layers/features/controllers/BaseController.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports,__webpack_require__(/*! tslib */ \"./node_modules/tslib/tslib.js\"),__webpack_require__(/*! ../../../../../core/Error */ \"./node_modules/arcgis-js-api/core/Error.js\"),__webpack_require__(/*! ../../../../../core/HandleOwner */ \"./node_modules/arcgis-js-api/core/HandleOwner.js\"),__webpack_require__(/*! ../../../../../core/has */ \"./node_modules/arcgis-js-api/core/has.js\"),__webpack_require__(/*! ../../../../../core/Logger */ \"./node_modules/arcgis-js-api/core/Logger.js\"),__webpack_require__(/*! ../../../../../core/maybe */ \"./node_modules/arcgis-js-api/core/maybe.js\"),__webpack_require__(/*! ../../../../../core/promiseUtils */ \"./node_modules/arcgis-js-api/core/promiseUtils.js\"),__webpack_require__(/*! ../../../../../core/accessorSupport/decorators */ \"./node_modules/arcgis-js-api/core/accessorSupport/decorators.js\"),__webpack_require__(/*! ../../../../../layers/graphics/data/attributeSupport */ \"./node_modules/arcgis-js-api/layers/graphics/data/attributeSupport.js\"),__webpack_require__(/*! ../../../../../layers/graphics/data/QueryEngine */ \"./node_modules/arcgis-js-api/layers/graphics/data/QueryEngine.js\"),__webpack_require__(/*! ../../../../../layers/support/FieldsIndex */ \"./node_modules/arcgis-js-api/layers/support/FieldsIndex.js\"),__webpack_require__(/*! ../../../../../renderers/support/jsonUtils */ \"./node_modules/arcgis-js-api/renderers/support/jsonUtils.js\"),__webpack_require__(/*! ../../../../../tasks/support/Query */ \"./node_modules/arcgis-js-api/tasks/support/Query.js\"),__webpack_require__(/*! ../../../engine */ \"./node_modules/arcgis-js-api/views/2d/engine.js\"),__webpack_require__(/*! ../support/AttributeStore */ \"./node_modules/arcgis-js-api/views/2d/layers/features/support/AttributeStore.js\"),__webpack_require__(/*! ../support/ClusterStore */ \"./node_modules/arcgis-js-api/views/2d/layers/features/support/ClusterStore.js\"),__webpack_require__(/*! ../support/pixelBuffering */ \"./node_modules/arcgis-js-api/views/2d/layers/features/support/pixelBuffering.js\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(e,t,r,i,o,n,s,a,u,l,c,p,d,f,y,h,g,b,m){Object.defineProperty(t,\"__esModule\",{value:!0});var v=s.getLogger(\"esri.views.2d.layers.features.controllers.BaseController\");var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._availableFields=[],t._pixelBuffer=0,t.config=null,t.filters=new Array(h.definitions.MAX_FILTERS),t.processor=null,t.remoteClient=null,t.service=null,t.tileStore=null,t}return r.__extends(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on(\"update\",this.onTileUpdate.bind(this))]),this._initAttributeStore()},t.prototype.startup=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this._initAttributeStore(),[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)];case 1:return e.sent(),[4,u.all([this.attributeStore.updateFilters(this),this.updatePixelBuffer()])];case 2:return e.sent(),[2]}}))}))},t.prototype.destroy=function(){this.attributeStore&&this.attributeStore.destroy()},Object.defineProperty(t.prototype,\"arcadeInfo\",{get:function(){return{geometryType:this.service.geometryType,fields:this.service.fields,spatialReference:this.spatialReference}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"featureReduction\",{get:function(){return this.config.featureReduction},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"fieldsIndex\",{get:function(){return new d(this.service.fields)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"geometryInfo\",{get:function(){return{geometryType:this.service.geometryType,hasZ:!1,hasM:!1}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"returnCentroid\",{get:function(){return this._get(\"returnCentroid\")||function(e,t,r){if(\"esriGeometryPolygon\"===t&&e.labelingInfo)return!0;if(\"esriGeometryPolygon\"!==t)return!1;function i(e){if(!e)return!1;var t=e.type;return\"simple-marker\"===t||\"picture-marker\"===t||\"text\"===t||\"web-style\"===t||\"cim\"===t}switch(r.type){case\"simple\":return i(r.symbol);case\"unique-value\":return i(r.defaultSymbol)||r.uniqueValueInfos.some((function(e){return i(e.symbol)}));case\"class-breaks\":return i(r.defaultSymbol)||r.classBreakInfos.some((function(e){return i(e.symbol)}));case\"dot-density\":return!1;default:return!0}}(this.config,this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"returnOutline\",{get:function(){return function(e,t){switch(e){case\"esriGeometryPoint\":case\"esriGeometryPolyline\":case\"esriGeometryMultipoint\":return!0;case\"esriGeometryPolygon\":return function(e){var t=e&&e.getSymbols();return\"backgroundFillSymbol\"in e&&null!=e.backgroundFillSymbol&&\"outline\"in e.backgroundFillSymbol&&null!=e.backgroundFillSymbol.outline||t.some((function(e){return\"outline\"in e&&null!=e.outline}))}(t)}}(this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"queryInfo\",{get:function(){return{returnCentroid:this.returnCentroid,returnGeometry:!0,outFields:this.availableFields,definitionExpression:this.config.definitionExpression,gdbVersion:this.config.gdbVersion,historicMoment:this.config.historicMoment}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"renderer\",{get:function(){return this.config?f.fromJSON(this.config.renderer):(v.error(\"mapview-controller\",\"Unable to create renderer for undefined configuration\"),null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"availableFields\",{get:function(){var e=this,t=this.config.availableFields.filter((function(t){return-1===e._availableFields.indexOf(t)}));return this._availableFields=r.__spreadArrays(this._availableFields,t),this._availableFields},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"spatialReference\",{get:function(){return this.tileStore.tileScheme.spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"viewParams\",{get:function(){return{viewingMode:\"\",scale:this.viewState&&this.viewState.scale||1}},enumerable:!0,configurable:!0}),t.prototype.getObjectId=function(e){return this.attributeStore.getFeatureId(e)},t.prototype.getAggregate=function(e){return null},t.prototype.getAggregateValueRanges=function(){return{}},t.prototype.getLocalId=function(e){return this.attributeStore.getLocalId(e)},t.prototype.mapValidLocalIds=function(e){var t=this;return e.map((function(e){return t.attributeStore.getLocalId(e)})).filter((function(e){return null!=e}))},t.prototype.setViewState=function(e){this._set(\"viewState\",e)},t.prototype.updatePixelBuffer=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return[4,m.computePxBuffer(this.renderer,this.service.geometryType)];case 1:return e=t.sent(),this._pixelBuffer=Math.max(this._pixelBuffer,e),[2]}}))}))},t.prototype.setHighlight=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return[2,this.attributeStore.setHighlight(e)]}))}))},t.prototype.validateConfig=function(e){for(var t=0,r=e.filters;t<r.length;t++){var o=r[t];if(a.isSome(o)&&o.where)try{c.validateWhere(this.fieldsIndex,o.where)}catch(e){throw new i(\"mapview-bad-filter\",e.message,{filter:o,missingFields:e.details})}}},t.prototype.onFeatureAdd=function(e){e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},t.prototype.onFeatureRemove=function(e){!e.localId&&n(\"esri-2d-debug\")&&console.debug(\"Feature must have localId\"),this.attributeStore.freeLocalId(e.objectId)},t.prototype.enableEvent=function(e){},t.prototype._initAttributeStore=function(){var e=this;this.attributeStore?this.attributeStore.invalidateResources():this.attributeStore=new g.default({type:\"remote\",initialize:function(t,r){return e.remoteClient.invoke(\"tileRenderer.featuresView.attributeView.initialize\",t,{signal:r})},update:function(t,r){return e.remoteClient.invoke(\"tileRenderer.featuresView.attributeView.requestUpdate\",t,{signal:r})},render:function(){return e.remoteClient.invoke(\"tileRenderer.featuresView.requestRender\")}})},t.prototype._createQueryEngine=function(e){return new p.default({definitionExpression:this.config.definitionExpression,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:e,timeInfo:this.service.timeInfo})},t.prototype._createTempQueryEngine=function(e){return void 0===e&&(e=this._createFeatureStore()),this._createQueryEngine(e)},t.prototype._createFeatureStore=function(){var e={geometryType:this.service.geometryType,hasM:!1,hasZ:!1};return new b.ClusterStore(e,this.spatialReference,this.attributeStore,this.featureReduction)},t.prototype._createDefaultQuery=function(e){var t=new y,r=e.outFields,i=this.config,o=i.gdbVersion,n=i.historicMoment,s=i.definitionExpression;return r=r.length/this.service.fields.length>=.75?[\"*\"]:r,t.gdbVersion=o,t.historicMoment=null!=n?new Date(n):null,t.num=e.num,t.outFields=r,t.outSpatialReference=this.spatialReference,t.returnGeometry=e.returnGeometry,t.returnCentroid=e.returnCentroid,t.start=e.resultOffset,t.where=s||\"1=1\",t},t.prototype.hasGeometryFilter=function(){return this.filters.some((function(e){return a.isSome(e)&&!!e.geometry}))},r.__decorate([l.property({readOnly:!0,dependsOn:[\"config\",\"service\",\"spatialReference\"]})],t.prototype,\"arcadeInfo\",null),r.__decorate([l.property()],t.prototype,\"config\",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:[\"config\"]})],t.prototype,\"featureReduction\",null),r.__decorate([l.property({readOnly:!0,dependsOn:[\"service\"]})],t.prototype,\"fieldsIndex\",null),r.__decorate([l.property()],t.prototype,\"filters\",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:[\"service\"]})],t.prototype,\"geometryInfo\",null),r.__decorate([l.property({readOnly:!0,dependsOn:[\"config\"]})],t.prototype,\"returnCentroid\",null),r.__decorate([l.property({readOnly:!0,dependsOn:[\"service\",\"config\"]})],t.prototype,\"returnOutline\",null),r.__decorate([l.property({readOnly:!0,dependsOn:[\"config\",\"availableFields\"]})],t.prototype,\"queryInfo\",null),r.__decorate([l.property({dependsOn:[\"config\"],readOnly:!0})],t.prototype,\"renderer\",null),r.__decorate([l.property()],t.prototype,\"processor\",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:[\"config\"]})],t.prototype,\"availableFields\",null),r.__decorate([l.property({constructOnly:!0})],t.prototype,\"remoteClient\",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,\"service\",void 0),r.__decorate([l.property({dependsOn:[\"tileStore\"]})],t.prototype,\"spatialReference\",null),r.__decorate([l.property({constructOnly:!0})],t.prototype,\"tileInfo\",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,\"tileStore\",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,\"viewState\",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:[\"viewState\"]})],t.prototype,\"viewParams\",null),t=r.__decorate([l.subclass(\"esri.views.2d.layers.features.controllers.BaseController\")],t)}(o.HandleOwner);t.default=_}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/views/2d/layers/features/controllers/BaseController.js?')},\"./node_modules/arcgis-js-api/views/2d/layers/features/support/ClusterStore.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports,__webpack_require__(/*! tslib */ \"./node_modules/tslib/tslib.js\"),__webpack_require__(/*! ../../../../../geometry */ \"./node_modules/arcgis-js-api/geometry.js\"),__webpack_require__(/*! ../../../../../core/has */ \"./node_modules/arcgis-js-api/core/has.js\"),__webpack_require__(/*! ../../../../../core/maybe */ \"./node_modules/arcgis-js-api/core/maybe.js\"),__webpack_require__(/*! ../../../../../core/promiseUtils */ \"./node_modules/arcgis-js-api/core/promiseUtils.js\"),__webpack_require__(/*! ../../../../../core/screenUtils */ \"./node_modules/arcgis-js-api/core/screenUtils.js\"),__webpack_require__(/*! ../../../../../geohash/GeohashTree */ \"./node_modules/arcgis-js-api/geohash/GeohashTree.js\"),__webpack_require__(/*! ../../../../../geohash/geohashUtils */ \"./node_modules/arcgis-js-api/geohash/geohashUtils.js\"),__webpack_require__(/*! ../../../../../geometry/support/spatialReferenceUtils */ \"./node_modules/arcgis-js-api/geometry/support/spatialReferenceUtils.js\"),__webpack_require__(/*! ../../../../../geometry/support/webMercatorUtils */ \"./node_modules/arcgis-js-api/geometry/support/webMercatorUtils.js\"),__webpack_require__(/*! ../../../../../layers/graphics/OptimizedFeature */ \"./node_modules/arcgis-js-api/layers/graphics/OptimizedFeature.js\"),__webpack_require__(/*! ../../../../../layers/graphics/OptimizedGeometry */ \"./node_modules/arcgis-js-api/layers/graphics/OptimizedGeometry.js\"),__webpack_require__(/*! ../../../../../layers/graphics/data/FeatureStore */ \"./node_modules/arcgis-js-api/layers/graphics/data/FeatureStore.js\"),__webpack_require__(/*! ../../../../../layers/graphics/data/projectionSupport */ \"./node_modules/arcgis-js-api/layers/graphics/data/projectionSupport.js\"),__webpack_require__(/*! ../../../../../layers/graphics/data/QueryEngine */ \"./node_modules/arcgis-js-api/layers/graphics/data/QueryEngine.js\"),__webpack_require__(/*! ../../../../../layers/graphics/data/utils */ \"./node_modules/arcgis-js-api/layers/graphics/data/utils.js\"),__webpack_require__(/*! ../../../../../support/arcadeOnDemand */ \"./node_modules/arcgis-js-api/support/arcadeOnDemand.js\"),__webpack_require__(/*! ../../../arcade/utils */ \"./node_modules/arcgis-js-api/views/2d/arcade/utils.js\"),__webpack_require__(/*! ../../../engine/webgl/definitions */ \"./node_modules/arcgis-js-api/views/2d/engine/webgl/definitions.js\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(e,t,r,s,i,a,o,n,u,l,h,c,g,d,_,f,p,v,y,I,m){Object.defineProperty(t,\"__esModule\",{value:!0});var x=function(e){return a.andThen(e,(function(e){return\"cluster\"!==e.type?null:r.__assign(r.__assign({},e),{clusterRadius:n.pt2px(e.clusterRadius/2)})}))};function S(e,t,s){return r.__awaiter(this,void 0,void 0,(function(){var i,a,n,u;return r.__generator(this,(function(r){for(i=[],a=0,n=e;a<n.length;a++)u=n[a],i.push(b(u,t,s));return[2,o.all(i)]}))}))}function b(e,t,s){return r.__awaiter(this,void 0,void 0,(function(){var i,a,o;return r.__generator(this,(function(r){switch(r.label){case 0:return\"onStatisticValueExpression\"in e.outStatistic?(a=(i=e).outStatistic.onStatisticValueExpression,o=i,[4,y.createRendererExpression(a,t,s)]):[3,2];case 1:return o.expression=r.sent(),[2,i];case 2:return[2,e]}}))}))}var R=function(e){function t(t,r,s,i,a){var o=this,n=new d.default([],[r,s]);return(o=e.call(this,n,i,null,t)||this).invalid=!1,o.canDelete=!1,o.geohashBoundsInfo=a,o}return r.__extends(t,e),Object.defineProperty(t.prototype,\"count\",{get:function(){return this.attributes.cluster_count},enumerable:!0,configurable:!0}),t.create=function(e,r,s,i,a,o,n){var u=new t(r,s,i,o,n);return u.localId=e.createLocalId(u.objectId,!0),u.tileLevel=a,u},t.prototype.update=function(e,t,r,s,i){return this.geometry.coords[0]=e,this.geometry.coords[1]=t,this.tileLevel=r,this.attributes=s,this.geohashBoundsInfo=i,this.referenceId=null,this.invalid=!1,this},t.prototype.toJSON=function(){return{objectId:this.objectId,referenceId:this.referenceId,attributes:r.__assign(r.__assign({},this.attributes),{clusterId:this.objectId}),geometry:{x:this.geometry.coords[0],y:this.geometry.coords[1]}}},t}(g.default),L=function(e){function t(t,r,i,a){var o=e.call(this,t)||this;return o._deferredDeletionQueue=[],o._invalidated=!1,o._aggregateFieldsHash=null,o._geohashLevel=0,o._aggregateValueRanges={},o._aggregateValueRangesChanged=!1,o._aggregateFields=[],o._hasAggregateValueExpression=!1,o._hasViewExpression=!1,o._$view={scale:0,viewingMode:\"none\"},o._clusters=new Map,o._tiles=new Map,o._spatialReference=r,o._attributeStore=i,o._featureReduction=x(a),o._projectionSupportCheck=f.checkProjectionSupport(r,s.SpatialReference.WGS84),o}return r.__extends(t,e),t.prototype.setScale=function(e){var t=e!==this._$view.scale&&this._hasViewExpression,r=this._featureReduction;this._$view.scale=e,a.isSome(r)&&t&&(this._tree=new u.GeohashTree(this._aggregateFields),this._unindexFeatures(),this._reindexFeatures(!0))},t.prototype.update=function(e,t,s){return r.__awaiter(this,void 0,void 0,(function(){var i,o,n,l,h,c,g,d,_,f,p,v=this;return r.__generator(this,(function(r){switch(r.label){case 0:return i=this._featureReduction,o=a.andThen(t.featureReduction,x),n=t.aggregateFields.reduce((function(e,t){return e+JSON.stringify(t)}),\"\"),l=null===i&&t.featureReduction,h=n!==this._aggregateFieldsHash,c=l||h,h?(g=this,[4,S(t.aggregateFields,this._spatialReference,s)]):[3,2];case 1:for(g._aggregateFields=r.sent(),this._hasViewExpression=!1,d=0,_=this._aggregateFields;d<_.length;d++)\"onStatisticValueExpression\"in(f=_[d]).outStatistic&&(p=f,this._hasAggregateValueExpression=!0,this._hasViewExpression=this._hasViewExpression||p.expression.referencesScale());r.label=2;case 2:return[4,this._projectionSupportCheck];case 3:return r.sent(),this._featureReduction=o,this._aggregateFieldsHash=n,this._aggregateValueRanges={},this._invalidated=!0,a.isNone(o)?(this._tree=null,[2]):(a.isSome(i)&&i.clusterRadius!==o.clusterRadius&&this._clusters.forEach((function(e){return e.canDelete=!0})),c&&(this._tree=new u.GeohashTree(t.aggregateFields),this._unindexFeatures()),(c||e)&&this._reindexFeatures(h),this._handleClusterUpdates(),this._tiles.forEach((function(e){return v._getClustersForTile(e,0,o.clusterRadius,null,!1)})),[2])}}))}))},t.prototype._ensureAggregateFields=function(e){if(this._hasAggregateValueExpression)for(var t=this._$view,r=0,s=this._aggregateFields;r<s.length;r++){var i=s[r];if(\"onStatisticValueExpression\"in i.outStatistic){var a=i,o=a.expression,n=a.outStatistic.onStatisticField;e.attributes[n]=I.callWithOptimizedFeature(o,e,{$view:t},this.geometryInfo)}}},t.prototype._unindexFeatures=function(){this._featuresById.forEach((function(e){e.geohashIndexed=!1}))},t.prototype._reindexFeatures=function(e){var t=this;this._featuresById.forEach((function(r){r.geohashX||r.geohashY||t._setGeohash(r),e&&t._ensureAggregateFields(r),t._attributeStore.isVisible(r)?t._insertIntoIndex(r):t._removeFromIndex(r)}))},t.prototype.onTileUpdate=function(e){var t=this,r=e.added,s=e.removed;if(r.length){var i=Math.max.apply(Math,r.map((function(e){return e.level})));this._setGeohashLevel(i),r.forEach((function(e){return t._tiles.set(e.key.id,e)}))}if(!a.isNone(this._featureReduction)){var o=this._featureReduction.clusterRadius;s.forEach((function(e){t._tiles.delete(e.key.id),t._markTileClustersForDeletion(e,o)}))}},t.prototype.sweepClusters=function(){var e=this;this._clusters.forEach((function(t,r){t.canDelete&&(e._attributeStore.freeLocalId(t.objectId),e._clusters.delete(r))}));for(var t=0,r=this._deferredDeletionQueue;t<r.length;t++){var s=r[t];this._attributeStore.addLocalId(s)}this._deferredDeletionQueue=[]},t.prototype.executeTileQuery=function(t,s,i){return r.__awaiter(this,void 0,void 0,(function(){var o,n,u;return r.__generator(this,(function(r){switch(r.label){case 0:return a.isNone(this._featureReduction)?[2,e.prototype.executeTileQuery.call(this,t,s,i)]:[4,this._projectionSupportCheck];case 1:return r.sent(),this._handleClusterUpdates(),o=this._featureReduction.clusterRadius,n=this._getTransforms(t,s),u=this._getClustersForTile(t,i.pixelBuffer,o,n),this._aggregateValueRangesChanged&&(this.events.emit(\"valueRangesChanged\",{valueRanges:this._aggregateValueRanges}),this._aggregateValueRangesChanged=!1),[2,u]}}))}))},t.prototype.getAggregate=function(e){var t=null;return this._clusters.forEach((function(r){r.localId===e&&(t=r.toJSON())})),t},t.prototype.getAggregateValueRanges=function(){return this._aggregateValueRanges},t.prototype._getClustersForTile=function(e,t,o,n,u){var l=this;void 0===u&&(u=!0),t=Math.max(t,50);for(var h=2*o,g=new Set,d=this._getGeohashLevel(e.key.level),_=Math.pow(2,e.key.level)*Math.ceil(m.TILE_SIZE/h),y=Math.ceil(t/h)+2,I=Math.ceil(m.TILE_SIZE/h)+2*y,x=e.key,S=x.row,b=x.col*m.TILE_SIZE,R=S*m.TILE_SIZE,L=Math.floor(b/h)-y,E=Math.floor(R/h)-y,w=L+I,F=E+I,T=new Array,V=e.tileInfoView.getLODInfoAt(e.key.level),C=L;C<=w;C++)for(var M=function(t){var o,h,y=C;V.wrap&&(y=C<0?C+_:C%_);var I=V.wrap&&C<0,m=V.wrap&&C%_!==C,x=j._lookupCluster(V,e.key.level,y,t,d);if(a.isSome(x)){var S=a.andThen(n,(function(e){return I?e.left:m?e.right:e.tile}));if(u&&a.isNone(S))return\"continue\";if(!x.count)return\"continue\";if(u&&1===x.count){var b=x.geohashBoundsInfo,R=b.xLL,L=b.yLL,E=b.xTR,w=b.yTR,F=b.level,M=a.unwrap(j._tree).findSingleOccupancyNode(R,L,E,w,F),G=a.unwrap(M).getLngLatBounds(),k={x:G[0],y:G[1]},D={x:G[2],y:G[3]},X=0,Y=0,A=0,Z=0;if(j._spatialReference.isWebMercator)X=(o=c.lngLatToXY(k.x,k.y))[0],Y=o[1],A=(h=c.lngLatToXY(D.x,D.y))[0],Z=h[1];else{var B=f.project(k,s.SpatialReference.WGS84,j._spatialReference),N=f.project(D,s.SpatialReference.WGS84,j._spatialReference);if(!B||!N)return i(\"esri-2d-debug\")&&console.debug(\"Failed to reproject known tree node\"),\"continue\";X=B.x,Y=B.y,A=N.x,Z=N.y}var O=[X,Y,A,Z],U=null;if(j.forEachInBounds(O,(function(e){l._attributeStore.isVisible(e)&&(U&&i(\"esri-2d-debug\")&&console.debug(\"Expected to find only one feature, but found multiple\"),U=e)})),!U)return i(\"esri-2d-debug\")&&console.debug(\"Expected to find a feature, but found none\"),\"continue\";var W=v.getGeometry(j.geometryInfo.geometryType,j.geometryInfo.hasZ,j.geometryInfo.hasM,U.geometry,0,a.unwrap(S)),Q=r.__assign(r.__assign({},U.attributes),x.attributes);x.referenceId=U.localId,g.add(x.objectId),T.push(new p.Feature(Q,x.localId,W))}else if(u){g.add(x.objectId);W=v.getGeometry(j.geometryInfo.geometryType,j.geometryInfo.hasZ,j.geometryInfo.hasM,x.geometry,0,a.unwrap(S));T.push(new p.Feature(x.attributes,x.localId,W))}}},j=this,G=E;G<=F;G++)M(G);return{features:T,objectIds:g}},t.prototype._getGeohashLevel=function(e){return Math.min(Math.ceil(e/2+2),12)},t.prototype._setGeohashLevel=function(e){var t=this,r=this._geohashLevel,s=this._getGeohashLevel(e),i=2*(Math.floor(s/2)+1)-1,o=this._tree;this._geohashLevel=i,a.isNone(o)||(i>r?(o.dropLevels(0),this._featuresById.forEach((function(e){e.geohashIndexed&&(t._setGeohash(e),o.insert(e,t._geohashLevel),e.geohashIndexed=!0)}))):i<r&&o.dropLevels(this._geohashLevel))},t.prototype._insertIntoIndex=function(e){e.geohashIndexed||(this._invalidated=!0,e.geohashIndexed=!0,a.unwrap(this._tree).insert(e,this._geohashLevel))},t.prototype._removeFromIndex=function(e){e.geohashIndexed&&(this._invalidated=!0,a.unwrap(this._tree).remove(e,this._geohashLevel),e.geohashIndexed=!1)},t.prototype._handleClusterUpdates=function(){var e=this;this._invalidated&&this._clusters.size&&this._clusters.forEach((function(t){a.isSome(t)&&(t.invalid=t.invalid||e._invalidated)})),this._invalidated=!1},t.prototype._getTransforms=function(e,t){var s={originPosition:\"upperLeft\",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},i=h.getInfo(t);if(!i)return{tile:s,left:null,right:null};var a=i.valid,o=a[0],n=a[1];return{tile:s,left:r.__assign(r.__assign({},s),{translate:[n,e.bounds[3]]}),right:r.__assign(r.__assign({},s),{translate:[o-n+e.bounds[0],e.bounds[3]]})}},t.prototype._getClusterId=function(e,t,r){return(15&e)<<28|(16383&t)<<14|16383&r},t.prototype._markForDeletion=function(e,t,r){var s=this._getClusterId(e,t,r);if(this._clusters.has(s)){var i=this._clusters.get(s);a.isSome(i)?i.canDelete=!0:this._clusters.delete(s)}},t.prototype._getClusterBounds=function(e,t,r){if(a.isNone(this._featureReduction))return null;var s=this._featureReduction.clusterRadius,i=2*s,o=r%2?t*i:t*i+s,n=r*i,u=o/m.TILE_SIZE,l=n/m.TILE_SIZE,h=(o+i)/m.TILE_SIZE,c=(n-i)/m.TILE_SIZE;return[e.getXForColumn(u),e.getYForRow(l),e.getXForColumn(h),e.getYForRow(c)]},t.prototype._lookupCluster=function(e,t,i,o,n){var u,h;if(a.isNone(this._featureReduction)||a.isNone(this._tree))return null;var g=this._getClusterId(t,i,o),d=this._clusters.get(g);if(d&&a.isSome(d)&&!d.invalid&&!d.canDelete)return d;var _=this._getClusterBounds(e,i,o),p=_[0],v=_[1],y=_[2],I=_[3],m={x:p,y:v},x={x:y,y:I},S=0,b=0,L=0,E=0;if(this._spatialReference.isWebMercator)S=(u=c.xyToLngLat(m.x,m.y))[0],b=u[1],L=(h=c.xyToLngLat(x.x,x.y))[0],E=h[1];else{var w=f.project(m,this._spatialReference,s.SpatialReference.WGS84),F=f.project(x,this._spatialReference,s.SpatialReference.WGS84);if(!w||!F)return null;S=w.x,b=w.y,L=F.x,E=F.y}S>L&&(L=180);var T={geohashX:0,geohashY:0},V={geohashX:0,geohashY:0};l.setGeohashXY(T,b,S,n),l.setGeohashXY(V,E,L,n);var C=T.geohashX,M=T.geohashY,j=V.geohashX,G=V.geohashY,k={xLL:C,yLL:M,xTR:j,yTR:G,level:n},D=this._tree.getRegionStatistics(C,M,j,G,n),X=D.count,Y=D.xTotal,A=D.yTotal,Z=X?Y/X:0,B=X?A/X:0;if(a.isSome(d)&&d.canDelete){var N=this._attributeStore.removeLocalId(d.objectId);this._deferredDeletionQueue.push(N)}var O=a.isSome(d)&&!d.canDelete&&d.invalid,U=r.__assign({cluster_count:X},D.attributes),W=this._attributeStore,Q=O?d.update(Z,B,t,U,k):R.create(W,g,Z,B,t,U,k);return 0===X&&(Q.geometry.coords[0]=(p+y)/2,Q.geometry.coords[1]=(v+I)/2),this._attributeStore.setAttributeData(Q.localId,Q,this.geometryInfo,null),this._clusters.set(g,Q),this._updateAggregateValueRangeForCluster(Q,Q.tileLevel),Q},t.prototype._updateAggregateValueRangeForCluster=function(e,t){var r=this._aggregateValueRanges[t]||{minValue:1/0,maxValue:0},s=r.minValue,i=r.maxValue;r.minValue=Math.min(s,e.count),r.maxValue=Math.max(i,e.count),this._aggregateValueRanges[t]=r,s===r.minValue&&i===r.maxValue||(this._aggregateValueRangesChanged=!0)},t.prototype._markTileClustersForDeletion=function(e,t){for(var r=2*t,s=Math.ceil(m.TILE_SIZE/r),i=e.key,a=i.row,o=i.col*m.TILE_SIZE,n=a*m.TILE_SIZE,u=Math.floor(o/r),l=Math.floor(n/r),h=u;h<u+s;h++)for(var c=l;c<l+s;c++)this._markForDeletion(e.key.level,h,c)},t.prototype._setGeohash=function(e){var t=e.geometry;if(t&&t.coords.length){var r={x:t.coords[0],y:t.coords[1]},a=f.project(r,this._spatialReference,s.SpatialReference.WGS84);a?l.setGeohashXY(e,a.y,a.x,12):i(\"esri-2d-debug\")&&console.debug(\"Tried to project feature geometry, but got back `null`\")}},t.prototype._add=function(t){var r=this._featuresById.get(t.objectId);e.prototype._add.call(this,t),this._ensureAggregateFields(t),a.isSome(this._featureReduction)&&a.isSome(this._tree)&&(r?(t.geohashIndexed=r.geohashIndexed,t.geohashX=r.geohashX,t.geohashY=r.geohashY):this._setGeohash(t),!t.geohashIndexed&&this._attributeStore.isVisible(t)&&this._insertIntoIndex(t))},t.prototype._remove=function(t){return a.isSome(this._featureReduction)&&a.isSome(this._tree)&&this._removeFromIndex(t),e.prototype._remove.call(this,t)},t}(_.default);t.ClusterStore=L}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/views/2d/layers/features/support/ClusterStore.js?')},\"./node_modules/arcgis-js-api/views/2d/layers/features/support/pixelBuffering.js\":function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// COPYRIGHT © 2020 Esri\\n//\\n// All rights reserved under the copyright laws of the United States\\n// and applicable international laws, treaties, and conventions.\\n//\\n// This material is licensed for use under the Esri Master License\\n// Agreement (MLA), and is bound by the terms of that agreement.\\n// You may redistribute and use this code without modification,\\n// provided you adhere to the terms of the MLA and include this\\n// copyright notice.\\n//\\n// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english\\n//\\n// For additional information, contact:\\n// Environmental Systems Research Institute, Inc.\\n// Attn: Contracts and Legal Services Department\\n// 380 New York Street\\n// Redlands, California, USA 92373\\n// USA\\n//\\n// email: contracts@esri.com\\n//\\n// See http://js.arcgis.com/4.16/esri/copyright.txt for details.\\n\\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__.dj.c(module.i),exports,__webpack_require__(/*! tslib */ \"./node_modules/tslib/tslib.js\"),__webpack_require__(/*! ../../../../../core/promiseUtils */ \"./node_modules/arcgis-js-api/core/promiseUtils.js\"),__webpack_require__(/*! ../../../../../core/screenUtils */ \"./node_modules/arcgis-js-api/core/screenUtils.js\"),__webpack_require__(/*! ../../../../../symbols/cim/Rect */ \"./node_modules/arcgis-js-api/symbols/cim/Rect.js\"),__webpack_require__(/*! ../../../engine */ \"./node_modules/arcgis-js-api/views/2d/engine.js\"),__webpack_require__(/*! ../../../engine/webgl/definitions */ \"./node_modules/arcgis-js-api/views/2d/engine/webgl/definitions.js\"),__webpack_require__(/*! ../../graphics/graphicsUtils */ \"./node_modules/arcgis-js-api/views/2d/layers/graphics/graphicsUtils.js\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(e,t,r,i,n,a,s,u,o){Object.defineProperty(t,\"__esModule\",{value:!0});var l={\"simple-marker\":1,\"picture-marker\":1,text:1,\"simple-line\":1,\"simple-fill\":1,\"picture-fill\":1,cim:1,\"web-style\":1};t.computePxBuffer=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var a,s,u,o,l,c,p;return r.__generator(this,(function(r){switch(r.label){case 0:if(\"heatmap\"===e.type)return[2,Math.round(3*e.blurRadius)];if(\"dot-density\"===e.type)return[2,0];if(\"dictionary\"===e.type)return\"esriGeometryPoint\"===t||\"esriGeometryMultipoint\"===t?[2,100]:[2,50];for(a=e.getSymbols(),s=function(e){if(!(\"visualVariables\"in e))return 0;if(!e.hasVisualVariables(\"size\"))return 0;var t=e.getVisualVariablesForType(\"size\");if(!t[0])return 0;var r=t[0];return\"stops\"===r.transformationType?r.stops.map((function(e){return e.size})).reduce(g,0):\"clamped-linear\"===r.transformationType?\"number\"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map((function(e){return e.size})).reduce(g,0):\"real-world-size\"===r.transformationType?30:void 0}(e),u=[],o=0,l=a;o<l.length;o++)c=l[o],u.push(d(c,s));return[4,i.all(u)];case 1:return p=r.sent(),[2,n.pt2px(p.reduce(g,0))]}}))}))};var c=[0,0,0,0];function p(e,t){return null==e?t:e}function h(e,t){return null==e.outline?t:p(e.outline.width,t)}var f={sdf:!0,code:99,metrics:u.AVERAGE_GLYPH_MOSAIC_ITEM.metrics,rect:new a.default(0,0,24,24),page:0,textureBinding:2};function m(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,a,u,l,d,g,M,v,x,_,b,w,z;return r.__generator(this,(function(S){switch(S.label){case 0:return\"simple-marker\"===e.type?(i=Math.max(p(e.size,12),t),[2,y(e)+.707*i]):\"picture-marker\"===e.type?(n=Math.max(p(e.height,12),t),a=p(e.width,12)*(n/p(e.height,12)),u=a/2,l=n/2,[2,y(e)+Math.sqrt(u*u+l*l)]):\"text\"===e.type?(d=function(e){var t=e.text&&e.text.length;if(!t)return{glyphMosaicItems:[f]};for(var i=[],n=0;n<t;n++)i.push(r.__assign(r.__assign({},f),{code:e.text.charCodeAt(n)}));return{glyphMosaicItems:i}}(e),o.getTextSymbolSize(c,e,d),g=Math.abs(c[0]),M=Math.abs(c[1]),v=c[2],x=c[3],[2,Math.max(g,M)+Math.max(v,x)]):\"simple-line\"===e.type?(_=e,b=Math.max(p(_.width,.75),t)/2,_.marker?[2,Math.max(6*_.width,2*t)]:[2,b]):\"simple-fill\"===e.type||\"picture-fill\"===e.type?[2,Math.max(h(e,0),t)/2]:\"cim\"===e.type?(w=s.CIMSymbolHelper.getEnvelope(e.data))?[2,Math.sqrt(w.width*w.width+w.height*w.height)]:[2,0]:\"web-style\"!==e.type?[3,2]:(z=m,[4,e.fetchCIMSymbol()]);case 1:return[2,z.apply(void 0,[S.sent(),t])];case 2:return[2,0]}}))}))}function d(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n;return r.__generator(this,(function(r){switch(r.label){case 0:return function(e){return e.type in l}(e)?(n=(i=Math).min,[4,m(e,t)]):[2,0];case 1:return[2,n.apply(i,[r.sent(),75])]}}))}))}function y(e){var t=p(e.xoffset,0),r=p(e.yoffset,0);return Math.sqrt(t*t+r*r)}function g(e,t){return Math.max(e,t)}}).apply(null, __WEBPACK_AMD_DEFINE_ARRAY__),\\n\\t\\t\\t\\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\\n\\n//# sourceURL=webpack:///./node_modules/arcgis-js-api/views/2d/layers/features/support/pixelBuffering.js?')}}]);","extractedComments":[]}