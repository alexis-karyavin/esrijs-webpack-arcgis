// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.16/esri/copyright.txt for details.

define(["require","exports","tslib","../../../Viewpoint","../../../core/Accessor","../../../core/accessorSupport/decorators","../../../geometry/Point","../viewpointUtils","./ZoomBox","./actions/Pan","./actions/Pinch","./actions/Rotate"],(function(t,i,o,n,e,a,r,s,p,c,u,h){Object.defineProperty(i,"__esModule",{value:!0});var v=new n({targetGeometry:new r}),d=[0,0],_=function(t){function i(i){var o=t.call(this,i)||this;return o._endTimer=null,o.animationManager=null,o}return o.__extends(i,t),i.prototype.initialize=function(){this.pan=new c({navigation:this}),this.rotate=new h({navigation:this}),this.pinch=new u({navigation:this}),this.zoomBox=new p({view:this.view,navigation:this})},i.prototype.destroy=function(){this.zoomBox.destroy(),this.zoomBox=null,this.animationManager=null},i.prototype.begin=function(){this._set("interacting",!0)},i.prototype.end=function(){this._lastEventTimestamp=performance.now(),this._startTimer(250)},i.prototype.zoom=function(t,i){return void 0===i&&(i=this._getDefaultAnchor()),o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(o){return this.stop(),this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs?t<1?[2,this.zoomIn(i)]:[2,this.zoomOut(i)]:(this.setViewpoint(i,t,0,[0,0]),[2])}))}))},i.prototype.zoomIn=function(t){return o.__awaiter(this,void 0,void 0,(function(){var i,n;return o.__generator(this,(function(o){return i=this.view,n=i.constraints.snapToNextScale(i.scale),[2,this._zoomToScale(n,t)]}))}))},i.prototype.zoomOut=function(t){return o.__awaiter(this,void 0,void 0,(function(){var i,n;return o.__generator(this,(function(o){return i=this.view,n=i.constraints.snapToPreviousScale(i.scale),[2,this._zoomToScale(n,t)]}))}))},i.prototype.setViewpoint=function(t,i,o,n){this.begin(),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,t,i,o,n),this.end()},i.prototype.setViewpointImmediate=function(t,i,o,n){void 0===i&&(i=0),void 0===o&&(o=[0,0]),void 0===n&&(n=this._getDefaultAnchor()),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,n,t,i,o)},i.prototype.continousRotateClockwise=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(function(t){s.rotateBy(t,t,-1)}))},i.prototype.continousRotateCounterclockwise=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(function(t){s.rotateBy(t,t,1)}))},i.prototype.resetRotation=function(){this.view.rotation=0},i.prototype.continousPanLeft=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(function(t){s.translateBy(t,t,[-10,0])}))},i.prototype.continousPanRight=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(function(t){s.translateBy(t,t,[10,0])}))},i.prototype.continousPanUp=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(function(t){s.translateBy(t,t,[0,10])}))},i.prototype.continousPanDown=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(function(t){s.translateBy(t,t,[0,-10])}))},i.prototype.stop=function(){this.pan.stopMomentumNavigation(),this.animationManager.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))},i.prototype._startTimer=function(t){var i=this;return null!==this._endTimer?this._endTimer:(this._endTimer=setTimeout((function(){i._endTimer=null;var t=performance.now()-i._lastEventTimestamp;t<250?i._endTimer=i._startTimer(t):i._set("interacting",!1)}),t),this._endTimer)},i.prototype._getDefaultAnchor=function(){var t=this.view,i=t.size,o=t.padding,n=o.left,e=o.right,a=o.top,r=o.bottom;return d[0]=.5*(i[0]-e+n),d[1]=.5*(i[1]-r+a),d},i.prototype._zoomToScale=function(t,i){return void 0===i&&(i=this._getDefaultAnchor()),o.__awaiter(this,void 0,void 0,(function(){var n,e,a,r,p,c,u,h;return o.__generator(this,(function(o){return n=this.view,e=n.constraints,a=n.scale,r=n.viewpoint,p=n.size,c=n.padding,u=e.canZoomInTo(t),h=e.canZoomOutTo(t),t<a&&!u||t>a&&!h?[2]:[2,n.goTo(s.padAndScaleAndRotateBy(v,r,t/a,0,i,p,c),{animate:!0})]}))}))},i.prototype._scaleRotateTranslateViewpoint=function(t,i,o,n,e){var a=this.view,r=a.size,p=a.padding,c=a.constraints,u=a.scale,h=a.viewpoint,v=u*o,d=c.canZoomInTo(v),_=c.canZoomOutTo(v);return(o<1&&!d||o>1&&!_)&&(o=1),s.translateBy(h,h,e),s.padAndScaleAndRotateBy(t,h,o,n,i,r,p)},o.__decorate([a.property()],i.prototype,"animationManager",void 0),o.__decorate([a.property({type:Boolean,readOnly:!0})],i.prototype,"interacting",void 0),o.__decorate([a.property()],i.prototype,"pan",void 0),o.__decorate([a.property()],i.prototype,"pinch",void 0),o.__decorate([a.property()],i.prototype,"rotate",void 0),o.__decorate([a.property()],i.prototype,"view",void 0),o.__decorate([a.property()],i.prototype,"zoomBox",void 0),i=o.__decorate([a.subclass("esri.views.2d.navigation.MapViewNavigation")],i)}(e);i.default=_}));