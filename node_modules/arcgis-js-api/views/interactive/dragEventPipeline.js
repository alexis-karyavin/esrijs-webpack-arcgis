// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.16/esri/copyright.txt for details.

define(["require","exports","tslib","../../core/handleUtils","../../core/lang","../../core/mathUtils","../../core/maybe","../../core/screenUtils","../../geometry/support/webMercatorUtils","../draw/support/drawUtils"],(function(n,e,t,r,a,i,o,c,u,s){function l(n,e){var t=null,r=null;return function(a){if("cancel"!==a.action){var i={action:a.action,screenStart:a.start,screenEnd:a.screenPoint};"start"===a.action&&o.isNone(t)&&(t=new S,r=new S,e(n,t,r,i)),o.isSome(t)&&t.execute(i),"end"===a.action&&o.isSome(t)&&(t=null,r=null)}else o.isSome(r)&&(r.execute({action:"cancel"}),t=null,r=null)}}function p(n,e){return n.events.on("drag",l(n,e))}function f(n,e){var r=null,a=o.isSome(n[e])?n[e].spatialReference:null;return function(i){var c,l;if("start"===i.action&&o.isSome(n[e])&&(c=n[e],l=i.mapStart.spatialReference,r=o.isNone(c)||"mesh"===c.type?null:c.spatialReference.equals(l)?c.clone():u.canProject(c,l)?u.project(c,l):null),o.isNone(r))return null;var p=i.mapEnd.x-i.mapStart.x,f=i.mapEnd.y-i.mapStart.y,m=i.mapEnd.z-i.mapStart.z,d=s.move(r.clone(),p,f,m);return d.spatialReference.equals(a)?n[e]=d:n[e]=u.project(d,a),t.__assign(t.__assign({},i),{translationX:p,translationY:f,translationZ:m})}}function m(n){return f(n,"geometry")}function d(n,e){for(var t=new Map,r=0,i=e;r<i.length;r++){var o=i[r];t.set(o,a.clone(n[o]))}return function(e){return t.forEach((function(e,t){n[t]=e})),e}}function v(n){return d(n,["geometry"])}Object.defineProperty(e,"__esModule",{value:!0}),e.createDragEventPipelineCallback=l,e.createManipulatorDragEventPipeline=p,e.createManipulatorDragEventPipelineMany=function(n,e){for(var t=[],a=0,i=n;a<i.length;a++){var o=i[a];t.push(p(o,e))}return r.handlesGroup(t)},e.constrainToMapAxis=function(n,e){var t=[n.x,n.y,n.z],r=e,a=[Math.cos(r),Math.sin(r)],i=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(0===i)return null;a[0]/=i,a[1]/=i;var o=function(n){var e=(n.x-t[0])*a[0]+(n.y-t[1])*a[1];n.x=t[0]+e*a[0],n.y=t[1]+e*a[1]};return function(n){return o(n.mapStart),o(n.mapEnd),n}},e.dragGeometry=f,e.dragGraphic=m,e.screenToMap=function(n,e,r){void 0===e&&(e=null);var a=null,i=o.isSome(e)&&!n.spatialReference.equals(e)?function(n){return o.isSome(n)?u.project(n,e):n}:function(n){return n},c=t.__assign({exclude:[]},r);return function(e){if("start"===e.action&&(a=i(n.toMap(e.screenStart,c))),o.isNone(a))return null;var r=i(n.toMap(e.screenEnd,c));return o.isSome(r)?t.__assign(t.__assign({},e),{mapStart:a,mapEnd:r}):null}},e.dragGraphicMany=function(n){var e=n.map((function(n){return o.unwrap(m(n))})).filter((function(n){return o.isSome(n)}));return function(n){var r=n.mapEnd.x-n.mapStart.x,a=n.mapEnd.y-n.mapStart.y,i=n.mapEnd.z-n.mapStart.z;return e.forEach((function(e){return e(n)})),t.__assign(t.__assign({},n),{translationX:r,translationY:a,translationZ:i})}},e.resetProperties=d,e.resetGraphic=v,e.resetGraphicMany=function(n){var e=n.map((function(n){return o.unwrap(v(n))})).filter((function(n){return o.isSome(n)}));return function(n){return e.forEach((function(e){return e(n)})),n}},e.resetSymbol=function(n){var e=o.isSome(n.symbol)?n.symbol.clone():null;return function(t){return n.symbol=e,t}},e.horizontalDegreesOfFreedom=3,e.verticalDegreesOfFreedom=4,e.allDegreesOfFreedom=7,e.addMapDelta=function(n){void 0===n&&(n=e.allDegreesOfFreedom);var r=0,a=0,i=0;return function(e){"start"===e.action&&(r=e.mapStart.x,a=e.mapStart.y,i=e.mapStart.z);var o=1&n?e.mapEnd.x-r:0,c=2&n?e.mapEnd.y-a:0,u=4&n?e.mapEnd.z-i:0;return r=e.mapEnd.x,a=e.mapEnd.y,i=e.mapEnd.z,t.__assign(t.__assign({},e),{mapDeltaX:o,mapDeltaY:c,mapDeltaZ:u,mapDeltaSpatialReference:e.mapStart.spatialReference})}},e.addScreenDelta=function(n){void 0===n&&(n=e.allDegreesOfFreedom);var r=0,a=0;return function(e){"start"===e.action&&(r=e.screenStart.x,a=e.screenStart.y);var i=1&n?e.screenEnd.x-r:0,o=2&n?e.screenEnd.y-a:0;return r=e.screenEnd.x,a=e.screenEnd.y,t.__assign(t.__assign({},e),{screenDeltaX:i,screenDeltaY:o})}},e.dragAtLocation=function(n,e){var t=null,r=0,a=0;return function(o){if("start"===o.action&&((t=n.toScreen(e)).x<0||t.x>n.width||t.y<0||t.y>n.height?t=null:(r=o.screenStart.x-t.x,a=o.screenStart.y-t.y)),null==t)return null;var u=i.clamp(o.screenEnd.x-r,0,n.width),s=i.clamp(o.screenEnd.y-a,0,n.height),l=c.createScreenPoint(u,s);return o.screenStart=t,o.screenEnd=l,o}};var S=function(){function n(){this.execute=function(){}}return n.prototype.next=function(e,t){return void 0===t&&(t=new n),o.isSome(e)&&(this.execute=function(n){var r=e(n);o.isSome(r)&&t.execute(r)}),t},n}();e.EventPipeline=S}));