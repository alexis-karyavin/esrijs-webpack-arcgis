// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.16/esri/copyright.txt for details.

define(["require","exports"],(function(e,a){function r(e,a){return Number(e.toFixed(a))}function n(e,a,r){return e===a?r&&"percent-of-total"===r?e+"%":e.toString():r&&"percent-of-total"===r?e+"% - "+a+"%":e+" - "+a}function u(e){for(var a=[],r=[],n=Number.MIN_VALUE,u=1,l=-1,t=0;t<e.length;t++){var i=e[t];i===n?(u++,r[l]=u):null!==i&&(a.push(i),n=i,u=1,r.push(u),l++)}return{uniqueValues:a,valueFrequency:r}}function l(e,a,r,n){for(var u=[],l=[],i=[],o=0,s=[],f=[],h=0;h<n;h++){var c=t(h,e,a,r);s.push(c.sbMean),f.push(c.sbSdcm),o+=f[h]}for(var m,v=o,b=!0;b||o<v;){b=!1,u=[];for(h=0;h<n;h++)u.push(e[h]);for(h=0;h<n;h++)for(var V=e[h]+1;V<=e[h+1];V++)if(m=a[V],h>0&&V!==e[h+1]&&Math.abs(m-s[h])>Math.abs(m-s[h-1]))e[h]=V;else if(h<n-1&&e[h]!==V-1&&Math.abs(m-s[h])>Math.abs(m-s[h+1])){e[h+1]=V-1;break}v=o,o=0,l=[],i=[];for(h=0;h<n;h++){l.push(s[h]),i.push(f[h]);c=t(h,e,a,r);s[h]=c.sbMean,f[h]=c.sbSdcm,o+=f[h]}}if(o>v){for(h=0;h<n;h++)e[h]=u[h],s[h]=l[h],f[h]=i[h];o=v}return{mean:s,sdcm:f}}function t(e,a,r,n){for(var u=0,l=0,t=a[e]+1;t<=a[e+1];t++){var i=n[t];u+=r[t]*i,l+=i}l<=0&&console.log("Exception in Natural Breaks calculation");var o=u/l,s=0;for(t=a[e]+1;t<=a[e+1];t++)s+=n[t]*Math.pow(r[t]-o,2);return{sbMean:o,sbSdcm:s}}Object.defineProperty(a,"__esModule",{value:!0}),a.createGenerateRendererUniqueValues=function(e){for(var a=u(e),r=[],n=a.uniqueValues.length,l=0;l<n;l++){var t=a.uniqueValues[l],i=a.valueFrequency[l],o=t.toString();r.push({value:t,count:i,label:o})}return{uniqueValues:r}},a.createGenerateRendererClassBreaks=function(e){var a=e.normalizationTotal;return{classBreaks:function(e){var a=e.definition,i=a.classificationMethod,o=a.breakCount,s=a.normalizationType,f=[],h=e.values;if(0===h.length)return[];var c=(h=h.sort((function(e,a){return e-a})))[0],m=h[h.length-1];if("equal-interval"===i)if(h.length>=o){for(var v=(m-c)/o,b=c,V=1;V<o;V++){var p=r(c+V*v,6);f.push({minValue:b,maxValue:p,label:n(b,p,s)}),b=p}f.push({minValue:b,maxValue:m,label:n(b,m,s)})}else h.forEach((function(e){f.push({minValue:e,maxValue:e,label:n(e,e,s)})}));else if("natural-breaks"===i){var d=u(h),g=function(e,a,r){var n=e.length,u=[];r>n&&(r=n);for(var i=0;i<r;i++)u.push(Math.round(i*n/r-1));u.push(n-1);var o=l(u,e,a,r);(function(e,a,r,n,u,l){for(var i=0,o=0,s=0,f=0,h=!0,c=0;c<2&&h;c++){0===c&&(h=!1);for(var m=0;m<l-1;m++)for(;r[m+1]+1!==r[m+2];){r[m+1]=r[m+1]+1;var v=t(m,r,n,u);s=v.sbMean,i=v.sbSdcm;var b=t(m+1,r,n,u);if(f=b.sbMean,o=b.sbSdcm,!(i+o<a[m]+a[m+1])){r[m+1]=r[m+1]-1;break}a[m]=i,a[m+1]=o,e[m]=s,e[m+1]=f,h=!0}for(m=l-1;m>0;m--)for(;r[m]!==r[m-1]+1;){r[m]=r[m]-1;v=t(m-1,r,n,u);s=v.sbMean,i=v.sbSdcm;b=t(m,r,n,u);if(f=b.sbMean,o=b.sbSdcm,!(i+o<a[m-1]+a[m])){r[m]=r[m]+1;break}a[m-1]=i,a[m]=o,e[m-1]=s,e[m]=f,h=!0}}return h})(o.mean,o.sdcm,u,e,a,r)&&(o=l(u,e,a,r));return u}(d.uniqueValues,d.valueFrequency,o);for(b=c,V=1;V<o;V++)if(d.uniqueValues.length>V){p=r(d.uniqueValues[g[V]],6);f.push({minValue:b,maxValue:p,label:n(b,p,s)}),b=p}f.push({minValue:b,maxValue:m,label:n(b,m,s)})}else if("quantile"===i)if(h.length>=o&&c!==m){b=c;var M=Math.ceil(h.length/o),x=0;for(V=1;V<o;V++){var q=M+x-1;q>h.length&&(q=h.length-1),q<0&&(q=0),f.push({minValue:b,maxValue:h[q],label:n(b,h[q],s)}),b=h[q],x+=M,M=Math.ceil((h.length-x)/(o-V))}f.push({minValue:b,maxValue:m,label:n(b,m,s)})}else for(b=-1,V=0;V<h.length;V++){(p=h[V])!==b&&(b=p,f.push({minValue:b,maxValue:p,label:n(b,p,s)}),b=p)}else if("standard-deviation"===i){var S=function(e){for(var a=0,r=0;r<e.length;r++)a+=e[r];return a/=e.length}(h),k=function(e,a){for(var r=0,n=0;n<e.length;n++){var u=e[n];r+=(u-a)*(u-a)}return r/=e.length,Math.sqrt(r)}(h,S);if(0===k)f.push({minValue:h[0],maxValue:h[0],label:n(h[0],h[0],s)});else{var y=(v=function(e,a,r,n,u){var l=Math.max(n-e,a-n)/u/r;l=l>=1?1:l>=.5?.5:.25;return l}(c,m,o,S,k))*k,F=0;for(b=c,V=o;V>=1;V--){var N=r(S-(V-.5)*y,6);f.push({minValue:b,maxValue:N,label:n(b,N,s)}),b=N,F++}p=r(S+.5*y,6);f.push({minValue:b,maxValue:p,label:n(b,p,s)}),b=p,F++;for(V=1;V<=o;V++)p=F===2*o?m:r(S+(V+.5)*y,6),f.push({minValue:b,maxValue:p,label:n(b,p,s)}),b=p,F++}}return f}(e),normalizationTotal:a}}}));