// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.16/esri/copyright.txt for details.

define(["require","exports","../factories/vec3f64","./common"],(function(t,a,n,r){function o(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function h(t,a,n){var r=a[0],o=a[1],h=a[2],M=a[3],i=a[4],s=a[5],u=a[6],e=a[7],c=a[8],f=a[9],v=a[10],b=a[11],m=a[12],d=a[13],l=a[14],p=a[15],S=n[0],P=n[1],I=n[2],O=n[3];return t[0]=S*r+P*i+I*c+O*m,t[1]=S*o+P*s+I*f+O*d,t[2]=S*h+P*u+I*v+O*l,t[3]=S*M+P*e+I*b+O*p,S=n[4],P=n[5],I=n[6],O=n[7],t[4]=S*r+P*i+I*c+O*m,t[5]=S*o+P*s+I*f+O*d,t[6]=S*h+P*u+I*v+O*l,t[7]=S*M+P*e+I*b+O*p,S=n[8],P=n[9],I=n[10],O=n[11],t[8]=S*r+P*i+I*c+O*m,t[9]=S*o+P*s+I*f+O*d,t[10]=S*h+P*u+I*v+O*l,t[11]=S*M+P*e+I*b+O*p,S=n[12],P=n[13],I=n[14],O=n[15],t[12]=S*r+P*i+I*c+O*m,t[13]=S*o+P*s+I*f+O*d,t[14]=S*h+P*u+I*v+O*l,t[15]=S*M+P*e+I*b+O*p,t}function M(t,a,n){var r=a[0],o=a[1],h=a[2],M=a[3],i=r+r,s=o+o,u=h+h,e=r*i,c=r*s,f=r*u,v=o*s,b=o*u,m=h*u,d=M*i,l=M*s,p=M*u;return t[0]=1-(v+m),t[1]=c+p,t[2]=f-l,t[3]=0,t[4]=c-p,t[5]=1-(e+m),t[6]=b+d,t[7]=0,t[8]=f+l,t[9]=b-d,t[10]=1-(e+v),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}Object.defineProperty(a,"__esModule",{value:!0}),a.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},a.set=function(t,a,n,r,o,h,M,i,s,u,e,c,f,v,b,m,d){return t[0]=a,t[1]=n,t[2]=r,t[3]=o,t[4]=h,t[5]=M,t[6]=i,t[7]=s,t[8]=u,t[9]=e,t[10]=c,t[11]=f,t[12]=v,t[13]=b,t[14]=m,t[15]=d,t},a.identity=o,a.transpose=function(t,a){if(t===a){var n=a[1],r=a[2],o=a[3],h=a[6],M=a[7],i=a[11];t[1]=a[4],t[2]=a[8],t[3]=a[12],t[4]=n,t[6]=a[9],t[7]=a[13],t[8]=r,t[9]=h,t[11]=a[14],t[12]=o,t[13]=M,t[14]=i}else t[0]=a[0],t[1]=a[4],t[2]=a[8],t[3]=a[12],t[4]=a[1],t[5]=a[5],t[6]=a[9],t[7]=a[13],t[8]=a[2],t[9]=a[6],t[10]=a[10],t[11]=a[14],t[12]=a[3],t[13]=a[7],t[14]=a[11],t[15]=a[15];return t},a.invert=function(t,a){var n=a[0],r=a[1],o=a[2],h=a[3],M=a[4],i=a[5],s=a[6],u=a[7],e=a[8],c=a[9],f=a[10],v=a[11],b=a[12],m=a[13],d=a[14],l=a[15],p=n*i-r*M,S=n*s-o*M,P=n*u-h*M,I=r*s-o*i,O=r*u-h*i,E=o*u-h*s,L=e*m-c*b,N=e*d-f*b,q=e*l-v*b,w=c*d-f*m,x=c*l-v*m,g=f*l-v*d,R=p*g-S*x+P*w+I*q-O*N+E*L;return R?(R=1/R,t[0]=(i*g-s*x+u*w)*R,t[1]=(o*x-r*g-h*w)*R,t[2]=(m*E-d*O+l*I)*R,t[3]=(f*O-c*E-v*I)*R,t[4]=(s*q-M*g-u*N)*R,t[5]=(n*g-o*q+h*N)*R,t[6]=(d*P-b*E-l*S)*R,t[7]=(e*E-f*P+v*S)*R,t[8]=(M*x-i*q+u*L)*R,t[9]=(r*q-n*x-h*L)*R,t[10]=(b*O-m*P+l*p)*R,t[11]=(c*P-e*O-v*p)*R,t[12]=(i*N-M*w-s*L)*R,t[13]=(n*w-r*N+o*L)*R,t[14]=(m*S-b*I-d*p)*R,t[15]=(e*I-c*S+f*p)*R,t):null},a.adjoint=function(t,a){var n=a[0],r=a[1],o=a[2],h=a[3],M=a[4],i=a[5],s=a[6],u=a[7],e=a[8],c=a[9],f=a[10],v=a[11],b=a[12],m=a[13],d=a[14],l=a[15];return t[0]=i*(f*l-v*d)-c*(s*l-u*d)+m*(s*v-u*f),t[1]=-(r*(f*l-v*d)-c*(o*l-h*d)+m*(o*v-h*f)),t[2]=r*(s*l-u*d)-i*(o*l-h*d)+m*(o*u-h*s),t[3]=-(r*(s*v-u*f)-i*(o*v-h*f)+c*(o*u-h*s)),t[4]=-(M*(f*l-v*d)-e*(s*l-u*d)+b*(s*v-u*f)),t[5]=n*(f*l-v*d)-e*(o*l-h*d)+b*(o*v-h*f),t[6]=-(n*(s*l-u*d)-M*(o*l-h*d)+b*(o*u-h*s)),t[7]=n*(s*v-u*f)-M*(o*v-h*f)+e*(o*u-h*s),t[8]=M*(c*l-v*m)-e*(i*l-u*m)+b*(i*v-u*c),t[9]=-(n*(c*l-v*m)-e*(r*l-h*m)+b*(r*v-h*c)),t[10]=n*(i*l-u*m)-M*(r*l-h*m)+b*(r*u-h*i),t[11]=-(n*(i*v-u*c)-M*(r*v-h*c)+e*(r*u-h*i)),t[12]=-(M*(c*d-f*m)-e*(i*d-s*m)+b*(i*f-s*c)),t[13]=n*(c*d-f*m)-e*(r*d-o*m)+b*(r*f-o*c),t[14]=-(n*(i*d-s*m)-M*(r*d-o*m)+b*(r*s-o*i)),t[15]=n*(i*f-s*c)-M*(r*f-o*c)+e*(r*s-o*i),t},a.determinant=function(t){var a=t[0],n=t[1],r=t[2],o=t[3],h=t[4],M=t[5],i=t[6],s=t[7],u=t[8],e=t[9],c=t[10],f=t[11],v=t[12],b=t[13],m=t[14],d=t[15];return(a*M-n*h)*(c*d-f*m)-(a*i-r*h)*(e*d-f*b)+(a*s-o*h)*(e*m-c*b)+(n*i-r*M)*(u*d-f*v)-(n*s-o*M)*(u*m-c*v)+(r*s-o*i)*(u*b-e*v)},a.multiply=h,a.translate=function(t,a,n){var r=n[0],o=n[1],h=n[2],M=void 0,i=void 0,s=void 0,u=void 0,e=void 0,c=void 0,f=void 0,v=void 0,b=void 0,m=void 0,d=void 0,l=void 0;return a===t?(t[12]=a[0]*r+a[4]*o+a[8]*h+a[12],t[13]=a[1]*r+a[5]*o+a[9]*h+a[13],t[14]=a[2]*r+a[6]*o+a[10]*h+a[14],t[15]=a[3]*r+a[7]*o+a[11]*h+a[15]):(M=a[0],i=a[1],s=a[2],u=a[3],e=a[4],c=a[5],f=a[6],v=a[7],b=a[8],m=a[9],d=a[10],l=a[11],t[0]=M,t[1]=i,t[2]=s,t[3]=u,t[4]=e,t[5]=c,t[6]=f,t[7]=v,t[8]=b,t[9]=m,t[10]=d,t[11]=l,t[12]=M*r+e*o+b*h+a[12],t[13]=i*r+c*o+m*h+a[13],t[14]=s*r+f*o+d*h+a[14],t[15]=u*r+v*o+l*h+a[15]),t},a.scale=function(t,a,n){var r=n[0],o=n[1],h=n[2];return t[0]=a[0]*r,t[1]=a[1]*r,t[2]=a[2]*r,t[3]=a[3]*r,t[4]=a[4]*o,t[5]=a[5]*o,t[6]=a[6]*o,t[7]=a[7]*o,t[8]=a[8]*h,t[9]=a[9]*h,t[10]=a[10]*h,t[11]=a[11]*h,t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},a.rotate=function(t,a,n,o){var h,M,i,s,u,e,c,f,v,b,m,d,l,p,S,P,I,O,E,L,N,q,w,x,g=o[0],R=o[1],y=o[2],T=Math.sqrt(g*g+R*R+y*y);return T<r.EPSILON?null:(g*=T=1/T,R*=T,y*=T,h=Math.sin(n),i=1-(M=Math.cos(n)),s=a[0],u=a[1],e=a[2],c=a[3],f=a[4],v=a[5],b=a[6],m=a[7],d=a[8],l=a[9],p=a[10],S=a[11],P=g*g*i+M,I=R*g*i+y*h,O=y*g*i-R*h,E=g*R*i-y*h,L=R*R*i+M,N=y*R*i+g*h,q=g*y*i+R*h,w=R*y*i-g*h,x=y*y*i+M,t[0]=s*P+f*I+d*O,t[1]=u*P+v*I+l*O,t[2]=e*P+b*I+p*O,t[3]=c*P+m*I+S*O,t[4]=s*E+f*L+d*N,t[5]=u*E+v*L+l*N,t[6]=e*E+b*L+p*N,t[7]=c*E+m*L+S*N,t[8]=s*q+f*w+d*x,t[9]=u*q+v*w+l*x,t[10]=e*q+b*w+p*x,t[11]=c*q+m*w+S*x,a!==t&&(t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t)},a.rotateX=function(t,a,n){var r=Math.sin(n),o=Math.cos(n),h=a[4],M=a[5],i=a[6],s=a[7],u=a[8],e=a[9],c=a[10],f=a[11];return a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[4]=h*o+u*r,t[5]=M*o+e*r,t[6]=i*o+c*r,t[7]=s*o+f*r,t[8]=u*o-h*r,t[9]=e*o-M*r,t[10]=c*o-i*r,t[11]=f*o-s*r,t},a.rotateY=function(t,a,n){var r=Math.sin(n),o=Math.cos(n),h=a[0],M=a[1],i=a[2],s=a[3],u=a[8],e=a[9],c=a[10],f=a[11];return a!==t&&(t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=h*o-u*r,t[1]=M*o-e*r,t[2]=i*o-c*r,t[3]=s*o-f*r,t[8]=h*r+u*o,t[9]=M*r+e*o,t[10]=i*r+c*o,t[11]=s*r+f*o,t},a.rotateZ=function(t,a,n){var r=Math.sin(n),o=Math.cos(n),h=a[0],M=a[1],i=a[2],s=a[3],u=a[4],e=a[5],c=a[6],f=a[7];return a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=h*o+u*r,t[1]=M*o+e*r,t[2]=i*o+c*r,t[3]=s*o+f*r,t[4]=u*o-h*r,t[5]=e*o-M*r,t[6]=c*o-i*r,t[7]=f*o-s*r,t},a.fromTranslation=function(t,a){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t},a.fromScaling=function(t,a){return t[0]=a[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=a[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.fromRotation=function(t,a,n){var o,h,M,i=n[0],s=n[1],u=n[2],e=Math.sqrt(i*i+s*s+u*u);return e<r.EPSILON?null:(i*=e=1/e,s*=e,u*=e,o=Math.sin(a),M=1-(h=Math.cos(a)),t[0]=i*i*M+h,t[1]=s*i*M+u*o,t[2]=u*i*M-s*o,t[3]=0,t[4]=i*s*M-u*o,t[5]=s*s*M+h,t[6]=u*s*M+i*o,t[7]=0,t[8]=i*u*M+s*o,t[9]=s*u*M-i*o,t[10]=u*u*M+h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},a.fromXRotation=function(t,a){var n=Math.sin(a),r=Math.cos(a);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.fromYRotation=function(t,a){var n=Math.sin(a),r=Math.cos(a);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.fromZRotation=function(t,a){var n=Math.sin(a),r=Math.cos(a);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.fromRotationTranslation=M,a.fromQuat2=function(t,a){var n=i,r=-a[0],o=-a[1],h=-a[2],s=a[3],u=a[4],e=a[5],c=a[6],f=a[7],v=r*r+o*o+h*h+s*s;return v>0?(n[0]=2*(u*s+f*r+e*h-c*o)/v,n[1]=2*(e*s+f*o+c*r-u*h)/v,n[2]=2*(c*s+f*h+u*o-e*r)/v):(n[0]=2*(u*s+f*r+e*h-c*o),n[1]=2*(e*s+f*o+c*r-u*h),n[2]=2*(c*s+f*h+u*o-e*r)),M(t,a,n),t};var i=n.create();function s(t,a,n){return t[0]=a[0]-n[0],t[1]=a[1]-n[1],t[2]=a[2]-n[2],t[3]=a[3]-n[3],t[4]=a[4]-n[4],t[5]=a[5]-n[5],t[6]=a[6]-n[6],t[7]=a[7]-n[7],t[8]=a[8]-n[8],t[9]=a[9]-n[9],t[10]=a[10]-n[10],t[11]=a[11]-n[11],t[12]=a[12]-n[12],t[13]=a[13]-n[13],t[14]=a[14]-n[14],t[15]=a[15]-n[15],t}a.getTranslation=function(t,a){return t[0]=a[12],t[1]=a[13],t[2]=a[14],t},a.getScaling=function(t,a){var n=a[0],r=a[1],o=a[2],h=a[4],M=a[5],i=a[6],s=a[8],u=a[9],e=a[10];return t[0]=Math.sqrt(n*n+r*r+o*o),t[1]=Math.sqrt(h*h+M*M+i*i),t[2]=Math.sqrt(s*s+u*u+e*e),t},a.getRotation=function(t,a){var n=a[0]+a[5]+a[10],r=0;return n>0?(r=2*Math.sqrt(n+1),t[3]=.25*r,t[0]=(a[6]-a[9])/r,t[1]=(a[8]-a[2])/r,t[2]=(a[1]-a[4])/r):a[0]>a[5]&&a[0]>a[10]?(r=2*Math.sqrt(1+a[0]-a[5]-a[10]),t[3]=(a[6]-a[9])/r,t[0]=.25*r,t[1]=(a[1]+a[4])/r,t[2]=(a[8]+a[2])/r):a[5]>a[10]?(r=2*Math.sqrt(1+a[5]-a[0]-a[10]),t[3]=(a[8]-a[2])/r,t[0]=(a[1]+a[4])/r,t[1]=.25*r,t[2]=(a[6]+a[9])/r):(r=2*Math.sqrt(1+a[10]-a[0]-a[5]),t[3]=(a[1]-a[4])/r,t[0]=(a[8]+a[2])/r,t[1]=(a[6]+a[9])/r,t[2]=.25*r),t},a.fromRotationTranslationScale=function(t,a,n,r){var o=a[0],h=a[1],M=a[2],i=a[3],s=o+o,u=h+h,e=M+M,c=o*s,f=o*u,v=o*e,b=h*u,m=h*e,d=M*e,l=i*s,p=i*u,S=i*e,P=r[0],I=r[1],O=r[2];return t[0]=(1-(b+d))*P,t[1]=(f+S)*P,t[2]=(v-p)*P,t[3]=0,t[4]=(f-S)*I,t[5]=(1-(c+d))*I,t[6]=(m+l)*I,t[7]=0,t[8]=(v+p)*O,t[9]=(m-l)*O,t[10]=(1-(c+b))*O,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},a.fromRotationTranslationScaleOrigin=function(t,a,n,r,o){var h=a[0],M=a[1],i=a[2],s=a[3],u=h+h,e=M+M,c=i+i,f=h*u,v=h*e,b=h*c,m=M*e,d=M*c,l=i*c,p=s*u,S=s*e,P=s*c,I=r[0],O=r[1],E=r[2],L=o[0],N=o[1],q=o[2],w=(1-(m+l))*I,x=(v+P)*I,g=(b-S)*I,R=(v-P)*O,y=(1-(f+l))*O,T=(d+p)*O,D=(b+S)*E,A=(d-p)*E,j=(1-(f+m))*E;return t[0]=w,t[1]=x,t[2]=g,t[3]=0,t[4]=R,t[5]=y,t[6]=T,t[7]=0,t[8]=D,t[9]=A,t[10]=j,t[11]=0,t[12]=n[0]+L-(w*L+R*N+D*q),t[13]=n[1]+N-(x*L+y*N+A*q),t[14]=n[2]+q-(g*L+T*N+j*q),t[15]=1,t},a.fromQuat=function(t,a){var n=a[0],r=a[1],o=a[2],h=a[3],M=n+n,i=r+r,s=o+o,u=n*M,e=r*M,c=r*i,f=o*M,v=o*i,b=o*s,m=h*M,d=h*i,l=h*s;return t[0]=1-c-b,t[1]=e+l,t[2]=f-d,t[3]=0,t[4]=e-l,t[5]=1-u-b,t[6]=v+m,t[7]=0,t[8]=f+d,t[9]=v-m,t[10]=1-u-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.frustum=function(t,a,n,r,o,h,M){var i=1/(n-a),s=1/(o-r),u=1/(h-M);return t[0]=2*h*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*h*s,t[6]=0,t[7]=0,t[8]=(n+a)*i,t[9]=(o+r)*s,t[10]=(M+h)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=M*h*2*u,t[15]=0,t},a.perspective=function(t,a,n,r,o){var h=1/Math.tan(a/2),M=void 0;return t[0]=h/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=o&&o!==1/0?(M=1/(r-o),t[10]=(o+r)*M,t[14]=2*o*r*M):(t[10]=-1,t[14]=-2*r),t},a.perspectiveFromFieldOfView=function(t,a,n,r){var o=Math.tan(a.upDegrees*Math.PI/180),h=Math.tan(a.downDegrees*Math.PI/180),M=Math.tan(a.leftDegrees*Math.PI/180),i=Math.tan(a.rightDegrees*Math.PI/180),s=2/(M+i),u=2/(o+h);return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(M-i)*s*.5,t[9]=(o-h)*u*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t},a.ortho=function(t,a,n,r,o,h,M){var i=1/(a-n),s=1/(r-o),u=1/(h-M);return t[0]=-2*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(a+n)*i,t[13]=(o+r)*s,t[14]=(M+h)*u,t[15]=1,t},a.lookAt=function(t,a,n,h){var M=void 0,i=void 0,s=void 0,u=void 0,e=void 0,c=void 0,f=void 0,v=void 0,b=void 0,m=void 0,d=a[0],l=a[1],p=a[2],S=h[0],P=h[1],I=h[2],O=n[0],E=n[1],L=n[2];return Math.abs(d-O)<r.EPSILON&&Math.abs(l-E)<r.EPSILON&&Math.abs(p-L)<r.EPSILON?o(t):(f=d-O,v=l-E,b=p-L,M=P*(b*=m=1/Math.sqrt(f*f+v*v+b*b))-I*(v*=m),i=I*(f*=m)-S*b,s=S*v-P*f,(m=Math.sqrt(M*M+i*i+s*s))?(M*=m=1/m,i*=m,s*=m):(M=0,i=0,s=0),u=v*s-b*i,e=b*M-f*s,c=f*i-v*M,(m=Math.sqrt(u*u+e*e+c*c))?(u*=m=1/m,e*=m,c*=m):(u=0,e=0,c=0),t[0]=M,t[1]=u,t[2]=f,t[3]=0,t[4]=i,t[5]=e,t[6]=v,t[7]=0,t[8]=s,t[9]=c,t[10]=b,t[11]=0,t[12]=-(M*d+i*l+s*p),t[13]=-(u*d+e*l+c*p),t[14]=-(f*d+v*l+b*p),t[15]=1,t)},a.targetTo=function(t,a,n,r){var o=a[0],h=a[1],M=a[2],i=r[0],s=r[1],u=r[2],e=o-n[0],c=h-n[1],f=M-n[2],v=e*e+c*c+f*f;v>0&&(e*=v=1/Math.sqrt(v),c*=v,f*=v);var b=s*f-u*c,m=u*e-i*f,d=i*c-s*e;return(v=b*b+m*m+d*d)>0&&(b*=v=1/Math.sqrt(v),m*=v,d*=v),t[0]=b,t[1]=m,t[2]=d,t[3]=0,t[4]=c*d-f*m,t[5]=f*b-e*d,t[6]=e*m-c*b,t[7]=0,t[8]=e,t[9]=c,t[10]=f,t[11]=0,t[12]=o,t[13]=h,t[14]=M,t[15]=1,t},a.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},a.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},a.add=function(t,a,n){return t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t[3]=a[3]+n[3],t[4]=a[4]+n[4],t[5]=a[5]+n[5],t[6]=a[6]+n[6],t[7]=a[7]+n[7],t[8]=a[8]+n[8],t[9]=a[9]+n[9],t[10]=a[10]+n[10],t[11]=a[11]+n[11],t[12]=a[12]+n[12],t[13]=a[13]+n[13],t[14]=a[14]+n[14],t[15]=a[15]+n[15],t},a.subtract=s,a.multiplyScalar=function(t,a,n){return t[0]=a[0]*n,t[1]=a[1]*n,t[2]=a[2]*n,t[3]=a[3]*n,t[4]=a[4]*n,t[5]=a[5]*n,t[6]=a[6]*n,t[7]=a[7]*n,t[8]=a[8]*n,t[9]=a[9]*n,t[10]=a[10]*n,t[11]=a[11]*n,t[12]=a[12]*n,t[13]=a[13]*n,t[14]=a[14]*n,t[15]=a[15]*n,t},a.multiplyScalarAndAdd=function(t,a,n,r){return t[0]=a[0]+n[0]*r,t[1]=a[1]+n[1]*r,t[2]=a[2]+n[2]*r,t[3]=a[3]+n[3]*r,t[4]=a[4]+n[4]*r,t[5]=a[5]+n[5]*r,t[6]=a[6]+n[6]*r,t[7]=a[7]+n[7]*r,t[8]=a[8]+n[8]*r,t[9]=a[9]+n[9]*r,t[10]=a[10]+n[10]*r,t[11]=a[11]+n[11]*r,t[12]=a[12]+n[12]*r,t[13]=a[13]+n[13]*r,t[14]=a[14]+n[14]*r,t[15]=a[15]+n[15]*r,t},a.exactEquals=function(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]&&t[4]===a[4]&&t[5]===a[5]&&t[6]===a[6]&&t[7]===a[7]&&t[8]===a[8]&&t[9]===a[9]&&t[10]===a[10]&&t[11]===a[11]&&t[12]===a[12]&&t[13]===a[13]&&t[14]===a[14]&&t[15]===a[15]},a.equals=function(t,a){var n=t[0],o=t[1],h=t[2],M=t[3],i=t[4],s=t[5],u=t[6],e=t[7],c=t[8],f=t[9],v=t[10],b=t[11],m=t[12],d=t[13],l=t[14],p=t[15],S=a[0],P=a[1],I=a[2],O=a[3],E=a[4],L=a[5],N=a[6],q=a[7],w=a[8],x=a[9],g=a[10],R=a[11],y=a[12],T=a[13],D=a[14],A=a[15];return Math.abs(n-S)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(o-P)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(h-I)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(I))&&Math.abs(M-O)<=r.EPSILON*Math.max(1,Math.abs(M),Math.abs(O))&&Math.abs(i-E)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(s-L)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(L))&&Math.abs(u-N)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(N))&&Math.abs(e-q)<=r.EPSILON*Math.max(1,Math.abs(e),Math.abs(q))&&Math.abs(c-w)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(f-x)<=r.EPSILON*Math.max(1,Math.abs(f),Math.abs(x))&&Math.abs(v-g)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(g))&&Math.abs(b-R)<=r.EPSILON*Math.max(1,Math.abs(b),Math.abs(R))&&Math.abs(m-y)<=r.EPSILON*Math.max(1,Math.abs(m),Math.abs(y))&&Math.abs(d-T)<=r.EPSILON*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(l-D)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(p-A)<=r.EPSILON*Math.max(1,Math.abs(p),Math.abs(A))},a.mul=h,a.sub=s}));