// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.16/esri/copyright.txt for details.

define(["require","exports","tslib","../intl","../core/Collection","../core/deprecate","../core/events","../core/Handles","../core/Logger","../core/throttle","../core/watchUtils","../core/accessorSupport/decorators","./Spinner","./Widget","./Feature/support/FeatureContentMixin","./Popup/PopupViewModel","./support/widget","./support/widgetUtils","@dojo/framework/shim/Promise"],(function(e,t,o,i,n,r,s,a,l,u,d,p,c,h,_,f,g,v){var b="esri-icon-left-triangle-arrow",y="esri-icon-right-triangle-arrow",m="esri-icon-maximize",w="esri-icon-dock-bottom",M="esri-icon-dock-left",k="esri-icon-dock-right",x="esri-icon-close",A="esri-icon-minimize",C="esri-icon-check-mark",F="esri-icon-loading-indicator",O="esri-icon-default-action",E="esri-icon-handle-horizontal",I="esri-rotating",P="esri-popup",N="esri-widget",B="esri-popup__main-container",W="esri-popup__loading-container",D="esri-popup--is-collapsible",S="esri-popup--is-collapsed",V="esri-popup--shadow",T="esri-popup--is-docked",L="esri-popup--is-docked-top-left",U="esri-popup--is-docked-top-center",H="esri-popup--is-docked-top-right",R="esri-popup--is-docked-bottom-left",j="esri-popup--is-docked-bottom-center",K="esri-popup--is-docked-bottom-right",z="esri-popup--aligned-top-center",q="esri-popup--aligned-bottom-center",G="esri-popup--aligned-top-left",J="esri-popup--aligned-bottom-left",Q="esri-popup--aligned-top-right",X="esri-popup--aligned-bottom-right",Y="esri-popup--feature-menu-open",Z="esri-popup--actions-menu-open",$="esri-popup--feature-updated",ee="esri-popup__header",te="esri-popup__header-buttons",oe="esri-popup__header-container",ie="esri-popup__header-container--button",ne="esri-popup__header-title",re="esri-popup__content",se="esri-popup__footer",ae="esri-popup__footer--has-pagination",le="esri-popup__footer--has-actions",ue="esri-popup__footer--has-actions-menu",de="esri-popup__button",pe="esri-popup__button--disabled",ce="esri-popup__button--dock",he="esri-popup__icon",_e="esri-popup__icon--dock-icon",fe="esri-popup__inline-actions-container",ge="esri-popup__actions-menu-button",ve="esri-popup__actions",be="esri-popup__action",ye="esri-popup__action-image",me="esri-popup__action-text",we="esri-popup__action-toggle",Me="esri-popup__action-toggle--on",ke="esri-popup__pointer",xe="esri-popup__pointer-direction",Ae="esri-popup__navigation",Ce="esri-popup__pagination-previous",Fe="esri-popup__pagination-next",Oe="esri-popup__pagination-previous-icon",Ee="esri-popup__pagination-previous-icon--rtl",Ie="esri-popup__pagination-next-icon",Pe="esri-popup__pagination-next-icon--rtl",Ne="esri-popup__feature-menu",Be="esri-popup__feature-menu-list",We="esri-popup__feature-menu-item",De="esri-popup__feature-menu-viewport",Se="esri-popup__feature-menu-header",Ve="esri-popup__feature-menu-item--selected",Te="esri-popup__feature-menu-button",Le="esri-popup__feature-menu-title",Ue={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};function He(e,t){return void 0===t?"esri-popup__"+e:"esri-popup__"+e+"-"+t}var Re=l.getLogger("esri.widgets.Popup"),je={closeButton:!0,featureNavigation:!0};return function(t){function l(e,i){var n=t.call(this,e,i)||this;return n._blurContainer=!1,n._containerNode=null,n._mainContainerNode=null,n._featureMenuNode=null,n._actionsMenuNode=null,n._focusContainer=!1,n._focusDockButton=!1,n._focusFeatureMenuButton=!1,n._focusActionsMenuButton=!1,n._focusFirstFeature=!1,n._focusFirstAction=!1,n._handles=new a,n._pointerOffsetInPx=16,n._spinner=null,n._displaySpinnerThrottled=u.throttle((function(){return n._displaySpinner()}),0),n.actions=null,n.alignment="auto",n.autoCloseEnabled=null,n.autoOpenEnabled=null,n.defaultPopupTemplateEnabled=null,n.content=null,n.collapsed=!1,n.collapseEnabled=!0,n.dockEnabled=!1,n.featureCount=null,n.featureMenuOpen=!1,n.features=null,n.goToOverride=null,n.highlightEnabled=null,n.location=null,n.featureWidgets=[],n.label=void 0,n.maxInlineActions=3,n.messages=null,n.messagesCommon=null,n.promises=null,n.selectedFeature=null,n.selectedFeatureIndex=null,n.selectedFeatureWidget=null,n.spinnerEnabled=!0,n.title=null,n.updateLocationEnabled=null,n.view=null,n.viewModel=new f,n.visible=null,n.visibleElements=o.__assign({},je),n._addSelectedFeatureIndexHandle(),n.own([d.watch(n,"viewModel.screenLocation",(function(){return n._positionContainer()})),d.watch(n,["viewModel.visible","dockEnabled"],(function(){return n._toggleScreenLocationEnabled()})),d.watch(n,"viewModel.screenLocation",(function(e,t){!!e!=!!t&&n.reposition()})),d.watch(n,"viewModel.features",(function(){return n._updateFeatureWidgets()})),d.watch(n,["viewModel.view.padding","viewModel.view.size","viewModel.visible","viewModel.waitingForResult","viewModel.location","alignment"],(function(){return n.reposition()})),d.watch(n,"spinnerEnabled",(function(e){return n._spinnerEnabledChange(e)})),d.watch(n,"viewModel.view.size",(function(e,t){return n._updateDockEnabledForViewSize(e,t)})),d.watch(n,"viewModel.view",(function(e,t){return n._viewChange(e,t)})),d.watch(n,"viewModel.view.ready",(function(e,t){return n._viewReadyChange(e,t)})),d.watch(n,["viewModel.waitingForResult","viewModel.location"],(function(){n._hideSpinner(),n._displaySpinnerThrottled()})),d.watch(n,["featureWidgets","viewModel.selectedFeatureIndex"],(function(){return n._updateFeatureWidget()})),d.watch(n,"selectedFeatureWidget.viewModel.title",(function(e){return n._setTitleFromFeatureWidget(e)})),d.watch(n,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],(function(){return n._setContentFromFeatureWidget()})),d.whenFalse(n,"collapsed",(function(){var e,t;"xsmall"===(null===(t=null===(e=n.viewModel)||void 0===e?void 0:e.view)||void 0===t?void 0:t.widthBreakpoint)&&n.visible&&n.collapseEnabled&&n.viewModel.centerAtLocation()})),d.on(n,"viewModel.allActions","change",(function(){return n._watchActions()})),d.init(n,"viewModel.allActions",(function(){return n._watchActions()}))]),n}return o.__extends(l,t),l.prototype.destroy=function(){this._destroyFeatureWidgets(),this._destroySpinner(),this._handles&&this._handles.destroy(),this._handles=null},Object.defineProperty(l.prototype,"actionsMenuId",{get:function(){return this.id+"-actions-menu"},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"actionsMenuButtonId",{get:function(){return this.id+"-actions-menu-button"},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"featureMenuId",{get:function(){return this.id+"-feature-menu"},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"titleId",{get:function(){return this.id+"-popup-title"},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"contentId",{get:function(){return this.id+"-popup-content"},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"hasContent",{get:function(){var e,t,o,i,n;return!!(this.selectedFeatureWidget?(null===(t=null===(e=this.selectedFeatureWidget)||void 0===e?void 0:e.viewModel)||void 0===t?void 0:t.waitingForContent)||(null===(i=null===(o=this.selectedFeatureWidget)||void 0===o?void 0:o.viewModel)||void 0===i?void 0:i.content):null===(n=this.viewModel)||void 0===n?void 0:n.content)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"featureNavigationVisible",{get:function(){return this.visible&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"collapsible",{get:function(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"featureMenuVisible",{get:function(){return this.featureNavigationVisible&&this.featureMenuOpen&&this.visible},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"contentCollapsed",{get:function(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"dividedActions",{get:function(){return this._divideActions()},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"actionsMenuOpen",{get:function(){return!!this.viewModel.visible&&this._get("actionsMenuOpen")},set:function(e){this._set("actionsMenuOpen",!!e)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"currentAlignment",{get:function(){return this._getCurrentAlignment()},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"currentDockPosition",{get:function(){return this._getCurrentDockPosition()},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"dockOptions",{get:function(){return this._get("dockOptions")||Ue},set:function(e){var t=o.__assign({},Ue),i=this.get("viewModel.view.breakpoints"),n={};i&&(n.width=i.xsmall,n.height=i.xsmall);var r=o.__assign(o.__assign({},t),e),s=o.__assign(o.__assign({},t.breakpoint),n),a=r.breakpoint;!0===a?r.breakpoint=s:"object"==typeof a&&(r.breakpoint=o.__assign(o.__assign({},s),a)),this._set("dockOptions",r),this._setCurrentDockPosition(),this.reposition()},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"featureNavigationEnabled",{set:function(e){r.deprecatedProperty(Re,"featureNavigationEnabled",{replacement:"visibleElements.featureNavigation",version:"4.15"}),this.visibleElements=o.__assign(o.__assign({},this.visibleElements),{featureNavigation:e})},enumerable:!0,configurable:!0}),l.prototype.castVisibleElements=function(e){return o.__assign(o.__assign({},je),e)},l.prototype.blur=function(){this.visible||Re.warn("Popup cannot be blurred while visible is false"),this._blurContainer=!0,this.scheduleRender()},l.prototype.clear=function(){this.viewModel.clear()},l.prototype.close=function(){this.visible=!1},l.prototype.fetchFeatures=function(e,t){return this.viewModel.fetchFeatures(e,t)},l.prototype.focus=function(){this.visible||Re.warn("Popup cannot be focused while visible is false"),this._focusContainer=!0,this.scheduleRender()},l.prototype.next=function(){return this.viewModel.next()},l.prototype.open=function(e){var t,o;this._handles.remove("selected-index");var i=!!e&&!!e.featureMenuOpen,n=!!e&&!!e.actionsMenuOpen,r={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:n,featureMenuOpen:i};"xsmall"===(null===(o=null===(t=this.viewModel)||void 0===t?void 0:t.view)||void 0===o?void 0:o.widthBreakpoint)&&(r.collapsed=!0),this.set(r),this.viewModel.open(e),this._addSelectedFeatureIndexHandle()},l.prototype.previous=function(){return this.viewModel.previous()},l.prototype.reposition=function(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()},l.prototype.triggerAction=function(e){this.viewModel.triggerAction(e)},l.prototype.render=function(){var e,t,o,i,n,r=this,s=r.actionsMenuOpen,a=r.dockEnabled,l=r.visible,u=r.featureMenuVisible,d=r.dividedActions,p=r.currentAlignment,c=r.currentDockPosition,h=d.menuActions,_=l&&h.length>1&&s,f=l&&a,v=l&&!a,b=null===(o=null===(t=this.selectedFeature)||void 0===t?void 0:t.layer)||void 0===o?void 0:o.title,y=null===(n=null===(i=this.selectedFeature)||void 0===i?void 0:i.layer)||void 0===n?void 0:n.id,m=((e={})[z]="top-center"===p,e[q]="bottom-center"===p,e[G]="top-left"===p,e[J]="bottom-left"===p,e[Q]="top-right"===p,e[X]="bottom-right"===p,e[T]=f,e[V]=v,e[L]="top-left"===c,e[U]="top-center"===c,e[H]="top-right"===c,e[R]="bottom-left"===c,e[j]="bottom-center"===c,e[K]="bottom-right"===c,e[Y]=u,e[Z]=_,e);return g.tsx("div",{class:this.classes(P,m),role:"presentation","data-layer-title":b,"data-layer-id":y,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},l?[this.renderMainContainer(),this.renderPointer()]:null)},l.prototype.renderLoadingContainer=function(){var e=this.messagesCommon;return this.viewModel.pendingPromisesCount?g.tsx("div",{key:He("loading-container"),role:"presentation",class:W,"aria-label":e.loading,title:e.loading},g.tsx("span",{"aria-hidden":"true",class:this.classes(he,F,I)})):null},l.prototype.renderPreviousIcon=function(){var e,t=v.isRTL(),o=((e={})[y]=t,e[Ee]=t,e[b]=!t,e[Oe]=!t,e);return g.tsx("span",{"aria-hidden":"true",class:this.classes(he,o)})},l.prototype.renderPreviousButton=function(){var e=this.messages;return g.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(de,Ce),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())},l.prototype.renderNextIcon=function(){var e,t=v.isRTL(),o=((e={})[b]=t,e[Pe]=t,e[y]=!t,e[Ie]=!t,e);return g.tsx("span",{"aria-hidden":"true",class:this.classes(he,o)})},l.prototype.renderNextButton=function(){var e=this.messages;return g.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(de,Fe),"aria-label":e.next,title:e.next},this.renderNextIcon())},l.prototype.renderFeatureMenuButton=function(){var e=this.featureMenuOpen,t=this.featureMenuId,o=this.messagesCommon,i=this.viewModel,n=i.featureCount,r=i.selectedFeatureIndex;return g.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(de,Te),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e,"aria-label":o.menu,title:o.menu},this._getPageText(n,r))},l.prototype.renderNavigationButtons=function(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderLoadingContainer()||this.renderFeatureMenuButton(),this.renderNextButton()]:null},l.prototype.renderDockIcon=function(){var e,t=this.dockEnabled,o=this._wouldDockTo(),i=((e={})[A]=t,e[_e]=!t,e[k]=!t&&("top-right"===o||"bottom-right"===o),e[M]=!t&&("top-left"===o||"bottom-left"===o),e[m]=!t&&"top-center"===o,e[w]=!t&&"bottom-center"===o,e);return g.tsx("span",{"aria-hidden":"true",class:this.classes(i,he)})},l.prototype.renderDockButton=function(){var e,t,o,i=this.dockEnabled,n=this.messages,r=null===(t=null===(e=this.viewModel)||void 0===e?void 0:e.view)||void 0===t?void 0:t.widthBreakpoint,s=i?n.undock:n.dock;return"xsmall"!==r&&(null===(o=this.dockOptions)||void 0===o?void 0:o.buttonEnabled)?g.tsx("div",{role:"button","aria-label":s,title:s,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(de,ce)},this.renderDockIcon()):null},l.prototype.renderTitle=function(){var e,t=this.viewModel.title,o=this.titleId,i=this.collapsible,n=this.contentCollapsed,r=this.messagesCommon,s=i?n?r.expand:r.collapse:"",a=((e={})[ie]=i,e);return t?g.tsx("div",{class:this.classes(oe,a),key:t,enterAnimation:this._createFeatureUpdatedAnimation(),id:o,role:i?"button":"heading","aria-label":s,title:s,tabIndex:i?0:-1,bind:this,onclick:this._toggleCollapsed,onkeydown:this._toggleCollapsed},g.tsx("h2",{class:ne,innerHTML:t})):null},l.prototype.renderCloseIcon=function(){return g.tsx("span",{"aria-hidden":"true",class:this.classes(he,x)})},l.prototype.renderCloseButton=function(){var e=this.visibleElements,t=this.messagesCommon;return e.closeButton?g.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:de,"aria-label":t.close,title:t.close},this.renderCloseIcon()):null},l.prototype.renderHeader=function(){return g.tsx("header",{class:ee},this.renderTitle(),g.tsx("div",{class:te},this.renderDockButton(),this.renderCloseButton()))},l.prototype.renderContentContainer=function(){var e=this.contentId,t=this.hasContent,o=this.contentCollapsed,i=this.viewModel.content;return t&&!o?g.tsx("article",{key:i,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:re},this.renderContent()):null},l.prototype.renderActionsMenuButton=function(){var e=this,t=e.actionsMenuId,o=e.actionsMenuButtonId,i=e.actionsMenuOpen,n=e.dividedActions,r=e.messagesCommon,s=i?r.close:r.open;return n.menuActions.length?g.tsx("div",{key:He("actions-menu-button"),class:this.classes(de,ge),role:"button",id:o,"aria-haspopup":"true","aria-controls":i?t:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":s,title:s},g.tsx("span",{"aria-hidden":"true",class:E})):null},l.prototype.renderMenuActions=function(){var e=this,t=this.actionsMenuId,o=this.actionsMenuButtonId,i=this.actionsMenuOpen,n=this.dividedActions,r=n.menuActions,s=n.inlineActions;return r.length&&i?g.tsx("ul",{id:t,role:"menu","aria-labelledby":o,key:He("actions"),class:ve,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},r.toArray().map((function(t,o){return e.renderAction({action:t,index:o+s.length,type:"menu-item"})}))):null},l.prototype.renderInlineActions=function(){var e=this,t=this.dividedActions.inlineActions;return!!t.length&&t.toArray().map((function(t,o){return e.renderAction({action:t,index:o,type:"inline"})}))},l.prototype.renderInlineActionsContainer=function(){var e=this.dividedActions,t=e.inlineActions,o=e.menuActions,i=!!t.length,n=!!o.length;return i||n?g.tsx("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":n.toString(),class:fe},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null},l.prototype.renderNavigation=function(){return this.featureNavigationVisible?g.tsx("section",{key:He("navigation"),class:this.classes(Ae)},this.renderNavigationButtons()):null},l.prototype.renderFooter=function(){var e,t=this.featureNavigationVisible,o=this.dividedActions,i=o.inlineActions,n=o.menuActions,r=!!i.length,s=!!n.length,a=((e={})[ae]=t,e[le]=r,e[ue]=s,e);return t||r?g.tsx("div",{key:He("feature-buttons"),class:this.classes(se,a)},this.renderInlineActionsContainer(),this.renderNavigation()):null},l.prototype.renderFeatureMenuContainer=function(){var e=this.featureWidgets,t=this.messages,o=this.viewModel.selectedFeatureIndex,n=i.substitute(t.selectedFeatures,{total:e.length});return g.tsx("section",{key:He("menu"),class:Ne},g.tsx("h2",{class:Se},n),g.tsx("nav",{class:De,afterCreate:this._featureMenuViewportNodeUpdated,afterUpdate:this._featureMenuViewportNodeUpdated},this.renderFeatureMenu(e,o)))},l.prototype.renderPointer=function(){return this.dockEnabled?null:g.tsx("div",{key:He("pointer"),class:ke,role:"presentation"},g.tsx("div",{class:this.classes(xe,V)}))},l.prototype.renderMainContainer=function(){var e,t=this,o=t.dockEnabled,i=t.currentAlignment,n=t.currentDockPosition,r=t.titleId,s=t.contentId,a=t.collapsible,l=t.hasContent,u=t.contentCollapsed,d=this.viewModel.title,p="bottom-left"===i||"bottom-center"===i||"bottom-right"===i||"top-left"===n||"top-center"===n||"top-right"===n,c="top-left"===i||"top-center"===i||"top-right"===i||"bottom-left"===n||"bottom-center"===n||"bottom-right"===n,h=this.renderFeatureMenuContainer(),_=this.renderFooter(),f=((e={})[V]=o,e[D]=a,e[S]=u,e);return g.tsx("div",{class:this.classes(B,N,f),tabIndex:-1,role:"dialog","aria-labelledby":d?r:"","aria-describedby":l&&!u?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},p?_:null,p?h:null,this.renderHeader(),this.renderContentContainer(),c?_:null,c?h:null)},l.prototype.renderContent=function(){var e,t=null===(e=this.viewModel)||void 0===e?void 0:e.content;return t?"string"==typeof t?g.tsx("div",{key:t,innerHTML:t}):this.renderNodeContent(t):null},l.prototype.renderActionText=function(e){return g.tsx("span",{key:"text",class:me},e)},l.prototype.renderActionIcon=function(e){var t,o=this._getActionClass(e),i=this._getActionImage(e),n=((t={})[F]=e.active,t[I]=e.active,t[he]=!!o,t[ye]=!e.active&&!!i,t);return o&&(n[o]=!e.active),g.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes(he,n),styles:this._getIconStyles(i)})},l.prototype.renderAction=function(e){var t,o=e.action,i=e.index,n=e.type,r=this._getActionTitle(o),s=((t={})[be]="toggle"!==o.type,t[we]="toggle"===o.type,t[Me]="toggle"===o.type&&o.value,t[pe]=o.disabled,t),a=[this.renderActionIcon(o),this.renderActionText(r)],l="menu-item"===n?g.tsx("li",{key:o,role:"menuitem",tabIndex:0,title:r,"aria-label":r,class:this.classes(de,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},a):g.tsx("div",{key:o,role:"button",tabIndex:0,title:r,"aria-label":r,class:this.classes(de,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},a);return o.visible?l:null},l.prototype.renderFeatureMenuItem=function(e,t,o){var i,n=this.messages,r=this.messagesCommon,s=t===o,a=((i={})[Ve]=s,i),l=s?g.tsx("span",{key:He("feature-menu-selected-feature-"+o),title:n.selectedFeature,"aria-label":n.selectedFeature,class:C}):null,u=g.tsx("span",{innerHTML:e.title||r.untitled});return g.tsx("li",{role:"menuitem",tabIndex:-1,key:He("feature-menu-feature-"+o),class:this.classes(a,We),bind:this,"data-feature-index":t,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},g.tsx("span",{class:Le},u,l))},l.prototype.renderFeatureMenu=function(e,t){var o=this,i=this.featureMenuId;return e.length>1?g.tsx("ol",{class:Be,id:i,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},e.map((function(e,i){return o.renderFeatureMenuItem(e,i,t)}))):null},l.prototype._getActionTitle=function(e){var t=this.messages,o=this.selectedFeature,n=this.messagesCommon,r=e.id,s=null==o?void 0:o.attributes,a="zoom-to-feature"===r?i.substitute(e.title,{messages:t}):"remove-selected-feature"===r?i.substitute(e.title,{messages:n}):e.title;return a&&s?i.substitute(a,s):a},l.prototype._getActionClass=function(e){var t=this.selectedFeature,o=null==t?void 0:t.attributes,n=e.className,r=e.image||n?n:O;return r&&o?i.substitute(r,o):r},l.prototype._getActionImage=function(e){var t=this.selectedFeature,o=null==t?void 0:t.attributes,n=e.image;return n&&o?i.substitute(n,o):n},l.prototype._createFeatureUpdatedAnimation=function(){return v.cssTransition("enter",$)},l.prototype._getInlineActionCount=function(){var e=this.maxInlineActions,t=this.featureNavigationVisible;if("number"!=typeof e)return null;var o=Math.round(e);return Math.max(t?o-1:o,0)},l.prototype._watchActions=function(){var e=this,t=this.viewModel.allActions;this.notifyChange("dividedActions");this._handles.remove("actions"),t&&t.forEach((function(t){e._handles.add(d.watch(t,["active","className","disabled","id","title","image","visible"],(function(){return e.scheduleRender()})),"actions")}))},l.prototype._divideActions=function(){var e=this.viewModel.allActions,t=this._getInlineActionCount(),o=null===t,i=0===t;return{inlineActions:o?e.slice(0):i?new n:e.slice(0,t),menuActions:o?new n:i?e.slice(0):e.slice(t)}},l.prototype._featureMenuOpenChanged=function(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0},l.prototype._actionsMenuOpenChanged=function(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0},l.prototype._setTitleFromFeatureWidget=function(e){this.selectedFeatureWidget&&(this.viewModel.title=e||"")},l.prototype._setContentFromFeatureWidget=function(){var e=this.selectedFeatureWidget;e&&(this.viewModel.content=e)},l.prototype._handleFeatureMenuKeyup=function(e){"Escape"===s.eventKey(e)&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())},l.prototype._handleActionMenuKeyup=function(e){"Escape"===s.eventKey(e)&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())},l.prototype._handleFeatureMenuItemKeyup=function(e){var t=s.eventKey(e),o=this._featureMenuNode,i=e.currentTarget["data-feature-index"];if(o){var n=o.querySelectorAll("li"),r=n.length;if("ArrowUp"===t)return e.stopPropagation(),void n[(i-1+r)%r].focus();if("ArrowDown"===t)return e.stopPropagation(),void n[(i+1+r)%r].focus();if("Home"===t)return e.stopPropagation(),void n[0].focus();if("End"===t)return e.stopPropagation(),void n[n.length-1].focus()}},l.prototype._handleActionMenuItemKeyup=function(e){var t=s.eventKey(e),o=this._actionsMenuNode,i=e.currentTarget["data-action-index"];if(o){var n=o.querySelectorAll("li"),r=n.length;if("ArrowUp"===t)return e.stopPropagation(),void n[(i-1+r)%r].focus();if("ArrowDown"===t)return e.stopPropagation(),void n[(i+1+r)%r].focus();if("Home"===t)return e.stopPropagation(),void n[0].focus();if("End"===t)return e.stopPropagation(),void n[n.length-1].focus()}},l.prototype._handleMainKeyup=function(e){var t=s.eventKey(e);"ArrowLeft"===t&&(e.stopPropagation(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.next())},l.prototype._spinnerEnabledChange=function(e){if(this._destroySpinner(),e){var t=this.get("viewModel.view");this._createSpinner(t)}},l.prototype._hideSpinner=function(){var e=this._spinner;e&&(e.location=null,e.hide())},l.prototype._displaySpinner=function(){var e=this._spinner;if(e){var t=this.viewModel,o=t.location;t.waitingForResult?e.show({location:o}):e.hide()}},l.prototype._getIconStyles=function(e){return{"background-image":e?"url("+e+")":""}},l.prototype._addSelectedFeatureIndexHandle=function(){var e=this,t=d.watch(this,"viewModel.selectedFeatureIndex",(function(t,o){return e._selectedFeatureIndexUpdated(t,o)}));this._handles.add(t,"selected-index")},l.prototype._selectedFeatureIndexUpdated=function(e,t){this.featureCount&&e!==t&&-1!==e&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)},l.prototype._updateFeatureWidget=function(){var e=this.featureWidgets[this.viewModel.selectedFeatureIndex]||null;this._set("selectedFeatureWidget",e)},l.prototype._destroyFeatureWidgets=function(){this.featureWidgets.forEach((function(e){return e&&!e.destroyed&&e.destroy()})),this._set("featureWidgets",[])},l.prototype._updateFeatureWidgets=function(){return o.__awaiter(this,void 0,void 0,(function(){var t,i,n,r,s,a,l=this;return o.__generator(this,(function(u){switch(u.label){case 0:return i=(t=this).features,n=t.featureWidgets,i&&i.length?[4,new Promise((function(t,o){e(["./Feature"],t,o)}))]:(this._destroyFeatureWidgets(),[2]);case 1:return r=u.sent(),s=n.slice(0),a=[],i.forEach((function(e,t){if(e){var i=null;if(s.some((function(t,o){return t&&t.graphic===e&&(i=t,s.splice(o,1)),!!i})),i)a[t]=i;else{var n=new r({defaultPopupTemplateEnabled:l.defaultPopupTemplateEnabled,graphic:e,spatialReference:l.get("view.spatialReference"),map:l.get("view.map")});n.visibleElements=o.__assign(o.__assign({},n.visibleElements),{title:!1}),a[t]=n}}})),s.forEach((function(e){return e&&!e.destroyed&&e.destroy()})),this._set("featureWidgets",a),[2]}}))}))},l.prototype._isScreenLocationWithinView=function(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height},l.prototype._isOutsideView=function(e){var t=e.popupHeight,o=e.popupWidth,i=e.screenLocation,n=e.side,r=e.view;if(isNaN(o)||isNaN(t)||!r||!i)return!1;var s=r.padding;return"right"===n&&i.x+o/2>r.width-s.right||("left"===n&&i.x-o/2<s.left||("top"===n&&i.y-t<s.top||"bottom"===n&&i.y+t>r.height-s.bottom))},l.prototype._determineCurrentAlignment=function(){var e=this._pointerOffsetInPx,t=this._containerNode,o=this._mainContainerNode,i=this.viewModel,n=i.screenLocation,r=i.view;if(!n||!r||!t)return"top-center";if(!this._isScreenLocationWithinView(n,r))return this._get("currentAlignment")||"top-center";function s(e){return parseInt(e.replace(/[^-\d\.]/g,""),10)}var a=o?window.getComputedStyle(o,null):null,l=a?s(a.getPropertyValue("max-height")):0,u=a?s(a.getPropertyValue("height")):0,d=t.getBoundingClientRect(),p=d.height,c=d.width+e,h=Math.max(p,l,u)+e,_=this._isOutsideView({popupHeight:h,popupWidth:c,screenLocation:n,side:"right",view:r}),f=this._isOutsideView({popupHeight:h,popupWidth:c,screenLocation:n,side:"left",view:r}),g=this._isOutsideView({popupHeight:h,popupWidth:c,screenLocation:n,side:"top",view:r}),v=this._isOutsideView({popupHeight:h,popupWidth:c,screenLocation:n,side:"bottom",view:r});return f?g?"bottom-right":"top-right":_?g?"bottom-left":"top-left":g?v?"top-center":"bottom-center":"top-center"},l.prototype._getCurrentAlignment=function(){var e=this.alignment,t=this.dockEnabled,o=this.visible;return t||!o?null:"auto"===e?this._determineCurrentAlignment():"function"==typeof e?e.call(this):e},l.prototype._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())},l.prototype._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())},l.prototype._getDockPosition=function(){var e=this.get("dockOptions.position");return"auto"===e?this._determineCurrentDockPosition():"function"==typeof e?e.call(this):e},l.prototype._getCurrentDockPosition=function(){return this.dockEnabled&&this.visible?this._getDockPosition():null},l.prototype._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()},l.prototype._determineCurrentDockPosition=function(){var e=this.get("viewModel.view"),t=v.isRTL()?"top-left":"top-right";if(!e)return t;var o=e.padding||{left:0,right:0,top:0,bottom:0},i=e.width-o.left-o.right,n=e.get("breakpoints");return n&&i<=n.xsmall?"bottom-center":t},l.prototype._positionContainer=function(e){if(void 0===e&&(e=this._containerNode),e&&(this._containerNode=e),e){var t=this.viewModel.screenLocation,o=e.getBoundingClientRect().width,i=this._calculatePositionStyle(t,o);i&&(e.style.top=i.top,e.style.left=i.left,e.style.bottom=i.bottom,e.style.right=i.right)}},l.prototype._calculateFullWidth=function(e){var t=this.currentAlignment,o=this._pointerOffsetInPx;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+o:e},l.prototype._calculateAlignmentPosition=function(e,t,o,i){var n=this.currentAlignment,r=this._pointerOffsetInPx,s=i/2,a=o.height-t,l=o.width-e,u=this.view.padding;return"bottom-center"===n?{top:t+r-u.top,left:e-s-u.left}:"top-left"===n?{bottom:a+r-u.bottom,right:l+r-u.right}:"bottom-left"===n?{top:t+r-u.top,right:l+r-u.right}:"top-right"===n?{bottom:a+r-u.bottom,left:e+r-u.left}:"bottom-right"===n?{top:t+r-u.top,left:e+r-u.left}:"top-center"===n?{bottom:a+r-u.bottom,left:e-s-u.left}:void 0},l.prototype._calculatePositionStyle=function(e,t){var o=this.dockEnabled,i=this.view;if(i){if(o)return{left:"",top:"",right:"",bottom:""};if(e&&t){var n=this._calculateFullWidth(t),r=this._calculateAlignmentPosition(e.x,e.y,i,n);if(r)return{top:void 0!==r.top?r.top+"px":"auto",left:void 0!==r.left?r.left+"px":"auto",bottom:void 0!==r.bottom?r.bottom+"px":"auto",right:void 0!==r.right?r.right+"px":"auto"}}}},l.prototype._viewChange=function(e,t){e&&t&&(this.close(),this.clear())},l.prototype._viewReadyChange=function(e,t){if(e){var o=this.get("viewModel.view");this._wireUpView(o)}else t&&(this.close(),this.clear())},l.prototype._wireUpView=function(e){(this._destroySpinner(),e)&&(this.spinnerEnabled&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions))},l.prototype._dockingThresholdCrossed=function(e,t,o){var i=e[0],n=e[1],r=t[0],s=t[1],a=o.width,l=o.height;return i<=a&&r>a||i>a&&r<=a||n<=l&&s>l||n>l&&s<=l},l.prototype._updateDockEnabledForViewSize=function(e,t){if(e&&t){var o=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},i=o.left+o.right,n=o.top+o.bottom,r=[],s=[];r[0]=e[0]-i,r[1]=e[1]-n,s[0]=t[0]-i,s[1]=t[1]-n;var a=this.dockOptions,l=a.breakpoint;this._dockingThresholdCrossed(r,s,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}},l.prototype._focusDockButtonNode=function(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())},l.prototype._mainContainerNodeUpdated=function(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0},l.prototype._featureMenuNodeUpdated=function(e){if(this._featureMenuNode=e,e&&this._focusFirstFeature){this._focusFirstFeature=!1;var t=e.querySelectorAll("li");if(t.length)t[0].focus()}},l.prototype._actionsMenuNodeUpdated=function(e){if(this._actionsMenuNode=e,e&&this._focusFirstAction){this._focusFirstAction=!1;var t=e.querySelectorAll("li");if(t.length)t[0].focus()}},l.prototype._focusFeatureMenuButtonNode=function(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())},l.prototype._focusActionsMenuButtonNode=function(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())},l.prototype._featureMenuViewportNodeUpdated=function(e){e&&(e.scrollTop=0)},l.prototype._toggleScreenLocationEnabled=function(){var e=this.dockEnabled,t=this.visible,o=this.viewModel;if(o){var i=t&&!e;o.screenLocationEnabled=i}},l.prototype._shouldDockAtCurrentViewSize=function(e){var t=e.breakpoint,o=this.get("viewModel.view.ui"),i=o.width,n=o.height;if(isNaN(i)||isNaN(n))return!1;var r=t.hasOwnProperty("width")&&i<=t.width,s=t.hasOwnProperty("height")&&n<=t.height;return r||s},l.prototype._setDockEnabledForViewSize=function(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))},l.prototype._getPageText=function(e,t){return this.featureNavigationVisible?i.substitute(this.messages.pageText,{index:t+1,total:e}):null},l.prototype._destroySpinner=function(){var e=this._spinner,t=this.view;e&&(t&&t.ui&&t.ui.remove(this._spinner,"popup-spinner"),e.destroy(),this._spinner=null)},l.prototype._createSpinner=function(e){e&&(this._spinner=new c({view:e}),e.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))},l.prototype._toggleCollapsed=function(){this.collapsed=!this.collapsed},l.prototype._close=function(){this.close(),this.view&&this.view.focus()},l.prototype._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()},l.prototype._toggleFeatureMenu=function(){var e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e},l.prototype._toggleActionsMenu=function(){var e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e},l.prototype._triggerAction=function(e){var t=e.currentTarget["data-action-index"],o=this.viewModel.allActions.getItemAt(t);o&&"toggle"===o.type&&(o.value=!o.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(t)},l.prototype._selectFeature=function(e){var t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()},l.prototype._next=function(){this.next()},l.prototype._previous=function(){this.previous()},o.__decorate([p.property({readOnly:!0,dependsOn:["id"]}),g.renderable()],l.prototype,"actionsMenuId",null),o.__decorate([p.property({readOnly:!0,dependsOn:["id"]}),g.renderable()],l.prototype,"actionsMenuButtonId",null),o.__decorate([p.property({readOnly:!0,dependsOn:["id"]}),g.renderable()],l.prototype,"featureMenuId",null),o.__decorate([p.property({readOnly:!0,dependsOn:["id"]}),g.renderable()],l.prototype,"titleId",null),o.__decorate([p.property({readOnly:!0,dependsOn:["id"]}),g.renderable()],l.prototype,"contentId",null),o.__decorate([p.property({readOnly:!0,dependsOn:["selectedFeatureWidget","selectedFeatureWidget.viewModel","selectedFeatureWidget.viewModel.waitingForContent","selectedFeatureWidget.viewModel.content","viewModel.content"]}),g.renderable()],l.prototype,"hasContent",null),o.__decorate([p.property({readOnly:!0,dependsOn:["visible","viewModel.featureCount","visibleElements.featureNavigation"]}),g.renderable()],l.prototype,"featureNavigationVisible",null),o.__decorate([p.property({readOnly:!0,dependsOn:["collapseEnabled","viewModel.title","hasContent"]}),g.renderable()],l.prototype,"collapsible",null),o.__decorate([p.property({readOnly:!0,dependsOn:["featureNavigationVisible","featureMenuOpen","visible"]}),g.renderable()],l.prototype,"featureMenuVisible",null),o.__decorate([p.property({readOnly:!0,dependsOn:["collapsible","featureMenuVisible","collapsed"]}),g.renderable()],l.prototype,"contentCollapsed",null),o.__decorate([p.property({readOnly:!0,dependsOn:["featureNavigationVisible","maxInlineActions","viewModel.allActions","viewModel.allActions.length"]}),g.renderable()],l.prototype,"dividedActions",null),o.__decorate([p.aliasOf("viewModel.actions"),g.renderable()],l.prototype,"actions",void 0),o.__decorate([p.property({dependsOn:["viewModel.visible"]}),g.renderable()],l.prototype,"actionsMenuOpen",null),o.__decorate([p.property()],l.prototype,"alignment",void 0),o.__decorate([p.aliasOf("viewModel.autoCloseEnabled")],l.prototype,"autoCloseEnabled",void 0),o.__decorate([p.aliasOf("viewModel.autoOpenEnabled")],l.prototype,"autoOpenEnabled",void 0),o.__decorate([p.aliasOf("viewModel.defaultPopupTemplateEnabled")],l.prototype,"defaultPopupTemplateEnabled",void 0),o.__decorate([p.aliasOf("viewModel.content"),g.renderable()],l.prototype,"content",void 0),o.__decorate([p.property(),g.renderable()],l.prototype,"collapsed",void 0),o.__decorate([p.property(),g.renderable()],l.prototype,"collapseEnabled",void 0),o.__decorate([p.property({readOnly:!0,dependsOn:["dockEnabled","alignment","visible"]}),g.renderable()],l.prototype,"currentAlignment",null),o.__decorate([p.property({readOnly:!0,dependsOn:["viewModel.view.ready","dockEnabled","dockOptions","visible"]}),g.renderable()],l.prototype,"currentDockPosition",null),o.__decorate([p.property(),g.renderable()],l.prototype,"dockOptions",null),o.__decorate([p.property(),g.renderable()],l.prototype,"dockEnabled",void 0),o.__decorate([p.aliasOf("viewModel.featureCount"),g.renderable()],l.prototype,"featureCount",void 0),o.__decorate([p.property(),g.renderable()],l.prototype,"featureMenuOpen",void 0),o.__decorate([p.aliasOf("viewModel.features"),g.renderable()],l.prototype,"features",void 0),o.__decorate([p.property(),g.renderable()],l.prototype,"featureNavigationEnabled",null),o.__decorate([p.aliasOf("viewModel.goToOverride")],l.prototype,"goToOverride",void 0),o.__decorate([p.aliasOf("viewModel.highlightEnabled")],l.prototype,"highlightEnabled",void 0),o.__decorate([p.aliasOf("viewModel.location"),g.renderable()],l.prototype,"location",void 0),o.__decorate([p.property({readOnly:!0}),g.renderable()],l.prototype,"featureWidgets",void 0),o.__decorate([p.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],l.prototype,"label",void 0),o.__decorate([p.property(),g.renderable()],l.prototype,"maxInlineActions",void 0),o.__decorate([p.property(),g.renderable(),g.messageBundle("esri/widgets/Popup/t9n/Popup")],l.prototype,"messages",void 0),o.__decorate([p.property(),g.renderable(),g.messageBundle("esri/t9n/common")],l.prototype,"messagesCommon",void 0),o.__decorate([p.aliasOf("viewModel.promises")],l.prototype,"promises",void 0),o.__decorate([p.aliasOf("viewModel.selectedFeature"),g.renderable()],l.prototype,"selectedFeature",void 0),o.__decorate([p.aliasOf("viewModel.selectedFeatureIndex"),g.renderable()],l.prototype,"selectedFeatureIndex",void 0),o.__decorate([p.property({readOnly:!0}),g.renderable()],l.prototype,"selectedFeatureWidget",void 0),o.__decorate([p.property()],l.prototype,"spinnerEnabled",void 0),o.__decorate([p.aliasOf("viewModel.title"),g.renderable()],l.prototype,"title",void 0),o.__decorate([p.aliasOf("viewModel.updateLocationEnabled")],l.prototype,"updateLocationEnabled",void 0),o.__decorate([p.aliasOf("viewModel.view")],l.prototype,"view",void 0),o.__decorate([p.property({type:f}),g.renderable(["viewModel.view.widthBreakpoint","viewModel.allActions","viewModel.screenLocation","viewModel.screenLocationEnabled","viewModel.state","viewModel.pendingPromisesCount","viewModel.promiseCount","viewModel.waitingForResult"]),g.vmEvent(["triggerAction","trigger-action"])],l.prototype,"viewModel",void 0),o.__decorate([p.aliasOf("viewModel.visible"),g.renderable()],l.prototype,"visible",void 0),o.__decorate([p.property(),g.renderable()],l.prototype,"visibleElements",void 0),o.__decorate([p.cast("visibleElements")],l.prototype,"castVisibleElements",null),o.__decorate([g.accessibleHandler()],l.prototype,"_toggleCollapsed",null),o.__decorate([g.accessibleHandler()],l.prototype,"_close",null),o.__decorate([g.accessibleHandler()],l.prototype,"_toggleDockEnabled",null),o.__decorate([g.accessibleHandler()],l.prototype,"_toggleFeatureMenu",null),o.__decorate([g.accessibleHandler()],l.prototype,"_toggleActionsMenu",null),o.__decorate([g.accessibleHandler()],l.prototype,"_triggerAction",null),o.__decorate([g.accessibleHandler()],l.prototype,"_selectFeature",null),o.__decorate([g.accessibleHandler()],l.prototype,"_next",null),o.__decorate([g.accessibleHandler()],l.prototype,"_previous",null),l=o.__decorate([p.subclass("esri.widgets.Popup")],l)}(_.FeatureContentMixin(h))}));