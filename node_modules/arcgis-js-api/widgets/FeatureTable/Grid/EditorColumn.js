// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.16/esri/copyright.txt for details.

define(["require","exports","tslib","../../../core/accessorSupport/decorators","./Column"],(function(t,e,n,o,r){var a="esri-editor-column__cell-input",i="esri-editor-column__cell-input--container",u="Enter";return function(t){function e(e){var n=t.call(this,e)||this;return n.activeEditInfo=null,n.cellValueValidatorFunction=function(t){return t.oldValue!==t.value},n.editable=!1,n.inputRenderFunction=function(t){var e,o=t.root,r=t.column,a=t.rowData;if((null===(e=n.activeEditInfo)||void 0===e||!e.updating)&&n.editable){var i=n.getCellValue(r,a),u=n.createInputElement({root:o,column:r,rowData:a,value:i});n._set("activeEditInfo",{column:r,input:u,root:o,rowData:a,updating:!0,oldValue:i});var l=n.createInputContainer();l.appendChild(u),n.removeCellContent(o),o.appendChild(l),u.focus(),u instanceof HTMLInputElement&&u.select()}},n.loadingMessage="",n.inputType="text",n.maxLength=null,n.parseInputValueFunction=function(t){return t.input.value},n.renderFunction=function(t){var e,o=t.root,r=t.column,a=t.rowData,i=n.activeEditInfo;if(!i||!i.updating){var l=n.getCellValue(r,a),c=n.cellValueFormatFunction({column:r,rowData:a,value:l});if(o.onclick=function(){return o.focus()},o.ondblclick=function(){return n.inputRenderFunction(t)},o.ontouchend=function(){return n.inputRenderFunction(t)},(null==c?void 0:c.toString())!==o.innerHTML){o.innerHTML=c;var p=null===(e=n.grid)||void 0===e?void 0:e.getSlotElementByName(o.slot),d=null==p?void 0:p.parentElement;d&&!d.onkeydown&&(d.onkeydown=function(e){e.key!==u||n.activeEditInfo||n.inputRenderFunction(t)})}}},n.required=!1,n.store=null,n.updateRowItemFunction=function(t){var e=t.rowData,n=t.column,o=t.value;e.item[n.path]=o},n.updateStoreItemFunction=function(t){var e,o=t.rowData,r=t.column,a=t.value;return null===(e=n.store)||void 0===e?void 0:e.updateItem({index:o.index,name:r.path,value:a})},n}return n.__extends(e,t),e.prototype.cancel=function(){var t=this.activeEditInfo;if(t){var e=t.column,n=t.root,o=t.rowData,r=t.oldValue,a=this.cellValueFormatFunction({column:e,rowData:o,value:r});n.innerHTML=a,this._set("activeEditInfo",null)}},e.prototype.createInputContainer=function(){var t=document.createElement("div");return t.classList.add(i),t},e.prototype.createInputElement=function(t){var e=this,n=t.value,o=document.createElement("input");return o.classList.add(a),o.maxLength=this.maxLength,o.type=this.inputType,o.value=n,o.onblur=function(){o.onblur=null,e.submit()},o},e.prototype.submit=function(){return n.__awaiter(this,void 0,void 0,(function(){var t,e,o,r,a,i,u,l,c;return n.__generator(this,(function(n){switch(n.label){case 0:if(!(t=this.activeEditInfo))return[2];if(e=t.column,o=t.input,r=t.root,a=t.rowData,i=t.oldValue,u=this.parseInputValueFunction({input:o,column:e,rowData:a}),!this.cellValueValidatorFunction({value:u,oldValue:i,column:e,rowData:a}))return this.cancel(),[2];r.innerHTML=this.loadingMessage,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.updateStoreItemFunction({rowData:a,column:e,value:u})];case 2:return n.sent(),this.updateRowItemFunction({rowData:a,column:e,value:u}),l=this.getCellValue(e,a),c=this.cellValueFormatFunction({column:e,rowData:a,value:l}),r.innerHTML=c,this.emit("value-change",{column:e,rowData:a,value:l}),this._set("activeEditInfo",null),[3,4];case 3:return n.sent(),console.log("update rejected..."),this.cancel(),[3,4];case 4:return[2]}}))}))},n.__decorate([o.property({readOnly:!0})],e.prototype,"activeEditInfo",void 0),n.__decorate([o.property()],e.prototype,"cellValueValidatorFunction",void 0),n.__decorate([o.property()],e.prototype,"editable",void 0),n.__decorate([o.property()],e.prototype,"inputRenderFunction",void 0),n.__decorate([o.property({constructOnly:!0})],e.prototype,"loadingMessage",void 0),n.__decorate([o.property()],e.prototype,"inputType",void 0),n.__decorate([o.property()],e.prototype,"maxLength",void 0),n.__decorate([o.property()],e.prototype,"parseInputValueFunction",void 0),n.__decorate([o.property()],e.prototype,"renderFunction",void 0),n.__decorate([o.property()],e.prototype,"required",void 0),n.__decorate([o.property()],e.prototype,"store",void 0),n.__decorate([o.property()],e.prototype,"updateRowItemFunction",void 0),n.__decorate([o.property()],e.prototype,"updateStoreItemFunction",void 0),e=n.__decorate([o.subclass("esri.widgets.FeatureTable.EditorColumn")],e)}(r)}));